var csComp;!function(e){var t;!function(t){var i=function(){function e(){}return e}();t.Widget=i;var r=function(){function t(e,t){this.renderer=function(e,t){},this.resize=function(e,t,i){},e&&(this.title=e),this.properties={},this.dataSets=[]}return t.prototype.start=function(){},t.prototype.init=function(){this.background="red",this.id||(this.id="widget"+e.Helpers.getGuid().replace("-","")),this.elementId=this.id,this.start()},t.prototype.updateDateRange=function(e){this.range=e},t}();t.BaseWidget=r;var a=function(){function i(){this.showTimeline=!0,this.showRightmenu=!0,this.draggable=!0,this.resizable=!0,this.widgets=[]}return i.deserialize=function(e){var r=this,a=$.extend(new i,e);return a.widgets=[],e.widgets&&e.widgets.forEach(function(e){r.addNewWidget(e,a)}),e.timeline&&(a.timeline=$.extend(new t.DateRange,e.timeline)),a},i.addNewWidget=function(t,i){return t.id||(t.id=e.Helpers.getGuid()),t.elementId="widget-"+t.id,t.dashboard=i,i.widgets.push(t),t},i}();t.Dashboard=a;var n=function(){function e(){}return e}();t.Timeline=n;var o=function(){function e(){}return e}();t.TimedDataSet=o;var s=function(){function e(e,t){this.id=e,this.title=t,this.data=[]}return e}();t.DataSet=s}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(){var e=this;this.startDate=function(){return new Date(e.start)}}return e}();e.Event=t;var i=function(){function e(){}return e}();e.Feature=i,function(e){e[e.None=0]="None",e[e.Image=1]="Image",e[e.Point=2]="Point",e[e.Square=3]="Square",e[e.Rectangle=4]="Rectangle",e[e.Line=5]="Line",e[e.Circle=6]="Circle",e[e.Freehand=7]="Freehand",e[e.Polyline=8]="Polyline",e[e.Polygon=9]="Polygon",e[e.MultiPolygon=10]="MultiPolygon"}(e.DrawingModeType||(e.DrawingModeType={}));e.DrawingModeType;!function(e){e[e.none=0]="none",e[e.bar=1]="bar",e[e.text=2]="text"}(e.featureFilterType||(e.featureFilterType={}));var r=(e.featureFilterType,function(){function e(){}return e}());e.PropertyInfo=r}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){!function(e){e[e.GeoJson=0]="GeoJson",e[e.Kml=1]="Kml"}(e.LayerType||(e.LayerType={}));var t=(e.LayerType,function(){function e(){}return e}());e.ProjectGroup=t;var i=function(){function e(){}return e}();e.GroupFilter=i;var r=function(){function e(e){var t=this;this.availableAspects=["strokeColor","fillColor","strokeWidth"],this.colorScales={},this.legends={},e("WHITE_RED").then(function(e){t.colorScales[e]=["white","red"]}),e("GREEN_RED").then(function(e){t.colorScales[e]=["green","red"]}),e("RED_GREEN").then(function(e){t.colorScales[e]=["red","green"]}),e("WHITE_ORANGE").then(function(e){t.colorScales[e]=["white","orange"]}),e("BLUE_RED").then(function(e){t.colorScales[e]=["#F04030","#3040F0"]}),e("RED_BLUE").then(function(e){t.colorScales[e]=["#3040F0","#F04030"]}),e("WHITE_BLUE").then(function(e){t.colorScales[e]=["white","blue"]}),e("BLUE_WHITE").then(function(e){t.colorScales[e]=["blue","white"]}),e("WHITE_GREEN").then(function(e){t.colorScales[e]=["white","green"]}),e("GREEN_WHITE").then(function(e){t.colorScales[e]=["green","white"]}),e("WHITE_ORANGE").then(function(e){t.colorScales[e]=["white","orange"]}),e("ORANGE_WHITE").then(function(e){t.colorScales[e]=["orange","white"]})}return e}();e.GroupStyle=r;var a=function(){function e(){}return e}();e.Legend=a;var n=function(){function e(){}return e}();e.LegendEntry=n}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){!function(e){e[e.Beginner=1]="Beginner",e[e.Intermediate=2]="Intermediate",e[e.Expert=3]="Expert"}(e.Expertise||(e.Expertise={}));var t=(e.Expertise,[{title:"decades",value:31536e7},{title:"years",value:31536e6},{title:"weeks",value:6048e5},{title:"days",value:864e5},{title:"hours",value:36e5},{title:"quarters",value:9e5},{title:"minutes",value:6e4},{title:"seconds",value:1e3},{title:"milliseconds",value:1}]),i=function(){function e(){var e=this;this.startDate=function(){return e.focus<e.start&&(e.start=e.focus-e.range/5),new Date(e.start)},this.focusDate=function(){return new Date(e.focus)},this.endDate=function(){return e.focus>e.end&&(e.end=e.focus+e.range/5),new Date(e.end)}}return e.deserialize=function(t){var i=$.extend(new e,t);return("undefined"==typeof i.focus||null===i.focus)&&(i.focus=Date.now()),i},e.prototype.setFocus=function(e,i,r){var a=this;this.focus=e.getTime(),i&&(this.start=i.getTime()),r&&(this.end=r.getTime());var n=this.end-this.start;this.range!==n&&(this.range=n,t.some(function(e){return a.zoomLevel=e.value,a.zoomLevelName=e.title,e.value<a.range/10}))},e}();e.DateRange=i;var r=function(){function e(){}return e}();e.Solution=r;var a=function(){function e(){}return e}();e.SolutionProject=a;var n=function(){function t(){this.expertMode=3,this.markers={}}return t.prototype.deserialize=function(r){var a=jQuery.extend(new t,r);if(r.timeLine&&(a.timeLine=i.deserialize(r.timeLine)),r.dashboards){a.dashboards=[],r.dashboards.forEach(function(t){a.dashboards.push(e.Dashboard.deserialize(t))});for(var n in r.mcas)r.mcas.hasOwnProperty(n)&&a.mcas.push((new Mca.Models.Mca).deserialize(n))}return a.propertyTypeData||(a.propertyTypeData={}),null==a.id&&(a.id=a.title),a},t}();e.Project=n;var o=function(){function e(){}return e}();e.ProjectLayer=o}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var BaseMapList;!function(e){e.html='<div>    <h4 class="leftpanel-header" translate="MAP"></h4>    <div data-ng-repeat="(key, value) in vm.$mapService.baseLayers" style="clear:left;">        <div ng-click="vm.selectBaseLayer(key);" class="select-basestyle">            <img data-ng-src="{{value.options.preview}}" class="preview-base-layer" style="margin-bottom:5px" />            <div style="margin:3px;float:left">                <span style="font-size: 18px;font-weight: bold;">{{key}}</span><br />                {{value.options.subtitle}}            </div>        </div>    </div></div>'}(BaseMapList||(BaseMapList={}));var BaseMapList;!function(e){var t="csWeb.baseMapList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("baseMapList",["$window","$compile",function(t,i){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e,i,r){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.BaseMapListCtrl}}])}(BaseMapList||(BaseMapList={}));var BaseMapList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$mapService=t,e.vm=this}return e.prototype.selectBaseLayer=function(e){var t=this.$mapService.baseLayers[e];this.$mapService.changeBaseLayer(t)},e.$inject=["$scope","mapService"],e}();e.BaseMapListCtrl=t}(BaseMapList||(BaseMapList={}));var Charts;!function(e){"use strict";var t=function(){function e(){}return e.max=function(e){for(var t=e[0],i=0,r=1;r<e.length;r++)e[r]>t&&(i=r,t=e[r]);return{maxIndex:i,max:t}},e.min=function(e){for(var t=e[0],i=0,r=1;r<e.length;r++)e[r]<t&&(i=r,t=e[r]);return{minIndex:i,min:t}},e.timestampToString=function(e){var t=new Date(e),i=String.format("{0}-{1:00}-{2:00}",t.getFullYear(),t.getUTCMonth()+1,t.getUTCDate());return(t.getUTCHours()>0||t.getUTCMinutes()>0)&&(i+=String.format(" {0:00}:{1:00}",t.getUTCHours(),t.getUTCMinutes())),i},e.windowResize=function(e){if(void 0!==e){var t=window.onresize;window.onresize=function(i){"function"==typeof t&&t(i),e(i)}}},e.initializeMargin=function(e,t){var i=e.$eval(t.margin)||{left:50,top:50,bottom:50,right:50};"object"!=typeof i&&(i={left:i,top:i,bottom:i,right:i}),e.margin=i},e.getD3Selector=function(e,t){if(e.id)return"#"+e.id;var i;return e["data-chartid"]?i=e["data-chartid"]:(i="chartid"+Math.floor(1000000001*Math.random()),angular.element(t).attr("data-chartid",i)),"[data-chartid="+i+"]"},e.initializeLegendMargin=function(e,t){var i=e.$eval(t.legendmargin)||{left:0,top:5,bottom:5,right:0};"object"!=typeof i&&(i={left:i,top:i,bottom:i,right:i}),e.legendmargin=i},e.defaultColor=function(){var e=d3.scale.category20().range();return function(t,i){return t.color||e[i%e.length]}},e.configureLegend=function(t,i,r){t.legend&&r.showlegend&&"true"===r.showlegend&&(e.initializeLegendMargin(i,r),t.legend.margin(i.legendmargin),t.legend.width(void 0===r.legendwidth?400:+r.legendwidth),t.legend.height(void 0===r.legendheight?20:+r.legendheight),t.legend.key(void 0===r.legendkey?function(e){return e.key}:i.legendkey()),t.legend.color(void 0===r.legendcolor?e.defaultColor():i.legendcolor()),t.legend.align(void 0===r.legendalign?!0:"true"===r.legendalign),t.legend.rightAlign(void 0===r.legendrightalign?!0:"true"===r.legendrightalign),t.legend.updateState(void 0===r.legendupdatestate?!0:"true"===r.legendupdatestate),t.legend.radioButtonMode(void 0===r.legendradiobuttonmode?!1:"true"===r.legendradiobuttonmode))},e.checkElementID=function(t,i,r,a,n){e.configureLegend(a,t,i);var o=e.getD3Selector(i,r);angular.isArray(n)&&0===n.length&&d3.select(o+" svg").remove(),d3.select(o+" svg").empty()&&d3.select(o).append("svg"),d3.select(o+" svg").attr("viewBox","0 0 "+t.width+" "+t.height).datum(n).transition().duration(void 0===i.transitionduration?250:+i.transitionduration).call(a)},e.updateDimensions=function(t,i,r,a){if(a){a.width(t.width).height(t.height);var n=e.getD3Selector(i,r);d3.select(n+" svg").attr("viewBox","0 0 "+t.width+" "+t.height),e.windowResize(a),t.chart.update()}},e}();e.ChartHelpers=t}(Charts||(Charts={}));var Charts;!function(e){"use strict";var t="csWeb.charts";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("sparklineChart",["$filter",function(t){return{terminal:!0,restrict:"EA",scope:{timestamps:"=",sensor:"=",showaxis:"=",width:"@",height:"@",margin:"@"},link:function(t,i,r){for(var a=t.margin||{top:15,right:5,bottom:0,left:10},n=t.width||100,o=t.height||70,s="undefined"!=typeof t.showaxis&&t.showaxis,l=12,c=d3.select(i[0]).append("svg:svg").attr("width",n).attr("height",o),p=s?{top:0,right:0,bottom:20,left:10}:{top:0,right:0,bottom:0,left:0},u=d3.scale.linear().range([a.left+p.left,n-a.left-a.right-p.left-p.right]),d=d3.scale.linear().range([o-a.bottom-p.bottom,a.top+p.top+l]),h=d3.bisector(function(e){return e.time}).left,f=d3.svg.line().interpolate("cardinal").x(function(e){return u(e.time)}).y(function(e){return d(e.measurement)}),m=[],g=0;g<t.timestamps.length;g++)m.push({time:t.timestamps[g],measurement:t.sensor[g]});u.domain(d3.extent(m,function(e){return e.time})),d.domain(d3.extent(m,function(e){return e.measurement}));var v=c.append("svg:path").attr("d",f(m)).attr("class","sparkline-path"),y=m.map(function(e){return e.measurement}),b=e.ChartHelpers.min(y),S=e.ChartHelpers.max(y);if(c.append("circle").attr("class","sparkcircle-max").attr("cx",u(m[S.maxIndex].time)).attr("cy",d(S.max)).attr("r",4),c.append("circle").attr("class","sparkcircle-min").attr("cx",u(m[b.minIndex].time)).attr("cy",d(b.min)).attr("r",4),s){var w=6,M=d3.min(u.range()),x=M-w,$=d3.max(u.range()),T=d3.max(d.range()),E=d3.min(d.range()),L=T+w;c.append("line").attr("x1",x).attr("y1",E).attr("x2",M).attr("y2",E).attr("stroke","black"),c.append("text").attr("x",x-2).attr("y",E).attr("dy",".35em").style("text-anchor","end").text(d3.max(d.domain())),c.append("line").attr("x1",x).attr("y1",T).attr("x2",M).attr("y2",T).attr("stroke","black"),c.append("text").attr("x",x-2).attr("y",T).attr("dy",".35em").style("text-anchor","end").text(d3.min(d.domain())),c.append("line").attr("x1",M).attr("y1",L).attr("x2",M).attr("y2",T).attr("stroke","black"),c.append("text").attr("x",M).attr("y",L+9).attr("dy",".35em").style("text-anchor","start").text(e.ChartHelpers.timestampToString(d3.min(u.domain()))),c.append("line").attr("x1",$).attr("y1",L).attr("x2",$).attr("y2",T).attr("stroke","black"),c.append("text").attr("x",$).attr("y",L+9).attr("dy",".35em").style("text-anchor","end").text(e.ChartHelpers.timestampToString(d3.max(u.domain())))}var C=c.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0).attr("opacity",0).attr("stroke","black"),k=c.append("text").attr("x",0).attr("y",0).attr("dy",".35em").attr("opacity",0).style("text-anchor","end").text(""),F=c.append("text").attr("x",0).attr("y",0).attr("dy",".35em").attr("opacity",0).text(""),I=v.node(),O=I.getTotalLength();c.on("mouseout",function(){C.attr("opacity",0),k.attr("opacity",0),F.attr("opacity",0)}).on("mousemove",function(){for(var t,r=i[0].getBoundingClientRect().left,a=d3.event.clientX-r,n=a,o=O;;){t=Math.floor((n+o)/2);var s=I.getPointAtLength(t);if((t===o||t===n)&&s.x!==a)break;if(s.x>a)o=t;else{if(!(s.x<a))break;n=t}}var l=u.invert(d3.mouse(this)[0]),c=h(m,l,1);if(c>0&&c<m.length)var p=m[c-1],f=m[c],g=l-p.time>f.time-l?f:p;else g=0>=c?m[0]:m[m.length-1];a=u(g.time),C.attr("x1",a).attr("y1",0).attr("x2",a).attr("y2",d3.max(d.range())+(w||0)).attr("opacity",1),k.attr("x",a-6).attr("y",4).attr("dy",".35em").attr("opacity",1).text(e.ChartHelpers.timestampToString(g.time)),F.attr("x",a+6).attr("y",4).attr("dy",".35em").attr("opacity",1).text(g.measurement)})}}}]).directive("barChart",["$filter",function(e){return{terminal:!0,restrict:"EA",scope:{data:"="},link:function(e,t,i){var r=d3.select(t[0]);r.append("div").attr("class","chart").selectAll("div").data(e.data).enter().append("div").transition().ease("elastic").style("width",function(e){return e+"%"}).text(function(e){return e+"%"})}}}])}(Charts||(Charts={}));var Dashboard;!function(e){e.html='<div gridster="gridsterOptions" style="width:1024px; height:100%;pointer-events: none;margin-top:-10px;">    <div  style="position:relative;width:100%; height:100%;pointer-events: none">        <ul style="padding:0;pointer-events: none">            <li gridster-item="widget" ng-repeat="widget in dashboard.widgets" class="widget-parent">                                 <!--<div class="widget-title" ng-click="widget.collapse=!widget.collapse" ><span class="fa fa-area-chart" style="float:left;margin-right:4px"></span>{{widget.title}}</div>-->                <!--<div class="widget-edit" style="z-index: 1000">                    <div ng-show="widget.dashboard.editMode" ng-click="vm.$dashboardService.editWidget(widget)" class="fa fa-pencil widget-button"></div>                    <div ng-hide="widget.collapse" ng-click="widget.collapse=true"  class="fa fa-minus-square-o widget-button"></div>                    <div ng-show="widget.collapse" ng-click="widget.collapse=false"  class="fa fa-plus-square-o widget-button"></div>                    <div ng-show="widget.allowFullscreen" ng-click="vm.popup(widget)"  class="fa fa-square-o widget-button"></div>                </div>-->                    <div class="widget-container" ng-hide="widget.collapse" style="top: 0;position: absolute;width:100%;height:100%;background: white">                        <div id="{{widget.elementId}}" class="box-content" style="width:100%;height:100%">                        </div>                    </div>            </li>        </ul>    </div></div>'}(Dashboard||(Dashboard={}));var Dashboard;!function(e){var t="csWeb.dashboardirective";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("dashboardirective",["$window","$compile",function(t,i){return{terminal:!1,restrict:"E",scope:{container:"="},template:e.html,link:function(e,i,r){angular.element(t).bind("resize",function(){e.$apply()}),e.container=r.container,e.initDashboard()},replace:!1,transclude:!0,controller:e.DashboardCtrl}}])}(Dashboard||(Dashboard={}));var Dashboard;!function(e){var t=function(){function e(e,t,i,r,a,n){var o=this;this.$scope=e,this.$compile=t,this.$layerService=i,this.$mapService=r,this.$messageBusService=a,this.$templateCache=n,e.vm=this,e.gridsterOptions={margins:[10,10],columns:20,rows:20,draggable:{enabled:!0},resizable:{enabled:!0,start:function(e,t,i){i.resize("start",t.width(),t.height())},stop:function(e,t,i){i.resize("stop",t.width(),t.height())},resize:function(e,t,i){i.resize("change",t.width(),t.height())}}},e.initDashboard=function(){a.subscribe("dashboard-"+e.container,function(t,r){switch(o.project=i.project,o.project.activeDashboard=r,t){case"activated":e.dashboard=r,o.updateDashboard()}})}}return e.prototype.toggleWidget=function(e){e.canCollapse&&(e.collapse=!e.collapse)},e.prototype.updateWidget=function(e){var t,i=this.$scope;i.data="test",t=e.template?this.$compile(this.$templateCache.get(e.template))(i):e.url?this.$compile("<div>url</div>")(this.$scope):e.directive?this.$compile("<"+e.directive+" widget="+e+"></"+e.directive+">")(i):this.$compile("<h1>hoi</h1>")(this.$scope);var r=function(){};if(t){t.resize(r);var a=$("#"+e.elementId);a.empty(),a.append(t)}},e.prototype.checkMap=function(){this.$scope.dashboard.showMap!=this.$layerService.visual.mapVisible&&(this.$layerService.visual.mapVisible=this.$scope.dashboard.showMap?!0:!1,"$apply"!=this.$scope.$root.$$phase&&"$digest"!=this.$scope.$root.$$phase&&this.$scope.$apply())},e.prototype.checkLayers=function(){var e=this,t=this.$layerService.project.activeDashboard;t.visiblelayers&&this.$layerService.project.groups.forEach(function(i){i.layers.forEach(function(i){i.enabled&&-1==t.visiblelayers.indexOf(i.reference)&&(e.$layerService.removeLayer(i),i.enabled=!1),!i.enabled&&t.visiblelayers.indexOf(i.reference)>=0&&(e.$layerService.activeMapRenderer.addLayer(i),i.enabled=!0)})})},e.prototype.checkViewbound=function(){var e=this.$layerService.project.activeDashboard;e.viewBounds&&this.$mapService.map.fitBounds(new L.LatLngBounds(e.viewBounds.southWest,e.viewBounds.northEast))},e.prototype.checkTimeline=function(){this.$scope.dashboard.showTimeline!=this.$mapService.timelineVisible&&(this.$mapService.timelineVisible=this.$scope.dashboard.showTimeline?!0:!1,"$apply"!=this.$scope.$root.$$phase&&"$digest"!=this.$scope.$root.$$phase&&this.$scope.$apply())},e.prototype.updateDashboard=function(){var e=this,t=this.$scope.dashboard;t&&(t.widgets&&t.widgets.length>0&&setTimeout(function(){t.widgets.forEach(function(t){e.updateWidget(t)})},100),this.checkMap(),this.checkTimeline(),this.checkLayers(),this.checkViewbound(),this.$messageBusService.publish("leftmenu",t.showLeftmenu?"show":"hide"),this.$mapService.rightMenuVisible=t.showRightmenu)},e.$inject=["$scope","$compile","layerService","mapService","messageBusService","$templateCache"],e}();e.DashboardCtrl=t}(Dashboard||(Dashboard={}));var DashboardSelection;!function(e){e.html='<div>    <h3 class="leftpanel-header" style="width: 100%">        Dashboards        <div class="leftpanel-header-button-container">            <button ng-show="vm.$dashboardService.editMode" ng-click="vm.$dashboardService.editMode = false; vm.stopEdit()" class="button fa fa-check leftpanel-header-button" />            <button ng-show="vm.$dashboardService.editMode" class="button fa fa-plus leftpanel-header-button" ng-click="vm.addDashboard()" />            <button ng-hide="vm.$dashboardService.editMode" ng-click="vm.$dashboardService.editMode = true; vm.startEdit()" class="button fa fa-pencil leftpanel-header-button" />                     </div>    </h3>    <style>    </style>    <ul style="padding: 0;list-style-type: none" data-ng-repeat="value in vm.$layerService.project.dashboards">        <li>            <div ng-class="{\'dashboard-selected\' : value.id === vm.$dashboardService.mainDashboard.id}" class="dashboard-item">                <span ng-click="vm.$dashboardService.selectDashboard(value)" class="dashboard-name">{{value.name}}</span>                <div ng-show="vm.$dashboardService.editMode" class="leftpanel-header-button-container">                    <button ng-click="vm.removeDashboard(value.id)" class="button fa fa-trash leftpanel-header-button" />                    <div ng-show="value == vm.$dashboardService.mainDashboard" style="float:right">                        <button ng-hide="value.editMode" ng-click="value.editMode = true; vm.startDashboardEdit(value)" class="button fa fa-pencil leftpanel-header-button" />                        <button ng-show="value.editMode" ng-click="value.editMode = false" class="button fa fa-check leftpanel-header-button" />                    </div>                </div>            </div>            <div style="margin-top:0" ng-show="value.editMode">                <label class="control-label" for="dashboardTitle">Title</label>                <div class="controls">                    <input id="dashboardTitle" name="textinput" type="text" ng-model="value.name" placeholder="placeholder" class="input-xlarge">                </div>                <div class="checkbox" style="margin-left: 20px">                     <input type="checkbox" id="showmap-{{value.id}}" ng-model="value.showMap" ng-click="vm.toggleMap()">                    <label for="showmap-{{value.id}}">Show Map</label>                </div>                <div class="checkbox" style="margin-left: 20px">                    <input type="checkbox" id="timeline-{{value.id}}" ng-model="value.showTimeline" ng-click="vm.toggleTimeline()">                    <label for="timeline-{{value.id}}">Show Timeline</label>                </div>            </div>        </li>    </ul></div>'}(DashboardSelection||(DashboardSelection={}));var DashboardSelection;!function(e){var t="csWeb.dashboardSelection";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("dashboardSelection",["$window","$compile",function(t,i){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e,i,r){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.DashboardSelectionCtrl}}]).directive("bsPopover",function(){return function(e,t,i){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(DashboardSelection||(DashboardSelection={}));var DashboardSelection;!function(e){var t=function(){function e(e,t,i,r){this.$scope=e,this.$layerService=t,this.$mapService=i,this.$messageBusService=r,e.vm=this}return e.prototype.startDashboardEdit=function(e){},e.prototype.stopEdit=function(){},e.prototype.startEdit=function(){},e.prototype.addDashboard=function(e){var t=csComp.Helpers.getGuid(),i=new csComp.Services.Dashboard;i.id=t,i.name="New Dashboard"},e.prototype.removeDashboard=function(e){},e.prototype.toggleTimeline=function(){this.checkTimeline()},e.prototype.toggleMap=function(){setTimeout(function(){},100)},e.prototype.checkTimeline=function(){var e=this.$layerService.project.activeDashboard;if(e.timeline){var t=new Date(e.timeline.start),i=new Date;e.timeline.end&&(i=new Date(e.timeline.end)),this.$messageBusService.publish("timeline","updateTimerange",{start:t,end:i})}e.showTimeline!=this.$mapService.timelineVisible&&(this.$mapService.timelineVisible=e.showTimeline?!0:!1,"$apply"!=this.$scope.$root.$$phase&&"$digest"!=this.$scope.$root.$$phase&&this.$scope.$apply())},e.prototype.publishDashboardUpdate=function(){this.$messageBusService.publish("dashboard","onDashboardSelected",this.$layerService.project.activeDashboard)},e.prototype.selectDashboard=function(e){var t=this;for(var i in this.$layerService.project.dashboards)this.$layerService.project.dashboards[i].editMode=!1;e&&("$apply"!=this.$scope.$root.$$phase&&"$digest"!=this.$scope.$root.$$phase&&this.$scope.$apply(),setTimeout(function(){t.publishDashboardUpdate()},100))},e.$inject=["$scope","layerService","dashboardService","mapService","messageBusService"],e}();e.DashboardSelectionCtrl=t}(DashboardSelection||(DashboardSelection={}));var DataTable;!function(e){e.html='<div>    <div style="width:100%; margin: 10px auto;">        <div style="float: left; width: 15%; margin: 0; padding: 1em">            <!-- Pull down of map layers -->            <select data-ng-model="vm.selectedLayerId"                    data-ng-change="vm.loadLayer()"                    data-ng-options="layer.id as layer.title group by layer.group for layer in vm.layerOptions"                    class="form-control tt-input"></select>            <!-- List of headers -->            <ul class="form-group" style="margin-top: 1em; margin-left: -2em; overflow-y: auto; overflow-x: hidden;"                resize resize-y="150">                <li ng-repeat="mi in vm.propertyTypes" class="list-unstyled" style="white-space: nowrap; text-overflow: ellipsis">                    <label>                        <input type="checkbox" name="vm.selectedTitles[]" value="{{mi.title}}"                               data-ng-checked="vm.headers.indexOf(mi.title) > -1"                               data-ng-click="vm.toggleSelection(mi.title)">&nbsp;&nbsp;{{mi.title}}                    </label>                    <!--<div class="checkbox">                        <label>                            <input type="checkbox" name="vm.selectedTitles[]" value="{{mi.title}}"                                   data-ng-checked="vm.headers.indexOf(mi.title) > -1"                                   data-ng-click="vm.toggleSelection(mi.title)">&nbsp;&nbsp;{{mi.title}}                        </label>                    </div>-->                </li>            </ul>            <!--       <pre>{{vm.headers|json}}</pre>-->        </div>        <!-- Right side of the table view -->        <div style="margin-left: 16%; border-left: 1px solid gray; padding: 1em;" ng-init="poiTypeFilter">            <!-- Filter -->            <div class="has-feedback" style="margin-bottom: 1em; float: right; width: 16%; min-width: 200px;">                <span style="direction: ltr; position: static; display: block;">                    <input id="searchbox" data-ng-model="featureFilter" type="text"                           placeholder="Filter" autocomplete="off" spellcheck="false"                           style="position: relative; vertical-align: top;" class="form-control tt-input">                </span>                <span id="searchicon" class="fa form-control-feedback fa-filter" style="padding-top: 0px;"></span>            </div>            <!--Download to CSV option-->            <a href="" data-ng-click="vm.downloadCsv()" alt="Download CSV" style="margin-top: 5px; margin-right: 1em; float: right;"><i class="fa fa-download fa-2x"></i></a>            <!-- Specify how many items to show -->            <select data-ng-model="vm.numberOfItems" style="margin-bottom: 1em; margin-right: 10px; float: left; width: 16%; min-width: 200px;" class="form-control tt-input">                <option value="5" translate="SHOW5"></option>                <option value="10" translate="SHOW10"></option>                <option value="15" translate="SHOW15"></option>                <option value="20" translate="SHOW20"></option>                <option value="25" translate="SHOW25"></option>                <option value="30" translate="SHOW30"></option>                <option value="35" translate="SHOW35"></option>                <option value="40" translate="SHOW40"></option>            </select>            <!-- Data table -->            <table class="table table-striped table-condensed">                <tr>                    <th data-ng-repeat="header in vm.headers track by $index">                        {{header}}&nbsp;                        <a data-ng-click="reverseSort = !reverseSort; vm.orderBy($index, reverseSort);"><i data-ng-class="vm.sortOrderClass($index, reverseSort)">&nbsp;&nbsp;</i></a>                    </th>                </tr>                <tr dir-paginate="row in vm.rows | filter:featureFilter | itemsPerPage: vm.numberOfItems"                    style="cursor: pointer; vertical-align: central">                    <td data-ng-class="{\'text-right\': field.type == \'number\'}" data-ng-repeat="field in row track by $index" data-ng-bind-html="vm.toTrusted(field.displayValue)"></td>                </tr>            </table>            <dir-pagination-controls style="" max-size="10" boundary-links="true" direction-links="true"                                     template-url="bower_components/angular-utils-pagination/dirPagination.tpl.html"></dir-pagination-controls>        </div>    </div>    <div style="clear: both; margin: 0; padding: .5em"></div></div>'}(DataTable||(DataTable={}));var DataTable;!function(e){var t="csWeb.datatable";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("datatable",["$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,replace:!0,transclude:!0,controller:e.DataTableCtrl}}])}(DataTable||(DataTable={}));var DataTable;!function(e){var t=function(){function e(e,t,i,r){this.displayValue=e,this.originalValue=t,this.type=i,this.header=r}return e}();e.TableField=t;var i=function(){function e(e,t,i,r,a,n,o){var s=this;this.$scope=e,this.$http=t,this.$sce=i,this.$translate=r,this.$layerService=a,this.$localStorageService=n,this.$messageBusService=o,this.mapLabel="map",this.numberOfItems=10,this.layerOptions=[],this.propertyTypes=[],this.headers=[],this.rows=[],e.vm=this,r("MAP_FEATURES").then(function(e){s.layerOptions[0].title=e}),this.bindToStorage("vm.numberOfItems",10),this.numberOfItems=n.get("vm.numberOfItems"),this.bindToStorage("vm.selectedLayerId",this.mapLabel),null!=this.$layerService.project&&null!=this.$layerService.project.groups&&(this.updateLayerOptions(),this.loadLayer(),o.publish("timeline","isEnabled","false"))}return e.prototype.bindToStorage=function(e,t){null===this.$localStorageService.get(e)&&this.$localStorageService.set(e,t),this.$localStorageService.bind(this.$scope,e)},e.prototype.updateLayerOptions=function(){var e=this;this.layerOptions.push({group:"",id:this.mapLabel,title:this.mapFeatureTitle}),null!=this.$layerService.project&&null!=this.$layerService.project.groups&&(this.$layerService.project.groups.forEach(function(t){t.layers.forEach(function(i){e.layerOptions.push({group:t.title,id:i.id,title:i.title})})}),this.selectedLayerId=this.$localStorageService.get("vm.selectedLayerId"))},e.prototype.loadLayer=function(){var e=this;if(!this.selectedLayerId||this.selectedLayerId===this.mapLabel)return this.loadMapLayers();var t=this.findLayerById(this.selectedLayerId);return null==t?this.loadMapLayers():void this.$http.get(t.url).success(function(t){e.dataset=t,null==t.featureTypes&&(t.featureTypes={}),t.features.forEach(function(i){i.featureTypeName=i.properties.FeatureTypeId,i.featureTypeName in t.featureTypes||(t.featureTypes[i.featureTypeName]=e.$layerService.featureTypes[i.featureTypeName])}),e.updatepropertyType(t)}).error(function(i,r,a,n){e.$messageBusService.notify("ERROR opening "+t.title,"Could not get the data.")})},e.prototype.loadMapLayers=function(){var e=this;this.selectedLayerId=this.mapLabel;var t={type:"",features:[],featureTypes:{}};this.$layerService.project.groups.forEach(function(e){null!=e.filterResult&&e.filterResult.forEach(function(e){return t.features.push(e)})}),0===t.features.length&&(t.features=this.$layerService.project.features),t.features.forEach(function(i){i.featureTypeName in t.featureTypes||(t.featureTypes[i.featureTypeName]=e.$layerService.featureTypes[i.featureTypeName])}),this.dataset=t,this.updatepropertyType(t)},e.prototype.updatepropertyType=function(e){var t=this;this.propertyTypes=[],this.headers=[],this.rows=[];var i=[],r=[];r.push({label:"Name",visibleInCallOut:!0,title:"Naam",type:"text",filterType:"text",isSearchable:!0});var a;for(var n in e.featureTypes){if(a=e.featureTypes[n],null!=a.propertyTypeKeys){var o=a.propertyTypeKeys.split(";");o.forEach(function(e){if(e in t.$layerService.propertyTypeData)r.push(t.$layerService.propertyTypeData[e]);else if(null!=a.propertyTypeData){var i=$.grep(a.propertyTypeData,function(t){return t.label===e});i.length>=1&&r.push(i)}})}else null!=a.propertyTypeData&&a.propertyTypeData.forEach(function(e){
return r.push(e)});r.forEach(function(e){(e.visibleInCallOut||"Name"===e.label)&&i.indexOf(e.title)<0&&(i.push(e.title),t.propertyTypes.push(e))})}for(var s=3,l=0;s>l;l++)this.headers.push(i[l]);this.rows=this.getRows()},e.prototype.toggleSelection=function(e){var t=this.headers.indexOf(e);t>-1?this.headers.splice(t,1):this.headers.push(e),this.rows=this.getRows()},e.prototype.findLayerById=function(e){for(var t=0;t<this.$layerService.project.groups.length;t++)for(var i=this.$layerService.project.groups[t],r=0;r<i.layers.length;r++){var a=i.layers[r];if(a.id==e)return a}return null},e.prototype.getRows=function(){var e=this,i=[this.headers.length];this.propertyTypes.forEach(function(t){var r=e.headers.indexOf(t.title);r>=0&&(i[r]=t)});var r,a=[];return this.dataset.features.forEach(function(e){var n=[];i.forEach(function(i){var a=e.properties[i.label];r=csComp.Helpers.convertPropertyInfo(i,a),n.push(new t(r,a,i.type,i.title))}),a.push(n)}),a},e.prototype.sortOrderClass=function(e,t){var i;return i=null!=t&&e==this.sortingColumn?"fa fa-sort-"+(t?"desc":"asc"):"fa fa-sort"},e.prototype.orderBy=function(e,t){this.sortingColumn=e,this.rows=this.rows.sort(function(i,r){var a;return a="number"==i[e].type?i[e].originalValue>r[e].originalValue:i[e].originalValue.toLowerCase()>r[e].originalValue.toLowerCase(),a==t?1:-1})},e.prototype.downloadCsv=function(){var e=[];e.push(this.headers.join(";"));for(var t=0;t<this.rows.length;t++)e.push(this.rows[t].map(function(e){return e.originalValue}).join(";"));var i=e.join("\r\n"),r=this.mapLabel;if(this.selectedLayerId!==this.mapLabel){var a=this.findLayerById(this.selectedLayerId);a&&(r=a.title.replace(" ","_"))}this.saveData(i,r+".csv")},e.prototype.saveData=function(e,t){if(navigator.msSaveBlob){var i=document.createElement("a");i.addEventListener("click",function(i){var r=new Blob([e],{type:"text/csv;charset=utf-8;"});navigator.msSaveBlob(r,t)},!1),document.body.appendChild(i),i.click(),document.body.removeChild(i)}else if(csComp.Helpers.supportsDataUri()){var r=document.createElement("a");document.body.appendChild(r),r.href="data:text/csv;charset=utf-8,"+encodeURI(e),r.target="_blank",r.download=t,r.click(),document.body.removeChild(r)}else{var a=window.open("","csv","");a.document.body.innerHTML="<pre>"+e+"</pre>"}},e.prototype.toTrusted=function(e){try{return this.$sce.trustAsHtml(void 0===e||null===e?e:e.toString())}catch(t){return console.log(t+": "+e),""}},e.$inject=["$scope","$http","$sce","$translate","layerService","localStorageService","messageBusService"],e}();e.DataTableCtrl=i}(DataTable||(DataTable={}));var ExpertMode;!function(e){e.html='<div class="navbar-collapse collapse"     tooltip-html-unsafe="{{\'EXPERTMODE.EXPLANATION\' | translate}}"     tooltip-placement="left"     tooltip-trigger="mouseenter"     tooltip-append-to-body="false">    <ul class="nav navbar-nav">        <li class="dropdown">            <a href=""               class="navbar-brand dropdown-toggle pull-left"               data-toggle="dropdown"               style="color:white; margin-left:-10px;">                <div class="circle"><span data-ng-class="vm.getCssClass()" style="width: 32px; height: 32px"></span></div>            </a>            <ul class="dropdown-menu" role="menu">                <li>                    <a data-ng-click="vm.setExpertMode(1)">                        <span class="beginnerUserIcon" style="margin-left: -10px; width: 40px; height: 32px"></span>                        <div translate>EXPERTMODE.BEGINNER</div>                    </a>                </li>                <li>                    <a data-ng-click="vm.setExpertMode(2)">                        <span class="intermediateUserIcon" style="margin-left: -10px; width: 40px; height: 32px"></span>                        <div translate>EXPERTMODE.INTERMEDIATE</div>                    </a>                </li>                <li>                    <a data-ng-click="vm.setExpertMode(3)">                        <span class="expertUserIcon" style="margin-left: -10px; width: 40px; height: 32px"></span>                        <div translate>EXPERTMODE.EXPERT</div>                    </a>                </li>            </ul>        </li>    </ul></div>'}(ExpertMode||(ExpertMode={}));var ExpertMode;!function(e){var t="csWeb.expertMode";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("expertMode",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.ExpertModeCtrl}}])}(ExpertMode||(ExpertMode={}));var ExpertMode;!function(e){var t=(csComp.Services.Expertise,function(){function e(e,t,i,r,a){var n=this;this.$scope=e,this.$localStorageService=t,this.$layerService=i,this.$mapService=r,this.$messageBus=a,e.vm=this,e.expertMode=r.expertMode,a.subscribe("expertMode",function(t,i){"newExpertise"===t&&(e.expertMode=i)}),e.$watch("expertMode",function(){n.setExpertMode(e.expertMode)})}return e.prototype.getCssClass=function(){switch(this.$mapService.expertMode){case 1:return"beginnerUserIcon";case 2:return"intermediateUserIcon";case 3:return"expertUserIcon"}},e.prototype.setExpertMode=function(e){this.$messageBus.publish("expertMode","newExpertise",e)},e.$inject=["$scope","localStorageService","layerService","mapService","messageBusService"],e}());e.ExpertModeCtrl=t}(ExpertMode||(ExpertMode={}));var FeatureList;!function(e){e.html='<div style="position: relative;">    <h4 class="leftpanel-header" translate="FEATURES"></h4>    <div class="has-feedback" style="padding:10px 4px 4px 4px;">        <span style="direction: ltr; position: static; display: block;">            <input id="searchbox" data-ng-model="featureFilter.properties" type="text"                   placeholder="Filter" autocomplete="off" spellcheck="false"                   style="position: relative; vertical-align: top;" class="form-control tt-input">        </span>        <span id="searchicon" class="fa form-control-feedback fa-filter" style="padding-top: 10px;"></span>    </div>    <table class="table table-striped table-condensed">        <!--vm.$layerService.features-->        <tr dir-paginate="feature in vm.$layerService.project.features | filter:featureFilter | orderBy:\'properties.Name\' | itemsPerPage: numberOfItems "            data-ng-click="vm.$mapService.zoomTo(feature);vm.$layerService.selectFeature(feature);" style="cursor: pointer; height: 50px; vertical-align: central">            <!--<td>Icon</td>-->            <td>{{ feature.properties.Name }}</td>            <td>                <i class="fa fa-chevron-right pull-right"></i>            </td>        </tr>    </table>    <dir-pagination-controls style="position: absolute; bottom: -80px;" max-size="6" boundary-links="false" direction-links="false" template-url="bower_components/angular-utils-pagination/dirPagination.tpl.html"></dir-pagination-controls></div>'}(FeatureList||(FeatureList={}));var FeatureList;!function(e){var t="csWeb.featureList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("featureList",["$window","$compile",function(t,i){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e,i,r){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.FeatureListCtrl}}]).directive("bsPopover",function(){return function(e,t,i){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(FeatureList||(FeatureList={}));var FeatureList;!function(e){var t=function(){function e(e,t,i){this.$scope=e,this.$layerService=t,this.$mapService=i,e.vm=this,e.numberOfItems=10}return e.$inject=["$scope","layerService","mapService"],e}();e.FeatureListCtrl=t}(FeatureList||(FeatureList={}));var FeatureProps;!function(e){e.html='<div data-ng-cloak data-ng-show="showMenu" >    <h4 class="rightpanel-header">        <img data-ng-if="callOut.icon" data-ng-src="{{callOut.icon}}" width="24" height="24" style="margin-left:5px" alt="Icon" />        &nbsp;&nbsp;{{callOut.title}}    </h4>    <div class="container-fluid rightpanel-tabs" style="position: relative">        <div class="row" style="overflow:hidden" ng-if="callOut.sectionCount() < 4">            <!-- Nav tabs -->            <span id="leftArr" style="display:block;padding:10px;margin-top:5px;position:absolute;background-color:transparent;z-index:2">                <i class="glyphicon glyphicon-chevron-left"></i>            </span>            <span id="rightArr" style="display:block;padding:10px;margin-top:5px;position:absolute;background-color:transparent;z-index:2">                <i class="glyphicon glyphicon-chevron-right"></i>            </span>            <ul class="nav nav-tabs" id="featureTabs" style="margin-left:10px">                <li data-toggle="tab" data-ng-class="{active : $first}" data-ng-repeat="(sectionTitle, section) in callOut.sections" ng-if="section.hasProperties()">                    <a ng-href="#rp-{{$index}}" data-toggle="tab" data-ng-if="section.showSectionIcon()" ng-click="featureTabActivated(sectionTitle, section)"><i class="fa {{section.sectionIcon}}"></i></a>                    <a ng-href="#rp-{{$index}}" data-toggle="tab" data-ng-if="!section.showSectionIcon()" ng-click="featureTabActivated(sectionTitle, section)">{{sectionTitle}}</a>                </li>            </ul>        </div>        <div class="row" ng-if="callOut.sectionCount() >= 4">            <ul class="nav nav-tabs" id="featureTabs" style="margin-left:10px">                <li data-toggle="tab" class="active" ng-init="firstCallOutsection=callOut.firstSection()">                    <a ng-href="#rp-0" data-toggle="tab" data-ng-if="firstCallOutsection.showSectionIcon()" ><i class="fa {{firstCallOutsection.sectionIcon}}"></i></a>                </li>                <li class="dropdown" ng-init="selectedSection.title=\'Kies een categorie\'">                    <a style="cursor:pointer" data-toggle="dropdown">{{selectedSection.title}} <span class="caret"/></a>                    <ul class="dropdown-menu">                        <li data-ng-repeat="(sectionTitle, section) in callOut.sections" ng-if="!$last && !$first"><a ng-href="#rp-{{$index}}" ng-click="selectedSection.title = sectionTitle" data-toggle="tab">{{sectionTitle}}</a></li>                    </ul>                </li>                <li data-toggle="tab" ng-init="lastCallOutsection=callOut.lastSection()">                    <a ng-href="#rp-{{callOut.sectionCount()-1}}" data-toggle="tab" data-ng-if="lastCallOutsection.showSectionIcon()"><i class="fa {{lastCallOutsection.sectionIcon}}"></i></a>                </li>            </ul>        </div>    </div>    <div class="tab-content" style="top:50px; width:355px; overflow-y: auto; overflow-x: hidden" resize resize-y="150">        <div data-ng-if="!$last" class="tab-pane" data-ng-class="{active : $first}" id="rp-{{$index}}" data-ng-repeat="(sectionTitle, section) in callOut.sections">            <table class="table table-condensed">                <tr popover="{{(item.description) ? item.description : \'\'}}"                    popover-placement="left"                    popover-trigger="mouseenter"                    popover-append-to-body="true"                    data-ng-repeat="item in section.properties">                    <!--<td>                        <span class="dropdown">                            <a href class="fa fa-circle-o makeNarrow dropdown-toggle"></a>                            <ul class="dropdown-menu">                                <li><a data-ng-click="vm.$layerService.createScatter(item)">scatter plot</a></li>                                <li><a>add to dashboard</a></li>                            </ul>                        </span>                    </td>-->                    <td><a class="fa fa-filter makeNarrow" data-ng-show="item.canFilter" data-ng-click="vm.$layerService.setPropertyFilter(item)" style="cursor: pointer"></a></td>                    <td><a class="fa fa-eyedropper makeNarrow" data-ng-show="item.canStyle" data-ng-click="vm.$layerService.setStyle(item)" style="cursor: pointer"></a></td>                    <td>                        {{item.key}}                    </td>                    <td class="text-right" data-ng-bind-html="vm.toTrusted(item.value)"></td>                </tr>            </table>        </div>        <!-- Treat last tab (filter) differently -->        <div data-ng-if="$last" class="tab-pane" data-ng-class="{active : $first}" id="rp-{{$index}}" data-ng-repeat="(sectionTitle, section) in callOut.sections">            <!-- Add filter panel to the last rendered element -->            <div class="has-feedback" style="padding:0 4px 4px 4px;">                <span style="direction: ltr; position: static; display: block;">                    <input id="searchbox" data-ng-model="search.key" type="text"                            placeholder="Filter" autocomplete="off" spellcheck="false"                            style="position: relative; vertical-align: top;" class="form-control tt-input">                </span>                <span id="searchicon" class="fa form-control-feedback fa-filter"></span>            </div>            <!--<input style="padding:4px;" class=" form-control" data-ng-model="search" placeholder="...">-->            <table id="searchTextResults" class="table table-condensed">                <tr popover="{{(item.description) ? item.description : \'\'}}"                    popover-placement="left"                    popover-trigger="mouseenter"                    popover-append-to-body="true"                    data-ng-repeat="item in section.properties | filter:search">                    <td><a class="fa fa-filter makeNarrow" data-ng-show="item.canFilter" data-ng-click="vm.$layerService.setPropertyFilter(item)"></a></td>                    <td><a class="fa fa-eye makeNarrow" data-ng-show="item.canStyle" data-ng-click="vm.$layerService.setStyle(item)"></a></td>                    <td>{{item.key}}</td>                    <td class="text-right" data-ng-bind-html="vm.toTrusted(item.value)"></td>                </tr>            </table>        </div>    </div></div>'}(FeatureProps||(FeatureProps={}));var FeatureProps;!function(e){var t="csWeb.featureprops";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("featureprops",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.FeaturePropsCtrl}}])}(FeatureProps||(FeatureProps={}));var FeatureProps;!function(e){var t=(function(){function e(e){this.position=e,this.closeButton=!0,this.autoPan=!0}return e}(),function(){function e(e,t,i,r,a,n,o,s,l){this.key=e,this.value=t,this.property=i,this.canFilter=r,this.canStyle=a,this.feature=n,this.isFilter=o,this.description=s,this.meta=l}return e}());e.CallOutProperty=t;var i=function(){function e(e){this.propertyTypes={},this.properties=[],this.sectionIcon=e}return e.prototype.showSectionIcon=function(){return!csComp.StringExt.isNullOrEmpty(this.sectionIcon)},e.prototype.addProperty=function(e,i,r,a,n,o,s,l,c){this.properties.push(new t(e,i,r,a,n,o,s,l?l:null,c))},e.prototype.hasProperties=function(){return null!=this.properties&&this.properties.length>0},e}();e.CallOutSection=i;var r=function(){function e(e,t,r){var a=this;this.type=e,this.feature=t,this.propertyTypeData=r,this.sections={},this.setTitle(),this.setIcon(t);var n,o=new i("fa-info"),s=new i("fa-filter");if(null!=e){var l=csComp.Helpers.getPropertyTypes(e,r);l.forEach(function(e){var i=a.getOrCreateCallOutSection(e.section)||o;i.propertyTypes[e.label]=e;var r=t.properties[e.label];if(n=csComp.Helpers.convertPropertyInfo(e,r),e.canEdit||!csComp.StringExt.isNullOrEmpty(n)){var l="number"===e.type||"text"===e.type||"options"===e.type,c="number"===e.type||"options"===e.type||"color"===e.type;null!=e.filterType&&(l="none"!=e.filterType.toLowerCase()),e.visibleInCallOut&&i.addProperty(e.title,n,e.label,l,c,t,!1,e.description,e),s.addProperty(e.title,n,e.label,l,c,t,!1,e.description)}})}o.properties.length>0&&(this.sections["AAA Info"]=o),s.properties.length>0&&(this.sections["Zzz Search"]=s)}return e.prototype.sectionCount=function(){return Object.keys(this.sections).length},e.prototype.firstSection=function(){return this.sections[Object.keys(this.sections)[this.sectionCount()-2]]},e.prototype.lastSection=function(){return this.sections[Object.keys(this.sections)[this.sectionCount()-1]]},e.prototype.getOrCreateCallOutSection=function(e){return e?e in this.sections?this.sections[e]:(this.sections[e]=new i,this.sections[e]):null},e.prototype.setTitle=function(){this.title=e.title(this.type,this.feature)},e.prototype.setIcon=function(e){this.icon=null==this.type||null==this.type.style||!this.type.style.hasOwnProperty("iconUri")||this.type.style.iconUri.toLowerCase().indexOf("_media")>=0?"":this.type.style.iconUri.indexOf("{")>=0?csComp.Helpers.convertStringFormat(e,this.type.style.iconUri):this.type.style.iconUri},e.title=function(e,t){var i="";return null!=e&&null!=e.style&&e.style.nameLabel?i=t.properties[e.style.nameLabel]:t.properties.hasOwnProperty("Name")?i=t.properties.Name:t.properties.hasOwnProperty("name")&&(i=t.properties.name),csComp.StringExt.isNullOrEmpty(i)||$.isNumeric(i)||(i=i.replace(/&amp;/g,"&")),i},e}();e.CallOut=r;var a=function(){function e(e,t,i,r,a,n){var o=this;this.$scope=e,this.$location=t,this.$sce=i,this.$mapService=r,this.$layerService=a,this.$messageBusService=n,this.sidebarMessageReceived=function(e){switch(e){case"toggle":o.$scope.showMenu=!o.$scope.showMenu;break;case"show":o.$scope.showMenu=!0;break;case"hide":o.$scope.showMenu=!1}"$apply"!=o.$scope.$root.$$phase&&"$digest"!=o.$scope.$root.$$phase&&o.$scope.$apply()},this.featureMessageReceived=function(e,t){switch(e){case"onFeatureSelect":o.displayFeature(t),o.$scope.poi=t,o.$scope.autocollapse(!0);break;case"onFeatureUpdated":o.displayFeature(o.$layerService.lastSelectedFeature),o.$scope.poi=o.$layerService.lastSelectedFeature}"$apply"!=o.$scope.$root.$$phase&&"$digest"!=o.$scope.$root.$$phase&&o.$scope.$apply()},this.scope=e,e.vm=this,e.showMenu=!1,e.featureTabActivated=function(e,t){n.publish("FeatureTab","activated",{sectionTitle:e,section:t})},n.subscribe("sidebar",this.sidebarMessageReceived),n.subscribe("feature",this.featureMessageReceived);var s=function(){var e=0;return $("#featureTabs>li").each(function(){var t=$(this).outerWidth();e+=t}),e};e.autocollapse=function(e){void 0===e&&(e=!1);var t=$("#featureTabs");t.outerWidth()<s()||parseFloat(t.css("margin-left"))<0?($("#leftArr").show(),$("#rightArr").show(),e&&t.animate({"margin-left":"20px"},"slow")):($("#leftArr").hide(),$("#rightArr").hide(),e&&t.animate({"margin-left":"0px"},"slow"))},e.autocollapse(!0),e.tabs=$("#featureTabs"),e.tabScrollDelta=e.tabs.outerWidth(),$("#leftArr").click(function(){var t=parseFloat(e.tabs.css("margin-left")),i=20,r=e.tabScrollDelta;t+r>i&&(r=i-t),e.tabs.animate({"margin-left":"+="+r+"px"},"slow",function(){$("#rightArr").show(),$("#leftArr").show(),e.autocollapse(!1)})}),$("#rightArr").click(function(){var t=s()-e.tabs.outerWidth()+30,i=e.tabScrollDelta;i=Math.min(t,i),e.tabs.animate({"margin-left":"-="+i+"px"},"slow",function(){$("#leftArr").show(),$("#rightArr").show(),e.autocollapse(!1)})})}return e.prototype.toTrusted=function(e){try{return this.$sce.trustAsHtml(void 0===e||null===e?e:e.toString())}catch(t){return console.log(t+": "+e),""}},e.prototype.createScatter=function(e){var t=new csComp.Services.GroupFilter;t.property=e.property,t.property2="opp_land",t.id=csComp.Helpers.getGuid(),t.filterType="scatter",t.title=t.property;var i=this.$layerService.findLayer(this.$scope.poi.layerId);this.$layerService.setFilter(t,i.group)},e.prototype.displayFeature=function(e){if(e){var t=this.$layerService.featureTypes[e.featureTypeName];this.$scope.callOut=new r(t,e,this.$layerService.propertyTypeData)}},e.$inject=["$scope","$location","$sce","mapService","layerService","messageBusService"],e}();e.FeaturePropsCtrl=a}(FeatureProps||(FeatureProps={}));var FeatureRelations;!function(e){e.html='<div style="max-width: 700px">    <style>        .relationgroup-title {            font-size: 18px;            font-weight: bold;        }        .relation-title {            font-size: 16px;        }    </style>    <h4 class="rightpanel-header">        <img data-ng-if="callOut.icon" data-ng-src="{{callOut.icon}}" width="24" height="24" style="margin-left:5px" alt="Icon" />        &nbsp;&nbsp;{{callOut.title}}    </h4>    <div id="relations" class="rightpanel-content" style="min-width:355px;margin-left: 20px">        <div ng-repeat="group in vm.relations">            <div style="float: left; margin-left: -5px; margin-top: 5px" data-toggle="collapse" data-target="#relationgroup_{{group.id}}"><i class="fa fa-chevron-down togglebutton toggle-arrow-down"></i><i class="fa fa-chevron-up togglebutton toggle-arrow-up"></i></div>            <div class="relationgroup-title">{{group.title}}</div>            <div id="relationgroup_{{group.id}}" class="collapse in">                <div ng-repeat="relation in group.relations" style="margin-bottom: 5px">                    <img data-ng-if="relation.icon" data-ng-src="{{relation.icon}}" width="24" height="24" style="margin-left:5px; " alt="Icon" />                    <a class="relation-title" ng-click="vm.selectRelation(relation)">                        {{relation.title}}                    </a>                </div>            </div>        </div>    </div></div>'}(FeatureRelations||(FeatureRelations={}));var FeatureRelations;!function(e){var t="csWeb.featurerelations";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("featurerelations",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.FeatureRelationsCtrl}}])}(FeatureRelations||(FeatureRelations={}));var FeatureRelations;!function(e){var t=(function(){function e(e){this.position=e,this.closeButton=!0,this.autoPan=!0}return e}(),function(){function e(){this.relations=[]}return e}());e.RelationGroup=t;var i=function(){function e(){}return e}();e.Relation=i;var r=function(){function e(e,t,i,r,a,n){var o=this;this.$scope=e,this.$location=t,this.$sce=i,this.$mapService=r,this.$layerService=a,this.$messageBusService=n,this.relations=[],this.featureMessageReceived=function(e,t){switch(e){case"onFeatureSelect":o.initRelations()}"$apply"!=o.$scope.$root.$$phase&&"$digest"!=o.$scope.$root.$$phase&&o.$scope.$apply()},this.scope=e,e.vm=this,e.showMenu=!1,n.subscribe("feature",this.featureMessageReceived)}return e.prototype.selectRelation=function(e){this.$layerService.selectFeature(e.target),this.$mapService.zoomTo(e.target)},e.prototype.initRelations=function(){this.relations=[];var e=this.$layerService.lastSelectedFeature;if(null!=e.fType){var r=csComp.Helpers.getPropertyTypes(e.fType,this.$layerService.propertyTypeData);for(var a in r){var n=r[a];if("relation"==n.type){var o=new t;o.title=n.title,o.id=csComp.Helpers.getGuid(),o.relations=[],n.target&&this.$layerService.project.features.forEach(function(t){if(e.properties.hasOwnProperty(n.subject)&&t.properties.hasOwnProperty(n.target)&&t.properties[n.target]==e.properties[n.subject]){var r=new i;r.subject=e,r.target=t,r.title=FeatureProps.CallOut.title(t.fType,t),r.icon=null==t.fType||null==t.fType.style||!t.fType.style.hasOwnProperty("iconUri")||t.fType.style.iconUri.toLowerCase().indexOf("_media")>=0?"":t.fType.style.iconUri,o.relations.push(r)}}),o.relations.length>0&&this.relations.push(o)}}this.showRelations=this.relations.length>0,this.showRelations?$("#relatedHeader").show():$("#relatedHeader").hide()}},e.$inject=["$scope","$location","$sce","mapService","layerService","messageBusService"],e}();e.FeatureRelationsCtrl=r}(FeatureRelations||(FeatureRelations={}));var FilterList;!function(e){e.html='<div>    <h4 class="leftpanel-header" translate="FILTERS"></h4>    <div ng-show="vm.$layerService.noFilters" translate="FILTER_INFO"></div>    <a ng-hide="vm.$layerService.noFilters" ng-click="vm.$layerService.resetFilters()"><span class="fa fa-refresh"></span> reset</a>    <div id="filterChart"></div></div>'}(FilterList||(FilterList={}));var FilterList;!function(e){var t="csWeb.filterList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("filterList",["$window","$compile",function(t,i){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e,i,r){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.FilterListCtrl}}]).directive("bsPopover",function(){return function(e,t,i){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(FilterList||(FilterList={}));var FilterList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.$inject=["$scope","layerService"],e}();e.FilterListCtrl=t}(FilterList||(FilterList={}));var Heatmap;!function(e){e.html='<div>    <div class="wide-tooltip">        <span class="pull-right fa fa-info-circle fa-2x"              tooltip-html-unsafe="{{\'HEATMAP.DESCRIPTION\' | translate}}"              tooltip-placement="bottom"              tooltip-trigger="mouseenter"              tooltip-append-to-body="false"              style="margin-right: 5px;"></span>        <h4 class="leftpanel-header" translate>HEATMAP</h4>    </div>    <div>        <select data-ng-model="vm.heatmapModel"                data-ng-options="heatmap.title for heatmap in vm.heatmapModels"                data-ng-change="vm.updateHeatmap()"                style="width: 65%; margin-bottom: 10px;"></select>        <div data-ng-if="vm.expertMode" class="pull-right">            <a href="" data-ng-click="vm.createHeatmap()" tooltip="{{\'HEATMAP.ADD_HEATMAP\' | translate}}" style="margin-right:5px;"><i class="fa fa-plus"></i></a>            <a href="" data-ng-click="vm.removeHeatmap(vm.heatmapModel)" tooltip="{{\'HEATMAP.DELETE_HEATMAP\' | translate}}" style="margin-right:5px;"><i class="fa fa-trash"></i></a>            <a href="" data-ng-click="vm.editHeatmap(vm.heatmapModel)" tooltip="{{\'HEATMAP.EDIT_HEATMAP\' | translate}}" tooltip-placement="right" style="margin-right:5px;"><i class="fa fa-edit"></i></a>        </div>    </div>        <div data-ng-if="vm.heatmapModel" style="margin-bottom: 20px; margin-left: -5px">            <div style="display: inline; font-weight: bold" translate>HEATMAP.INTENSITY_SCALE</div>            <voting class="pull-right"                    data-ng-change="vm.intensityScaleUpdated()"                    min="0"                    max="5"                    ng-model="vm.heatmapModel.intensityScale"                    style="margin-bottom: 3px; margin-right: 5px"></voting>        </div>    <div data-ng-if="vm.heatmapModel" style="overflow-y: auto; overflow-x: hidden; margin-left: -5px;" resize resize-y="140">        <div data-ng-repeat="hi in vm.heatmapModel.heatmapItems" class="wide-tooltip">            <div data-ng-if="hi.isSelected">                <div class="truncate" data-ng-class="{true: \'ignoredCriteria\'}[hi.userWeight == 0]" style="display: inline-block; width: 180px; font-weight: bold">{{hi.toString()}}</div>                <voting class="pull-right"                        data-ng-class="vm.getVotingClass(hi)"                        data-ng-change="vm.weightUpdated()"                        min="-5"                        max="5"                        ng-model="hi.userWeight"                        style="margin-right: 5px; margin-bottom: 3px;"></voting>            </div>        </div>    </div>    <div data-ng-if="!vm.heatmapModel">        <div data-ng-if="vm.expertMode" translate>HEATMAP.INFO_EXPERT</div>        <div data-ng-if="!vm.expertMode" translate>HEATMAP.INFO</div>    </div></div>'}(Heatmap||(Heatmap={}));var Heatmap;!function(e){"use strict";var t="csWeb.heatmap";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("heatmap",["$window","$compile","$templateCache",function(t,i,r){return{terminal:!0,restrict:"EA",scope:{},template:e.html,compile:function(e){r.put("heatmapEditorView.html",HeatmapEditorView.html);var t=i(e);return function(e){t(e)}},replace:!0,transclude:!0,controller:e.HeatmapCtrl}}])}(Heatmap||(Heatmap={}));var Heatmap;!function(e){"use strict";var t=function(){function t(e,i,r,a,n,o,s,l){this.$scope=e,this.$modal=i,this.$translate=r,this.$timeout=a,this.$localStorageService=n,this.$layerService=o,this.$mapService=s,this.messageBusService=l,this.heatmapModels=[],this.expertMode=!0,e.vm=this,l.subscribe("layer",function(e){switch(e){case"deactivate":case"activated":}}),l.subscribe("project",function(e){switch(e){case"loaded":}}),r("HEATMAP.DELETE_MSG").then(function(e){t.confirmationMsg1=e}),r("HEATMAP.DELETE_MSG2").then(function(e){t.confirmationMsg2=e}),this.initializeHeatmap()}return t.prototype.createHeatmap=function(){var t=new e.HeatmapModel("Heatmap");this.showHeatmapEditor(t)},t.prototype.editHeatmap=function(e){this.showHeatmapEditor(e)},t.prototype.removeHeatmap=function(e){var i=this;if(e){var r=String.format(t.confirmationMsg1,e.title);this.messageBusService.confirm(r,t.confirmationMsg2,function(t){t&&i.$timeout(function(){i.deleteHeatmap(e),i.heatmap&&i.updateHeatmap()},0)}),this.scopeApply()}},t.prototype.deleteHeatmap=function(e){if(e){var t=this.heatmapModels.indexOf(e);t>=0&&this.heatmapModels.splice(t,1),this.$mapService.map.removeLayer(this.heatmap)}},t.prototype.showHeatmapEditor=function(t){var i=this,r=this.$modal.open({templateUrl:"heatmapEditorView.html",controller:e.HeatmapEditorCtrl,resolve:{heatmap:function(){return t}}});r.result.then(function(e){i.heatmapModel=e;var t=i.heatmapModels.indexOf(e);t>=0&&i.heatmapModels.splice(t,1),i.heatmapModels.push(e),i.updateHeatmap(),console.log("Updated heatmap")},function(){})},t.prototype.scopeApply=function(){"$apply"!==this.$scope.$root.$$phase&&"$digest"!==this.$scope.$root.$$phase&&this.$scope.$apply()},t.prototype.getVotingClass=function(e){return null==e||null==this.heatmapModel||0===e.userWeight||e.userWeight<-5||e.userWeight>5?"disabledHeatmap":e.userWeight>0?"prefer":"avoid"},t.prototype.weightUpdated=function(){this.heatmapModel&&this.updateHeatmap()},t.prototype.intensityScaleUpdated=function(){this.heatmapModel&&(this.heatmapModel.updateIntensityScale(),this.updateHeatmap())},t.prototype.updateHeatmap=function(){if(this.heatmapModel){var e=this.$mapService.getMap().getZoom();e>=this.heatmapModel.scaleMinValue&&e<=this.heatmapModel.scaleMaxValue?(this.heatmapModel.updateWeights(),this.heatmapModel.calculate(this.$layerService,this.$mapService,this.heatmap)):console.log("Heatmap is not supported for the current zoom level.")}},t.prototype.initializeHeatmap=function(){var t=this;this.heatmap=L.geoJson([],{style:function(t){if(t.properties.intensity<=0){var i=e.HeatmapCtrl.intensityToHex(t.properties.intensity);return{color:"#FF"+i+i}}if(t.properties.intensity>0){var i=e.HeatmapCtrl.intensityToHex(t.properties.intensity);return{color:"#"+i+i+"FF"}}return{color:"#ffffff"}}}),this.$mapService.map.setView(new L.LatLng(52.1095,4.3275),14),this.$mapService.map.addLayer(this.heatmap),this.$mapService.getMap().on("moveend",function(){t.updateHeatmap()})},t.intensityToHex=function(e){var t=20;e=Math.floor(255*Math.abs(e)),0>e?e=0:e>255-t&&(e=255-t);var i=(255-t-e).toString(16);

return 1==i.length&&(i="0"+i),i},t.MAX_HEATMAP_CELLS=2500,t.$inject=["$scope","$modal","$translate","$timeout","localStorageService","layerService","mapService","messageBusService"],t}();e.HeatmapCtrl=t}(Heatmap||(Heatmap={}));var Heatmap;!function(e){"use strict";var t=function(){function t(t,i,r,a,n,o){var s=this;this.$scope=t,this.$modalInstance=i,this.$layerService=r,this.$translate=a,this.messageBusService=n,this.heatmap=o,this.scoringFunctions=[],t.vm=this,this.scoringFunctions.push(new e.ScoringFunction(0)),a("HEATMAP.LINEAR_ASC_DESC").then(function(e){s.scoringFunctions[0].title=e}),this.dataset=csComp.Helpers.loadMapLayers(r),o||(o=new e.HeatmapModel("Heatmap"));for(var l in this.dataset.featureTypes)if(this.dataset.featureTypes.hasOwnProperty(l)){var c=this.dataset.featureTypes[l];o.addHeatmapItem(new e.HeatmapItem(c.name,c));if(!c.propertyTypeData)return;c.propertyTypeData.forEach(function(t){if("options"==t.type){var i=0;t.options.forEach(function(r){var a=new e.HeatmapItem(r,c);a.propertyLabel=t.label,a.propertyTitle=t.title,a.optionIndex=i++,o.addHeatmapItem(a)})}})}}return t.prototype.save=function(){this.$modalInstance.close(this.heatmap)},t.prototype.cancel=function(){this.$modalInstance.dismiss("cancel")},t.prototype.toggleItemDetails=function(e){this.showItem=this.showItem==e?-1:e,console.log("Toggle item")},t.$inject=["$scope","$modalInstance","layerService","$translate","messageBusService","heatmap"],t}();e.HeatmapEditorCtrl=t}(Heatmap||(Heatmap={}));var HeatmapEditorView;!function(e){e.html='<div class="modal-content">    <div class="modal-header">        <button type="button" class="close" data-ng-click="vm.cancel()" aria-hidden="true">&times;</button>        <h3 class="modal-title" translate>HEATMAP.EDITOR_TITLE</h3>    </div>    <div class="modal-body container-fluid">        <div class="row-fluid">            <input type="text" data-ng-model="vm.heatmap.title" style="margin: 0 5px" placeholder="{{ \'HEATMAP.TITLE\' | translate }}" />        </div>        <h4 class="row-fluid" style="margin-top: 20px;" translate>HEATMAP.MAIN_FEATURE</h4>        <!--<select data-ng-model="vm.selectedFeatureType"                data-ng-change="vm.loadPropertyTypes()"                data-ng-options="item as item.name for (key, item) in vm.dataset.featureTypes"                class="form-control row-fluid"></select>        <h4 class="row-fluid" translate>HEATMAP.PROPERTIES</h4>-->        <ul class="form-group row-fluid" style="margin-top: 1em; margin-left: -2em; overflow-y: auto; overflow-x: hidden;"            resize resize-y="450">            <li ng-repeat="hi in vm.heatmap.heatmapItems"                class="row-fluid list-unstyled truncate">                <div style="padding: 5px 0;" class="row-fluid"><!--                    name="vm.selectedTitles[]" value="{{hi.title}}"-->                    <input type="checkbox"                           data-ng-checked="hi.isSelected"                           data-ng-click="hi.isSelected = !hi.isSelected">&nbsp;&nbsp;{{hi.title}}                    <div data-ng-if="hi.isSelected" class="pull-right">                        <a href="" class="pull-right"                           style="margin-right: 5px;"                           data-ng-click="vm.toggleItemDetails($index)"><i class="fa fa-2x fa-edit"></i></a>                    </div>                </div>                <div class="row-fluid" data-ng-show="vm.showItem == {{$index}}" id="scoringFunction">                    <select class="col-xs-10"                            style="margin-right: 5px; margin-bottom: 5px;"                            data-ng-init="hi.scoringFunctionType = hi.scoringFunctionType || vm.scoringFunctions[0]"                            data-ng-model="hi.scoringFunctionType"                            data-ng-options="sf as sf.title for sf in vm.scoringFunctions"></select>                    <div class="pull-right" data-ng-class="hi.scoringFunctionType.cssClass" style="width: 40px; height: 28px; margin-top: -5px;"></div>                    <div class="row-fluid" >                        <input type="text" class="col-xs-3" style="padding: 0; margin-right: 5px;" data-ng-model="hi.idealityMeasure.atLocation" placeholder="{{ \'HEATMAP.AT_LOCATION_VALUE\' | translate }}" />                        <input type="text" class="col-xs-3" style="padding: 0; margin-right: 5px;" data-ng-model="hi.idealityMeasure.idealDistance" placeholder="{{ \'HEATMAP.DISTANCE_MAX_VALUE\' | translate }}" />                        <input type="text" class="col-xs-3" style="padding: 0;" data-ng-model="hi.idealityMeasure.lostInterestDistance" placeholder="{{ \'HEATMAP.LOST_INTEREST_VALUE\' | translate }}" />                    </div>                </div>            </li>        </ul>    </div>    <div class="modal-footer">        <button type="button" class="btn btn-warning" data-ng-click="vm.cancel()" translate>CANCEL_BTN</button>        <button type="button" class="btn btn-primary" data-ng-click="vm.save()" translate>OK_BTN</button>    </div></div>'}(HeatmapEditorView||(HeatmapEditorView={}));var Heatmap;!function(e){var t=function(){function t(t,i){this.title=t,this.featureType=i,this.userWeight=1,this.weight=0,this.idealityMeasure=new e.IdealityMeasure,this.heatspots=[],this.isSelected=!1,this.intensityScale=1,this.setScale(52)}return t.prototype.calculateHeatspots=function(e,t,i,r,a,n){return this.isSelected&&this.featureType===e.fType?(0===this.heatspots.length&&this.calculateHeatspot(t,i),this.propertyLabel?e.properties.hasOwnProperty(this.propertyLabel)&&e.properties[this.propertyLabel]===this.optionIndex?this.pinHeatspotToGrid(e,r,a,n):null:this.pinHeatspotToGrid(e,r,a,n)):null},t.prototype.calculateHeatspot=function(t,i){var r=this.idealityMeasure.lostInterestDistance,a=Math.floor(r/t),n=Math.floor(r/i),o=t*i,s=this.weight*this.intensityScale,l=a*n;this.heatspots=new Array(l),this.heatspots.push(new e.Heatspot(0,0,s*this.idealityMeasure.atLocation));for(var c=-n;n>=c;c++)for(var p=-a;a>=p;p++){var u=Math.sqrt(c*c*o+p*p*o),d=s*this.idealityMeasure.computeIdealityAtDistance(u);0==c&&0==p||0==d||this.heatspots.push(new e.Heatspot(c,p,d))}},t.prototype.pinHeatspotToGrid=function(e,t,i,r){if("Point"!==e.geometry.type)return null;var a=new L.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]),n=r.pad(1.1);if(!n.contains(a))return null;var o=[],s=Math.floor((a.lng-r.getNorthWest().lng)/(r.getNorthEast().lng-r.getNorthWest().lng)*t),l=Math.floor((a.lat-r.getSouthWest().lat)/(r.getNorthWest().lat-r.getSouthWest().lat)*i);return this.heatspots.forEach(function(e){o.push(e.AddLocation(s,l))}),o},t.prototype.setScale=function(e){var i=csComp.Helpers.GeoExtensions.convertDegreesToMeters(e);t.meterToLatDegree=1/i.latitudeLength,t.meterToLonDegree=1/i.longitudeLength},t.prototype.select=function(){if(this.reset(),this.isSelected=!this.isSelected,this.isSelected)switch(this.featureType.style.drawingMode.toLowerCase()){case"point":case"image":this.idealityMeasure=new e.IdealityMeasure}else this.idealityMeasure=null},t.prototype.reset=function(){this.heatspots=[]},t.prototype.toString=function(){return this.propertyTitle?this.propertyTitle+"."+this.title+" ("+this.featureType.name+")":this.title},t.twoPi=2*Math.PI,t}();e.HeatmapItem=t}(Heatmap||(Heatmap={}));var Heatmap;!function(e){var t=function(){function t(e){this.title=e,this.heatmapItems=[],this.scaleMaxValue=16,this.scaleMinValue=9,this.intensityScale=1,this.title=e}return t.prototype.calculate=function(t,i,r){var a=this;console.log("Calculating heatmap");var n=i.map.getBounds(),o=n.getNorthWest(),s=n.getNorthEast(),l=n.getSouthWest(),c=o.distanceTo(s),p=o.distanceTo(l),u=csComp.Helpers.loadMapLayers(t),d=0;u.features.forEach(function(e){a.heatmapItems.forEach(function(e){e.idealityMeasure.lostInterestDistance>d&&(d=e.idealityMeasure.lostInterestDistance)})});for(var h=c/p,f=e.HeatmapCtrl.MAX_HEATMAP_CELLS,m=Math.floor(Math.sqrt(f*h)),g=Math.floor(m/h),v=c/m,y=p/g,b=(s.lat-l.lat)/g,S=(s.lng-l.lng)/m,w=0,M=[],x=0;m>x;x++){M[x]=[];for(var $=0;g>$;$++)M[x][$]=0}u.features.forEach(function(e){a.heatmapItems.forEach(function(t){var i=t.calculateHeatspots(e,v,y,m,g,n);i&&i.forEach(function(e){0!=e.intensity&&e.i>=0&&e.i<m&&e.j>=0&&e.j<g&&(M[e.i][e.j]=M[e.i][e.j]+e.intensity,w+=1)})})}),console.log("Created "+w+" heatspots"),r.clearLayers();for(var x=0;m>x;x++)for(var $=0;g>$;$++)if(0!=M[x][$]){var T=[[l.lng+S*x,l.lat+b*$],[l.lng+S*(x+1),l.lat+b*$],[l.lng+S*(x+1),l.lat+b*($+1)],[l.lng+S*x,l.lat+b*($+1)],[l.lng+S*x,l.lat+b*$]],E={type:"Feature",geometry:{type:"Polygon",coordinates:[T]},properties:{gridX:x,gridY:$,intensity:M[x][$]}};r.addData(E)}},t.prototype.updateWeights=function(){var e=0;this.heatmapItems.forEach(function(t){t.isSelected&&(e+=Math.abs(t.userWeight))}),this.heatmapItems.forEach(function(t){t.isSelected&&(t.weight=0!=e?t.userWeight/e:0,t.reset())})},t.prototype.updateIntensityScale=function(){var e=this;this.heatmapItems.forEach(function(t){t.intensityScale=e.intensityScale})},t.prototype.addHeatmapItem=function(e){for(var t=e.featureType,i=e.title,r=0;r<this.heatmapItems.length;r++){var a=this.heatmapItems[r];if(a.featureType===t&&a.title===i)return}this.heatmapItems.push(e)},t}();e.HeatmapModel=t}(Heatmap||(Heatmap={}));var Heatmap;!function(e){var t=function(){function e(e,t,i){this.i=e,this.j=t,this.intensity=i}return e.prototype.AddLocation=function(t,i){return new e(this.i+t,this.j+i,this.intensity)},e}();e.Heatspot=t}(Heatmap||(Heatmap={}));var Heatmap;!function(e){!function(e){e[e.LinearAscendingDescending=0]="LinearAscendingDescending"}(e.ScoringFunctionType||(e.ScoringFunctionType={}));var t=e.ScoringFunctionType,i=function(){function e(e){"undefined"!=typeof e&&null!=e&&(this.type=e),this.title=t[e].toString()}return Object.defineProperty(e.prototype,"cssClass",{get:function(){return t[this.type].toLowerCase()},enumerable:!0,configurable:!0}),e}();e.ScoringFunction=i;var r=function(){function e(){}return e}();e.ScoringFunctions=r;var a=function(){function e(){this.idealDistance=500,this.atLocation=.1,this.lostInterestDistance=2e3}return e.prototype.computeIdealityAtDistance=function(e){return e<this.idealDistance?this.atLocation+(1-this.atLocation)*e/this.idealDistance:e<this.lostInterestDistance?1-(e-this.idealDistance)/(this.lostInterestDistance-this.idealDistance):0},e}();e.IdealityMeasure=a}(Heatmap||(Heatmap={}));var LanguageSwitch;!function(e){e.html='<div class="navbar-collapse collapse">    <ul class="nav navbar-nav">        <li class="dropdown">            <a href=""               class="navbar-brand dropdown-toggle pull-left"               data-toggle="dropdown"               style="color:white; margin-left:-10px;">                <img data-ng-src="{{vm.language.img}}" />                <span class="caret" data-ng-if="vm.$languages.length > 1"></span>            </a>            <ul data-ng-if="vm.$languages.length > 1" class="dropdown-menu" role="menu">                <li ng-repeat="language in vm.$languages">                    <a ng-click="vm.switchLanguage(language)">                        <span>                            <img data-ng-src="{{language.img}}" />                            &nbsp;{{language.name}}                        </span>                    </a>                </li>            </ul>        </li>    </ul></div>'}(LanguageSwitch||(LanguageSwitch={}));var LanguageSwitch;!function(e){var t="csWeb.languageSwitch";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("languageSwitch",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.LanguageSwitchCtrl}}]).provider("$languages",function(){this.languages=[],this.$get=function(){return this.languages},this.setLanguages=function(e){this.languages=e}})}(LanguageSwitch||(LanguageSwitch={}));var LanguageSwitch;!function(e){var t=function(){function e(e,t,i,r){this.$scope=e,this.$translate=t,this.$languages=i,this.$messageBus=r,e.vm=this,this.language=i[0]}return e.prototype.switchLanguage=function(e){this.language=e,this.$translate.use(e.key),this.$messageBus.publish("language","newLanguage",e.key)},e.$inject=["$scope","$translate","$languages","messageBusService"],e}();e.LanguageSwitchCtrl=t}(LanguageSwitch||(LanguageSwitch={}));var LayersDirective;!function(e){e.html='<div>    <h4 class="leftpanel-header" translate="LAYERS"></h4>    <div style="overflow-y: auto; overflow-x: hidden; margin-top: -10px" resize resize-y="95">        <div data-ng-repeat="group in vm.$layerService.project.groups" style="margin-left: 5px">            <div style="float: left; margin-left: -5px; margin-top: 5px" data-toggle="collapse" data-target="#layergroup_{{group.id}}"><i class="fa fa-chevron-down togglebutton toggle-arrow-down"></i><i class="fa fa-chevron-up togglebutton toggle-arrow-up"></i></div>            <div popover="{{(group.description) ? group.description : \'\'}}"                 popover-placement="right"                 popover-width="400"                 popover-trigger="mouseenter"                 class="group-title">{{group.title}}</div>            <div id="layergroup_{{group.id}}" class="collapse in">                <div popover="{{(layer.description) ? layer.description : \'\'}}"                     popover-placement="right"                     popover-trigger="mouseenter"                     data-ng-repeat="layer in group.layers">                    <!--bs-popover>-->                    <div style="list-style-type: none; padding: 0;" data-ng-class="{indent: layer.isSublayer}">                        <!--<button type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="right" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-original-title="" title="">Right</button>-->                        <div ng-hide="group.oneLayerActive" class="checkbox checkbox-primary" style="margin-left: 20px">                            <input type="checkbox" id="cblayer{{layer.id}}" ng-model="layer.enabled" data-ng-click="vm.toggleLayer(layer);">                            <label for="cblayer{{layer.id}}">                                {{layer.title}}                            </label>                            <div ng-show="layer.isLoading" class="spinner">                            <div class="bounce1"></div>                            <div class="bounce2"></div>                            <div class="bounce3"></div>                        </div>                        </div>                        <div ng-show="group.oneLayerActive" class="radio radio-primary" style="margin-left: 20px">                            <input type="radio" ng-value="true" id="rblayer{{layer.id}}" ng-model="layer.enabled" data-ng-click="vm.toggleLayer(layer);">                            <label for="rblayer{{layer.id}}">                                {{layer.title}}                            </label>                            <div ng-show="layer.isLoading" class="spinner">                            <div class="bounce1"></div>                            <div class="bounce2"></div>                            <div class="bounce3"></div>                        </div>                        </div>                    </div>                </div>            </div>        </div>    </div></div>'}(LayersDirective||(LayersDirective={}));var LayersDirective;!function(e){var t="csWeb.layersDirective";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("layersDirective",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.LayersDirectiveCtrl}}]).directive("bsPopover",function(){return function(e,t,i){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(LayersDirective||(LayersDirective={}));var LayersDirective;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.prototype.toggleLayer=function(e){e.enabled?this.$layerService.addLayer(e):this.$layerService.removeLayer(e),"$apply"!=this.$scope.$root.$$phase&&"$digest"!=this.$scope.$root.$$phase&&this.$scope.$apply()},e.$inject=["$scope","layerService"],e}();e.LayersDirectiveCtrl=t}(LayersDirective||(LayersDirective={}));var LegendList;!function(e){e.html='<div style="position: relative;">    <h4 class="leftpanel-header" translate="LEGEND"></h4>    <div>        <div ng-repeat="legendItem in legendItems" class="legendItem">            <div class="legendIcon">                <img ng-src="{{legendItem.uri}}" class="legendImage" />            </div>            <span class="legendText">{{legendItem.title}}</span>        </div>    </div></div>'}(LegendList||(LegendList={}));var LegendList;!function(e){var t="csWeb.legendList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("legendList",["$window","$compile",function(t,i){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e,i,r){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.LegendListCtrl}}]).directive("bsPopover",function(){return function(e,t,i){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(LegendList||(LegendList={}));var LegendList;!function(e){var t=function(){function e(e,t,i,r){var a=this;this.$scope=e,this.$layerService=t,this.$mapService=i,this.$messageBusService=r,e.vm=this,r.subscribe("project",function(){a.updateLegendItems()}),r.subscribe("layer",function(){a.updateLegendItems()}),this.updateLegendItems(),e.legendItems=[],e.numberOfItems=10}return e.prototype.updateLegendItems=function(){var e=[],t=[];for(var i in this.$layerService.featureTypes){var r=this.$layerService.featureTypes[i],a=this.getImageUri(r),n=this.getName(i,r),o=name+a;t.indexOf(o)<0&&(t.push(o),e.push({title:n,uri:a}))}e.sort(function(e,t){return e.title>t.title?1:e.title<t.title?-1:0}),this.$scope.legendItems=e},e.prototype.getImageUri=function(e){var t=e.style.iconUri;return null==t&&(t="includes/images/marker.png"),t.indexOf("{")>=0&&(t=t.replace("{","").replace("}","")),null!=e.style&&null!=e.style.drawingMode&&"point"!=e.style.drawingMode.toLowerCase()?t.indexOf("_Media")<0?t:"includes/images/polygon.png":null!=e.style&&null!=t?t:"includes/images/marker.png"},e.prototype.getName=function(e,t){return t.name||e.replace("_Default","")},e.$inject=["$scope","layerService","mapService","messageBusService"],e}();e.LegendListCtrl=t}(LegendList||(LegendList={}));var MapElement;!function(e){e.html='<div id="map"  tabindex="0" class="leaflet-container leaflet-touch leaflet-fade-anim" style="position:absolute"></div> <!-- <div id="cesiumContainer" style="position:absolute"></div> -->'}(MapElement||(MapElement={}));var MapElement;!function(e){var t="csWeb.mapElement";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("map",["$window","$compile",function(t,i){return{terminal:!1,restrict:"E",scope:{mapid:"="},template:e.html,link:function(e,i,r){angular.element(t).bind("resize",function(){e.$apply()}),e.mapid=r.mapid,e.initMap()},replace:!1,transclude:!0,controller:e.MapElementCtrl}}])}(MapElement||(MapElement={}));var MapElement;!function(e){var t=function(){function e(e,t,i,r){var a=this;this.$scope=e,this.$layerService=t,this.mapService=i,this.$messageBusService=r,this.locale="en-us",e.vm=this,e.initMap=function(){return a.initMap()}}return e.prototype.initMap=function(){},e.$inject=["$scope","layerService","mapService","messageBusService"],e}();e.MapElementCtrl=t}(MapElement||(MapElement={}));var Mca;!function(e){e.html='<div>    <div class="wide-tooltip">        <span class="pull-right fa fa-info-circle fa-2x"              tooltip-html-unsafe="{{\'MCA.DESCRIPTION\' | translate}}"              tooltip-placement="bottom"              tooltip-trigger="mouseenter"              tooltip-append-to-body="false"              style="margin-right: 5px;"></span>        <h4 class="leftpanel-header">MCA</h4>    </div>    <div>        <select data-ng-model="vm.mca"                data-ng-options="mca.title for mca in vm.availableMcas"                data-ng-change="vm.updateMca()"                style="width: 65%; margin-bottom: 10px;"></select>        <div data-ng-if="vm.expertMode" class="pull-right">            <a href="" data-ng-click="vm.createMca()" tooltip="{{\'MCA.ADD_MCA\' | translate}}" style="margin-right:5px;"><i class="fa fa-plus"></i></a>            <a href="" data-ng-click="vm.removeMca(vm.mca)" tooltip="{{\'MCA.DELETE_MCA\' | translate}}" style="margin-right:5px;"><i class="fa fa-trash"></i></a>            <a href="" data-ng-click="vm.editMca(vm.mca)" tooltip="{{\'MCA.EDIT_MCA\' | translate}}" tooltip-placement="right" style="margin-right:5px;"><i class="fa fa-edit"></i></a>        </div>        <a href=""           tooltip="{{\'MCA.TOGGLE_SPARKLINE\' | translate}}"           data-ng-init="sparkLineStyle = vm.showSparkline ? {} : {color:\'lightgray\'}"           data-ng-click="vm.toggleSparkline(); sparkLineStyle = vm.showSparkline ? {} : {color:\'lightgray\'}"           data-ng-style="sparkLineStyle"           class="pull-right" style="margin-right:5px;"><i class="fa fa-bar-chart"></i></a>    </div>        <div data-ng-if="!vm.mca">        <div data-ng-if="vm.expertMode"  translate>MCA.INFO_EXPERT</div>        <div data-ng-if="!vm.expertMode" translate>MCA.INFO</div>    </div>    <div data-ng-if="vm.mca" style="overflow-y: auto; overflow-x: hidden; margin-left: -5px;" resize resize-y="140">        <div data-ng-repeat="criterion in vm.mca.criteria" class="wide-tooltip">            <div data-ng-if="criterion.criteria.length > 0 && criterion.userWeight != 0" class="collapsed pull-left" style="margin: 0 5px 0 0" data-toggle="collapse" data-target="#criterion_{{$index}}"><i class="fa fa-chevron-down togglebutton toggle-arrow-down"></i><i class="fa fa-chevron-up togglebutton toggle-arrow-up"></i></div>            <div data-ng-style="{\'display\': \'inline-block\', \'margin-bottom\': \'6px\', \'width\':\'10px\', \'height\':\'10px\', \'border\':\'solid 1px black\', \'background-color\': criterion.color}"></div>            <div class="truncate" data-ng-class="{true: \'ignoredCriteria\'}[criterion.userWeight == 0]" style="display: inline-block; width: 150px; font-weight: bold">{{criterion.getTitle()}}</div>            <voting class="pull-right"                    data-ng-class="vm.getVotingClass(criterion)"                    data-ng-change="vm.weightUpdated(criterion)"                    min="-vm.mca.userWeightMax"                    max="vm.mca.userWeightMax"                    ng-model="criterion.userWeight"                    style="margin-right: 5px; margin-bottom: 3px;"></voting>            <div id="histogram_{{$index}}" data-ng-show="vm.showSparkline && criterion.criteria.length == 0" style="margin-top: 5px;"></div>            <div data-ng-if="criterion.criteria.length > 0" id="criterion_{{$parent.$index}}" class="collapse out" style="margin-left: 19px">                <div data-ng-repeat="crit in criterion.criteria">                    <div data-ng-style="{\'display\': \'inline-block\', \'margin-bottom\': \'6px\', \'width\':\'10px\', \'height\':\'10px\', \'border\':\'solid 1px black\', \'background-color\': crit.color}"></div>                    <div class="truncate" data-ng-class="{true: \'ignoredCriteria\'}[crit.userWeight == 0 || criterion.userWeight == 0]" style="display: inline-block; width: 150px;">{{crit.getTitle()}}</div>                    <div class="pull-right" style="margin-right: 15px;">{{Math.abs(crit.userWeight)}}</div>                    <voting class="pull-right"                            data-ng-class="vm.getVotingClass(criterion)"                            data-ng-change="vm.weightUpdated(crit)"                            min="0"                            max="vm.mca.userWeightMax"                            ng-model="crit.userWeight"                            style="margin-right: 5px;"></voting>                    <div id="histogram_{{$parent.$index}}_{{$index}}" data-ng-show="vm.showSparkline" style="margin-top: 5px;"></div>                </div>            </div>        </div>        <!--<a href="" style="display: inline-block; width: 100%; text-transform: uppercase"               data-ng-click="vm.calculateMca()" translate="MCA.COMPUTE_MGS" translate-values="{ mcaTitle: vm.mca.title }"></a>-->        <h4 data-ng-if="vm.showChart">            <a href="" data-ng-click="vm.weightUpdated(vm.mca)" translate="MCA.TOTAL_RESULT"></a>            <a href="" data-ng-if="vm.selectedCriterion">&gt;&nbsp;{{vm.selectedCriterion.title}}</a>        </h4>                <a href="" data-ng-if="vm.showFeature" class="pull-right" data-ng-click="vm.toggleMcaChartType();" style="margin-right: 10px">            <i class="fa" data-ng-class="{true: \'fa-bar-chart\', false: \'fa-pie-chart\'}[vm.showAsterChart]"></i>        </a>        <div style="margin-top: 5px; margin-left: auto; margin-right: auto; width: 95%;" id="mcaChart"></div>        <div data-ng-if="vm.showFeature">            <h4>                <img data-ng-if="vm.featureIcon" data-ng-src="{{vm.featureIcon}}" width="24" height="24" style="margin:0 5px" alt="Icon" />                {{vm.selectedFeature.properties[\'Name\']}}            </h4>            <table class="table table-condensed">                <tr data-ng-repeat="item in vm.properties"                    popover="{{item.description}}"                    popover-placement="right"                    popover-trigger="mouseenter"                    popover-append-to-body="true">                    <td><a class="fa fa-filter makeNarrow" data-ng-if="item.canFilter" data-ng-click="vm.$layerService.setFilter(item)" style="cursor: pointer"></a></td>                    <td><a class="fa fa-eye makeNarrow" data-ng-if="item.canStyle" data-ng-click="vm.setStyle(item)" style="cursor: pointer"></a></td>                    <td>{{item.key}}</td>                    <td class="text-right">{{item.value}}</td>                </tr>            </table>        </div>        <i data-ng-if="!vm.showFeature"><div translate="MCA.SHOW_FEATURE_MSG"></div></i>    </div>    <!--<div rating class="pull-right"             data-ng-style="{\'margin\': \'0 10px\', \'background\':\'rgba(0, 0, 0, 0.1)\', \'border-radius\': \'8px\', \'padding\': \'0 4px\', \'color\': criterion.color}"             ng-model="criterion.userWeight" max="11" readonly="isReadonly"             rating-states="ratingStates"             data-ng-click="vm.weightUpdated(criterion)"             on-hover="hoveringOver(value)" on-leave="overStar = null"></div>--></div>'}(Mca||(Mca={}));var Mca;!function(e){"use strict";var t="csWeb.mca";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("mca",["$window","$compile","$templateCache",function(t,i,r){return{terminal:!0,restrict:"EA",scope:{},template:e.html,compile:function(e){r.put("mcaEditorView.html",McaEditorView.html);var t=i(e);return function(e){t(e)}},replace:!0,transclude:!0,controller:e.McaCtrl}}])}(Mca||(Mca={}));var Mca;!function(e){"use strict";var t=function(){function t(i,r,a,n,o,s,l){var c=this;this.$scope=i,this.$modal=r,this.$translate=a,this.$timeout=n,this.$localStorageService=o,this.$layerService=s,this.messageBusService=l,this.features=[],this.availableMcas=[],this.showAsterChart=!1,this.showDialog=!1,this.expertMode=!1,this.showSparkline=!1,this.featureMessageReceived=function(e,t){if(null!=c.mca){switch(e){case"onFeatureSelect":c.updateSelectedFeature(t,!0);break;case"onFeatureDeselect":c.showFeature=!1,c.selectedFeature=null,c.drawChart()}c.scopeApply()}},i.vm=this,l.subscribe("layer",function(e){switch(e){case"deactivate":case"activated":c.updateAvailableMcas(),c.calculateMca()}}),l.subscribe("project",function(i){switch(i){case"loaded":c.expertMode=null!=s.project&&s.project.hasOwnProperty("userPrivileges")&&s.project.userPrivileges.hasOwnProperty("mca")&&s.project.userPrivileges.mca.hasOwnProperty("expertMode")&&s.project.userPrivileges.mca.expertMode,("undefined"==typeof s.project.mcas||null==s.project.mcas)&&(s.project.mcas=[]);var r=c.$localStorageService.get(t.mcas);if("undefined"==typeof r||null===r)return;r.forEach(function(t){s.project.mcas.push((new e.Models.Mca).deserialize(t))})}}),l.subscribe("feature",this.featureMessageReceived),a("MCA.DELETE_MSG").then(function(e){t.confirmationMsg1=e}),a("MCA.DELETE_MSG2").then(function(e){t.confirmationMsg2=e})}return t.prototype.getVotingClass=function(e){return null==e||null==this.mca||0===e.userWeight||e.userWeight<-this.mca.userWeightMax||e.userWeight>this.mca.userWeightMax?"disabledMca":e.userWeight>0?"prefer":"avoid"},t.prototype.createDummyMca=function(){var t=new e.Models.Mca;t.title="Mijn Zelfredzaamheid",t.description="Analyse van de zelfredzaamheid van een gemeente.",t.label="mca_zelfredzaamheid",t.stringFormat="{0:0.0}",t.rankTitle="Positie",t.rankDescription="Relatieve positie in de lijst.",t.rankFormat="{0} van {1}",t.userWeightMax=5,t.featureIds=["cities_Default"];var i=new e.Models.Criterion;i.label="p_00_14_jr",i.scores="[0,0 20,1]",i.userWeight=1,t.criteria.push(i),i=new e.Models.Criterion,i.label="p_15_24_jr",i.scores="[0,0 20,1]",i.userWeight=1,t.criteria.push(i),i=new e.Models.Criterion,i.label="p_65_eo_jr",i.scores="[0,0 25,1]",i.userWeight=3,t.criteria.push(i),this.$layerService.project.mcas.push(t),t=new e.Models.Mca,t.title="test",t.label="mca_test",t.stringFormat="{0:0.0}",t.rankTitle="Rang",t.rankFormat="{0} van {1}",t.userWeightMax=3,t.featureIds=["cities_Default"],i=new e.Models.Criterion,i.label="p_15_24_jr",i.scores="[0,0 20,1]",i.userWeight=1,t.criteria.push(i),i=new e.Models.Criterion,i.label="p_65_eo_jr",i.scores="[0,0 25,1]",i.userWeight=3,t.criteria.push(i),this.$layerService.project.mcas.push(t)},t.prototype.toggleMcaChartType=function(){this.showAsterChart=!this.showAsterChart,this.drawChart(this.mca.criteria[0])},t.prototype.toggleSparkline=function(){this.showSparkline=!this.showSparkline,this.showSparkline&&this.drawChart()},t.prototype.weightUpdated=function(e){this.selectedCriterion=e,this.addMca(this.mca),this.updateMca(e)},t.prototype.updateMca=function(e){this.selectedCriterion=e,this.features=[],this.calculateMca(),this.drawChart(e)},t.prototype.editMca=function(e){this.showMcaEditor(e)},t.prototype.createMca=function(){this.showMcaEditor(new e.Models.Mca)},t.prototype.showMcaEditor=function(t){var i=this,r=this.$modal.open({templateUrl:"mcaEditorView.html",controller:e.McaEditorCtrl,resolve:{mca:function(){return t}}});r.result.then(function(e){i.showSparkline=!1,i.addMca(e),i.updateMca()},function(){})},t.prototype.removeMca=function(e){var i=this;if(e){var r=String.format(t.confirmationMsg1,e.title);this.messageBusService.confirm(r,t.confirmationMsg2,function(t){t&&i.$timeout(function(){i.deleteMca(e),i.mca&&i.updateMca()},0)}),this.scopeApply()}},t.prototype.getMcaIndex=function(e){for(var t=-1,i=this.$layerService.project.mcas,r=0;r<i.length;r++)if(i[r].title===e.title){t=r;break}return t},t.prototype.addMca=function(e){e&&(this.deleteMca(e),this.$layerService.project.mcas.push(e),this.addMcaToLocalStorage(e),this.updateAvailableMcas(e))},t.prototype.deleteMca=function(e){if(e){var t=this.getMcaIndex(e);if(!(0>t)){var i=this.$layerService.project.mcas;t>=0&&i.splice(t,1),this.removeMcaFromLocalStorage(e),this.updateAvailableMcas()}}},t.prototype.addMcaToLocalStorage=function(e){var i=this.$localStorageService.get(t.mcas);("undefined"==typeof i||null===i)&&(i=[]),this.removeMcaFromLocalStorage(e),i.push(e),this.$localStorageService.set(t.mcas,i);

},t.prototype.removeMcaFromLocalStorage=function(e){var i=this.$localStorageService.get(t.mcas);if("undefined"!=typeof i&&null!==i){for(var r=-1,a=0;a<i.length;a++)if(i[a].title===e.title){r=a;break}0>r||(i.splice(r,1),this.$localStorageService.set(t.mcas,i))}},t.prototype.scopeApply=function(){"$apply"!==this.$scope.$root.$$phase&&"$digest"!==this.$scope.$root.$$phase&&this.$scope.$apply()},t.prototype.updateSelectedFeature=function(e,i){if(void 0===i&&(i=!1),"undefined"==typeof e||null==e)return void(this.featureIcon="");if(this.selectedFeature=e,this.featureIcon=null!=this.selectedFeature.fType&&null!=this.selectedFeature.fType.style?this.selectedFeature.fType.style.iconUri:"",e.properties.hasOwnProperty(this.mca.label)){this.showFeature=!0,this.properties=[];var r=t.createPropertyType(this.mca),a=csComp.Helpers.convertPropertyInfo(r,e.properties[r.label]);this.properties.push(new FeatureProps.CallOutProperty(r.title,a,r.label,!0,!0,e,!1,r.description,r)),this.mca.rankTitle&&(r=t.createRankPropertyType(this.mca),a=csComp.Helpers.convertPropertyInfo(r,e.properties[r.label]),this.properties.push(new FeatureProps.CallOutProperty(r.title,a,r.label,!1,!1,e,!1,r.description,r))),i&&this.drawChart()}},t.prototype.drawChart=function(e){var t=this;if(this.selectedCriterion=e,this.showChart=!0,this.showFeature?this.showAsterChart?this.drawAsterPlot(e):this.drawHistogram(e):this.drawPieChart(e),this.showSparkline){var i=0;this.mca.criteria.forEach(function(e){var r="histogram_"+i++;if(0===e.criteria.length){var a=e.y;e.userWeight<0&&(a=a.map(function(e){return 1-e})),csComp.Helpers.Plot.drawMcaPlot(e.propValues,{id:r,width:220,height:70,xy:{x:e.x,y:a},featureValue:t.selectedFeature?t.selectedFeature.properties[e.label]:null})}else{var n=0;e.criteria.forEach(function(i){var a=i.y;e.userWeight<0&&(a=a.map(function(e){return 1-e})),csComp.Helpers.Plot.drawMcaPlot(i.propValues,{id:r+"_"+n++,width:220,height:70,xy:{x:i.x,y:a},featureValue:t.selectedFeature?t.selectedFeature.properties[i.label]:null})})}})}},t.prototype.getParentOfSelectedCriterion=function(e){var t,i=this;return this.mca.update(),"undefined"==typeof e||this.mca.criteria.indexOf(e)>=0?(this.selectedCriterion=null,t=this.mca.criteria):this.mca.criteria.forEach(function(r){r.criteria.indexOf(e)>=0&&(i.selectedCriterion=r,t=r.criteria)}),t},t.prototype.drawHistogram=function(e){var i=this;if(this.mca&&this.selectedFeature){var r=this.getParentOfSelectedCriterion(e);if("undefined"!=typeof r&&null!=r){var a=[],n={id:t.mcaChartId,numberOfBins:10,width:240,height:100,selectedValue:this.selectedFeature.properties[this.mca.label]};this.features.forEach(function(e){if(e.properties.hasOwnProperty(i.mca.label)){var t=e.properties[i.mca.label];$.isNumeric(t)&&a.push(t)}}),csComp.Helpers.Plot.drawHistogram(a,n)}}},t.prototype.drawAsterPlot=function(e){var i=this;if(this.mca&&this.selectedFeature){var r=this.getParentOfSelectedCriterion(e);if("undefined"!=typeof r&&null!=r){var a=[],n=0;r.forEach(function(e){var t=e.getScore(i.selectedFeature),r=new csComp.Helpers.AsterPieData;r.id=n++,r.label=e.getTitle(),r.weight=Math.abs(e.weight),r.color=e.color,r.score=100*(e.weight>0?t:1-t),a.push(r)}),csComp.Helpers.Plot.drawAsterPlot(100,a,t.mcaChartId)}}},t.prototype.drawPieChart=function(e){if(this.mca){var i=this.getParentOfSelectedCriterion(e);if("undefined"!=typeof i&&null!=i){var r=[],a=0;i.forEach(function(e){var t=new csComp.Helpers.PieData;t.id=a++,t.label=e.getTitle(),t.weight=Math.abs(e.weight),t.color=e.color,r.push(t)}),csComp.Helpers.Plot.drawPie(100,r,t.mcaChartId)}}},t.prototype.updateAvailableMcas=function(e){var t=this;this.showChart=!1,this.mca=e,this.availableMcas=[],null!=this.$layerService.project.mcas&&this.$layerService.project.mcas.forEach(function(e){e.featureIds.forEach(function(i){if(t.availableMcas.indexOf(e)<0&&t.$layerService.featureTypes.hasOwnProperty(i)){t.availableMcas.push(e);var r=t.$layerService.featureTypes[i];t.applyPropertyInfoToCriteria(e,r)}})}),null==e&&this.availableMcas.length>0&&(this.mca=this.availableMcas[0],this.updateMca())},t.prototype.calculateMca=function(){var e=this;if(this.mca){var t=this.mca;t.featureIds.forEach(function(i){if(e.$layerService.featureTypes.hasOwnProperty(i)&&(e.addPropertyInfo(i,t),e.$layerService.project.features.forEach(function(t){null!=t.featureTypeName&&t.featureTypeName===i&&e.features.push(t)}),0!==e.features.length)){t.updatePla(e.features),t.update();var r=[],a=0;if(e.features.forEach(function(i){var n=t.getScore(i);if(t.rankTitle){var o={score:n,index:a++};r.push(o)}i.properties[t.label]=100*n,e.$layerService.activeMapRenderer.updateFeature(i)}),t.rankTitle){r.sort(function(e,t){return t.score-e.score});for(var n=e.features.length,o=t.scaleMinValue?Math.abs(t.scaleMaxValue-t.scaleMinValue)+1:n,s=Math.ceil(n/o),l=t.scaleMinValue?t.scaleMaxValue>t.scaleMinValue?function(e){return t.scaleMaxValue-Math.round(e/s)}:function(e){return t.scaleMinValue+Math.round(e/s)}:function(e){return e},c=-1,p=1,u=0;n>u;u++){var d=r[u];d.score!==c&&(p=u+1),c=d.score,e.features[d.index].properties[t.label+"#"]=l(p)+","+o}}}}),this.updateSelectedFeature(this.selectedFeature,!1),this.selectedFeature&&this.messageBusService.publish("feature","onFeatureSelect",this.selectedFeature),this.groupStyle&&this.$layerService.updateStyle(this.groupStyle)}},t.prototype.applyPropertyInfoToCriteria=function(e,t){var i=csComp.Helpers.getPropertyTypes(t,this.$layerService.propertyTypeData);0!==i.length&&e.criteria.forEach(function(e){var t=e.label;i.forEach(function(i){i.label===t&&(e.title=i.title,e.description=i.description)})})},t.prototype.addPropertyInfo=function(e,i,r){void 0===r&&(r=!1);for(var a=this.$layerService.featureTypes[e],n=csComp.Helpers.getPropertyTypes(a,this.$layerService.propertyTypeData),o=-1,s=n.length-1;s>=0;s--)if(n[s].label===i.label){o=s;break}if(r||0>o){var l=t.createPropertyType(i);0>o?a.propertyTypeData.push(l):n[o]=l}if(i.rankTitle){for(o=-1,s=n.length-1;s>=0;s--)if(n[s].label===i.rankLabel){o=s;break}(r||0>o)&&(l=t.createRankPropertyType(i),0>o?a.propertyTypeData.push(l):n[o]=l)}},t.prototype.setStyle=function(e){this.groupStyle&&null!=this.groupStyle.group&&null!=this.groupStyle.group.styles&&this.groupStyle.group.styles.filter(function(e){return"fillColor"===e.visualAspect})[0].property===this.mca.label?this.$layerService.updateStyle(this.groupStyle):(this.groupStyle=this.$layerService.setStyle(e,!1),this.groupStyle.colors=["#F04030","#3040F0"],this.$layerService.updateStyle(this.groupStyle))},t.createPropertyType=function(e){var t={title:e.title,label:e.label,type:"number",maxValue:1,minValue:0,description:e.description,stringFormat:e.stringFormat,visibleInCallOut:!0,section:e.section||"MCA"};return t},t.createRankPropertyType=function(e){var t={title:e.rankTitle,label:e.rankLabel,type:"rank",description:e.rankDescription,stringFormat:e.rankFormat,visibleInCallOut:!0,section:e.section||"MCA"};return t},t.mcaChartId="mcaChart",t.mcas="MCAs",t.$inject=["$scope","$modal","$translate","$timeout","localStorageService","layerService","messageBusService"],t}();e.McaCtrl=t}(Mca||(Mca={}));var Mca;!function(e){"use strict";var t=function(){function t(t,i,r,a,n,o){var s=this;this.$scope=t,this.$modalInstance=i,this.$layerService=r,this.$translate=a,this.messageBusService=n,this.mca=o,this.propInfos=[],this.headers=[],this.scoringFunctions=[],t.vm=this,this.scoringFunctions.push(new e.Models.ScoringFunction(1)),this.scoringFunctions.push(new e.Models.ScoringFunction(3)),this.scoringFunctions.push(new e.Models.ScoringFunction(5)),a("MCA.LINEAR").then(function(e){s.scoringFunctions[0].title=e}),a("MCA.SIGMOID").then(function(e){s.scoringFunctions[1].title=e}),a("MCA.GAUSSIAN").then(function(e){s.scoringFunctions[2].title=e}),this.dataset=csComp.Helpers.loadMapLayers(this.$layerService),n.subscribe("layer",function(){s.dataset=csComp.Helpers.loadMapLayers(s.$layerService)}),this.mcaTitle=o.title,this.rankTitle=o.rankTitle,this.scaleMin=o.scaleMinValue,this.scaleMax=o.scaleMaxValue,this.selectedFeatureType=0===o.featureIds.length?"":this.dataset.featureTypes[o.featureIds[0]],this.selectedFeatureType?(this.updatePropertyInfo(this.selectedFeatureType),this.updatePropertyInfoUponEdit(o)):this.selectFirstFeatureType()}return t.prototype.updatePropertyInfoUponEdit=function(e,t){var i=this;e.criteria.forEach(function(e){if(e.label){var r=i.propInfos;for(var a in r)if(r.hasOwnProperty(a)){var n=r[a];if(n.label===e.label){n.isSelected=!0,n.minCutoffValue=e.minCutoffValue,n.maxCutoffValue=e.maxCutoffValue,n.minValue=e.minValue,n.maxValue=e.maxValue,n.userWeight=e.userWeight,t&&(n.category=t);break}}}else i.updatePropertyInfoUponEdit(e,e.title)})},t.prototype.loadPropertyTypes=function(){this.updatePropertyInfo(this.selectedFeatureType)},t.prototype.selectFirstFeatureType=function(){var e=this.dataset.featureTypes;for(var t in e)if(e.hasOwnProperty(t))return this.selectedFeatureType=e[t],void this.updatePropertyInfo(this.selectedFeatureType)},t.prototype.updatePropertyInfo=function(e){var t=this;this.propInfos=[],this.headers=[];var i=[],r=[];if(r.push({label:"Name",visibleInCallOut:!0,title:"Naam",type:"text",filterType:"text",isSelected:!1,scoringFunctionType:this.scoringFunctions[0].type}),null!=e.propertyTypeKeys){var a=e.propertyTypeKeys.split(";");a.forEach(function(i){if(t.$layerService.propertyTypeData.hasOwnProperty(i))r.push(t.$layerService.propertyTypeData[i]);else if(null!=e.propertyTypeData){var a=$.grep(e.propertyTypeData,function(e){return e.label===i});a.length>=1&&r.push(a)}})}else null!=e.propertyTypeData&&e.propertyTypeData.forEach(function(e){return r.push(e)});r.forEach(function(e){e.visibleInCallOut&&"number"===e.type&&e.label.indexOf("mca_")<0&&i.indexOf(e.title)<0&&(i.push(e.title),t.propInfos.push({title:e.title,label:e.label,stringFormat:e.stringFormat,isSelected:!1,maxValue:e.maxValue,minValue:e.minValue,defaultValue:e.defaultValue,description:e.description}))})},t.prototype.toggleSelection=function(e){var t=this.headers.indexOf(e);t>-1?this.headers.splice(t,1):this.headers.push(e)},t.prototype.isDisabled=function(){return"undefined"==typeof this.mcaTitle||0===this.mcaTitle.length?!0:0!==this.propInfos.length&&this.propInfos.reduce(function(e,t){return e||t.isSelected})?!1:!0},t.prototype.save=function(){var t=new e.Models.Mca;t.title=this.mcaTitle||"New MCA criterion",t.label="mca_"+t.title.replace(" ","_"),t.stringFormat="{0:0.0}",this.rankTitle&&(t.rankTitle=this.rankTitle||"Rank",t.rankFormat="{0} / {1}"),this.scaleMin&&this.scaleMax&&(t.scaleMinValue=this.scaleMin,t.scaleMaxValue=this.scaleMax),t.userWeightMax=5;var i=this.dataset.featureTypes;for(var r in i)i.hasOwnProperty(r)&&i[r]===this.selectedFeatureType&&(t.featureIds=[r]);this.propInfos.forEach(function(i){if(i.isSelected){var r=new e.Models.Criterion;if(r.label=i.label,r.title=i.title,r.isPlaScaled=!0,r.description=i.description,r.userWeight=i.userWeight||1,r.minCutoffValue=i.minCutoffValue?+i.minCutoffValue:void 0,r.maxCutoffValue=i.maxCutoffValue?+i.maxCutoffValue:void 0,r.minValue=i.minValue?+i.minValue:void 0,r.maxValue=i.maxValue?+i.maxValue:void 0,r.scores=0===i.scoringFunctionType?i.scores:e.Models.ScoringFunction.createScores(i.scoringFunctionType),i.category){var a;for(var n in t.criteria)if(t.criteria.hasOwnProperty(n)){var o=t.criteria[n];if(o.title===i.category){a=o;break}}null==a&&(a=new e.Models.Criterion,a.title=i.category,a.isPlaUpdated=!1,t.criteria.push(a)),a.criteria.push(r)}else t.criteria.push(r)}}),this.$modalInstance.close(t)},t.prototype.cancel=function(){this.mcaTitle="",this.rankTitle="",this.headers=[],this.$modalInstance.dismiss("cancel")},t.prototype.toggleItemDetails=function(e){this.showItem=this.showItem==e?-1:e},t.$inject=["$scope","$modalInstance","layerService","$translate","messageBusService","mca"],t}();e.McaEditorCtrl=t}(Mca||(Mca={}));var McaEditorView;!function(e){e.html='<div class="modal-content">    <div class="modal-header">        <button type="button" class="close" data-ng-click="vm.cancel()" aria-hidden="true">&times;</button>        <h3 class="modal-title" translate>MCA.EDITOR_TITLE</h3>    </div>    <div class="modal-body container-fluid">        <div class="row-fluid">            <input type="text" class="pull-left" data-ng-model="vm.mcaTitle" style="margin: 0 5px" placeholder="{{ \'MCA.TITLE\' | translate }}" />            <!-- <span><input type="checkbox" data-ng-model="vm.hasRank" style="margin-left: 10px;" /><span translate>MCA.INCLUDE_RANK</span></span>-->            <input type="text" class="pull-left" data-ng-model="vm.rankTitle" style="margin: 0 5px"  placeholder="{{ \'MCA.RANK_TITLE\' | translate }}" />            <input type="text" class="pull-left" data-ng-model="vm.scaleMin" style="width: 100px; margin: 0 5px" placeholder="{{ \'MCA.SCALE_MIN_TITLE\' | translate }}" />            <input type="text" class="pull-left" data-ng-model="vm.scaleMax" style="width: 100px; margin: 0 5px" placeholder="{{ \'MCA.SCALE_MAX_TITLE\' | translate }}" />        </div>        <h4 class="row-fluid" style="margin-top: 5px;" translate>MCA.MAIN_FEATURE</h4>        <select data-ng-model="vm.selectedFeatureType"                data-ng-change="vm.loadPropertyTypes()"                data-ng-options="item as item.name for (key, item) in vm.dataset.featureTypes"                class="form-control row-fluid"></select>        <h4 class="row-fluid" translate>MCA.PROPERTIES</h4>        <ul class="form-group row-fluid" style="margin-top: 1em; margin-left: -2em; overflow-y: auto; overflow-x: hidden;"            resize resize-y="450">            <li ng-repeat="mi in vm.propInfos"                class="row-fluid list-unstyled truncate">                <div style="padding: 5px 0;" class="row-fluid">                    <input type="checkbox" name="vm.selectedTitles[]" value="{{mi.title}}"                           data-ng-checked="mi.isSelected"                           data-ng-click="mi.isSelected = !mi.isSelected">&nbsp;&nbsp;{{mi.title}}                    <div data-ng-if="mi.isSelected" class="pull-right">                        <a href="" class="pull-right"                           style="margin-right: 5px;"                           data-ng-click="vm.toggleItemDetails($index)"><i class="fa fa-2x fa-edit"></i></a>                        <input type="text" class="pull-right"                               style="margin: -2px 5px -2px 0;"                               data-ng-model="mi.category"                               placeholder="{{\'MCA.CATEGORY_MSG\' | translate}}" />                    </div>                    <!--<form data-ng-if="mi.isSelected" name="myForm" style="margin-left: 20px;">                <label id="scoringFunctions" data-ng-repeat="sf in vm.scoringFunctions">                    <input type="radio" data-ng-model="mi.scoringFunctionType" value="{{sf.type}}">                    <a data-ng-href="" data-ng-class="sf.cssClass" data-ng-click="mi.isSelected = !mi.isSelected"></a>                </label>            </form>            <div data-ng-if="mi.scoringFunctionType == 0" style="margin-left: 20px;">                input -> score:&nbsp;<input type="text" data-ng-model="mi.scores" placeholder="[x0,y0 x1,y1 ...]"/>            </div>-->                </div>                <div class="row-fluid" data-ng-show="vm.showItem == {{$index}}" id="scoringFunctions">                    <select class="col-xs-10"                            style="margin-right: 5px; margin-bottom: 5px;"                            data-ng-init="mi.scoringFunctionType = mi.scoringFunctionType || vm.scoringFunctions[0]"                            data-ng-model="mi.scoringFunctionType"                            data-ng-options="sf as sf.title for sf in vm.scoringFunctions"></select>                    <div class="pull-right" data-ng-class="mi.scoringFunctionType.cssClass" style="width: 40px; height: 28px; margin-top: -5px;"></div>                    <div class="row-fluid">                        <input type="text" class="col-xs-3" style="padding: 0;" data-ng-model="mi.minValue" placeholder="{{ \'MCA.MIN_VALUE\' | translate }}" />                        <input type="text" class="col-xs-3" style="padding: 0;" data-ng-model="mi.maxValue" placeholder="{{ \'MCA.MAX_VALUE\' | translate }}" />                        <input type="text" class="col-xs-3" style="padding: 0;" data-ng-model="mi.minCutoffValue" placeholder="{{ \'MCA.MIN_CUTOFF_VALUE\' | translate }}" />                        <input type="text" class="col-xs-3" style="padding: 0;" data-ng-model="mi.maxCutoffValue" placeholder="{{ \'MCA.MAX_CUTOFF_VALUE\' | translate }}" />                    </div>                </div>            </li>        </ul>    </div>    <div class="modal-footer">        <button type="button" class="btn btn-warning" data-ng-click="vm.cancel()" translate>CANCEL_BTN</button>        <button type="button" class="btn btn-primary" data-ng-click="vm.save()" translate>OK_BTN</button>    </div></div>'}(McaEditorView||(McaEditorView={}));var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},Mca;!function(e){var t;!function(e){!function(e){e[e.Manual=0]="Manual",e[e.Ascending=1]="Ascending",e[e.Descending=2]="Descending",e[e.AscendingSigmoid=3]="AscendingSigmoid",e[e.DescendingSigmoid=4]="DescendingSigmoid",e[e.GaussianPeak=5]="GaussianPeak",e[e.GaussianValley=6]="GaussianValley"}(e.ScoringFunctionType||(e.ScoringFunctionType={}));var t=e.ScoringFunctionType,i=function(){function e(e){"undefined"!=typeof e&&null!=e&&(this.type=e),this.title=t[e].toString()}return Object.defineProperty(e.prototype,"cssClass",{get:function(){return t[this.type].toLowerCase()},enumerable:!0,configurable:!0}),e.createScores=function(e){var t;switch(e){default:case 1:t="[0,0 10,1]";break;case 2:t="[0,1 10,0]";break;case 3:t="[0,0.11 1,0.12 2,0.14 3,0.18 4,0.28 5,0.5 6,0.72 7,0.82 8,0.86 9,0.88 10,0.89]";break;case 4:t="[0,0.89 1,0.88 2,0.86 3,0.82 4,0.72 5,0.5 6,0.28 7,0.18 8,0.14 9,0.12 10,0.11]";break;case 5:t="[0,0 2,0.04 3,0.25 4,0.7 5,1 6,0.7 7,0.25 8,0.04 9,0]";break;case 6:t="[0,1 2,0.96 3,0.75 4,0.3 5,0 6,0.3 7,0.75 8,0.96 9,0]"}return t},e}();e.ScoringFunction=i;var r=function(){function e(){}return e}();e.ScoringFunctions=r;var a=function(){function e(){this.userWeight=1,this.propValues=[],this.criteria=[],this.isPlaUpdated=!1,this.isPlaScaled=!1,this.x=[],this.y=[]}return e.prototype.deserialize=function(t){var i=this;return this.title=t.title,this.description=t.description,this.label=t.label,this.color=t.color,this.userWeight=t.userWeight,this.weight=t.weight,this.isPlaScaled=t.isPlaScaled,this.scores=t.scores,this.minCutoffValue=t.minCutoffValue,this.maxCutoffValue=t.maxCutoffValue,this.minValue=t.minValue,this.maxValue=t.maxValue,t.criteria.forEach(function(t){i.criteria.push((new e).deserialize(t))}),this},e.prototype.requiresMinimum=function(){return this.scores&&this.scores.indexOf("min")>=0},e.prototype.requiresMaximum=function(){return this.scores&&this.scores.indexOf("max")>=0},e.prototype.getTitle=function(){return this.title?this.title:this.label},e.prototype.updatePla=function(e){var t=this;if(!this.isPlaUpdated){if(this.criteria.length>0)return this.criteria.forEach(function(t){t.updatePla(e)}),void(this.isPlaUpdated=!0);if(null!=this.scores){var i=this.scores;this.propValues=[],(this.requiresMaximum()||this.requiresMinimum()||this.isPlaScaled)&&e.forEach(function(e){if(e.properties.hasOwnProperty(t.label)){var i=e.properties[t.label];$.isNumeric(i)&&t.propValues.push(i)}});var r=this.maxValue,a=this.minValue;if((this.isPlaScaled||this.requiresMaximum())&&(r=r||Math.max.apply(null,this.propValues),i.replace("max",r.toPrecision(3))),(this.isPlaScaled||this.requiresMinimum())&&(a=a||Math.min.apply(null,this.propValues),i.replace("min",a.toPrecision(3))),this.isPlaScaled){var n=csComp.Helpers.standardDeviation(this.propValues);r=r||Math.min(r,n.avg+2*n.stdDev),a=a||Math.max(a,n.avg-2*n.stdDev)}var o,s,l=i.split(/[^\d\.]+/).filter(function(e){return e.length>0}),c=r-a;if(null!=this.minValue||null!=this.maxValue?(o=c/10,s=a):(o=.08*c,s=a+.1*c),l.length%2!==0)throw Error(this.label+" does not have an even (x,y) pair in scores.");for(var p=0;p<l.length/2;p++){var u=parseFloat(l[2*p]);if(this.isPlaScaled&&(u=o*u+s),p>0&&this.x[p-1]>u)throw Error(this.label+": x should increment continuously.");this.x.push(u);var d=parseFloat(l[2*p+1]);0>d?d=0:d>1&&(d=1),this.y.push(d)}this.isPlaUpdated=!0}}},e.prototype.getScore=function(e){if(!this.isPlaUpdated)throw"Error: PLA must be updated for criterion "+this.title+"!";if(0!==this.criteria.length){var t=0;return this.criteria.forEach(function(i){t+=i.weight>0?i.weight*i.getScore(e):Math.abs(i.weight)*(1-i.getScore(e))}),this.weight>0?this.weight*t:Math.abs(this.weight)*(1-t)}if(!e.properties.hasOwnProperty(this.label))return 0;var i=e.properties[this.label];if(this.maxCutoffValue<=i||i<=this.minCutoffValue)return 0;if(i<this.x[0])return this.y[0];var r=this.x.length-1;if(i>this.x[r])return this.y[r];for(var a=0;a<this.x.length;a++)if(i<this.x[a]){var n=this.x[a-1],o=this.x[a],s=this.y[a-1],l=this.y[a];return(l-s)*(i-n)/(o-n)}return 0},e}();e.Criterion=a;var n=function(e){function t(){e.call(this),this.userWeightMax=5,this.featureIds=[],this.weight=1,this.isPlaUpdated=!1}return __extends(t,e),Object.defineProperty(t.prototype,"rankLabel",{get:function(){return this.label+"#"},enumerable:!0,configurable:!0}),t.prototype.deserialize=function(t){return this.section=t.section,this.stringFormat=t.stringFormat,this.rankTitle=t.rankTitle,this.rankDescription=t.rankDescription,this.rankFormat=t.rankFormat,this.userWeightMax=t.userWeightMax,this.featureIds=t.featureIds,this.minCutoffValue=t.minCutoffValue,this.maxCutoffValue=t.maxCutoffValue,this.minValue=t.minValue,this.maxValue=t.maxValue,this.scaleMinValue=t.scaleMinValue,this.scaleMaxValue=t.scaleMaxValue,e.prototype.deserialize.call(this,t),this},t.prototype.update=function(){this.calculateWeights(),this.setColors()},t.prototype.calculateWeights=function(e){e||(e=this.criteria);var t=0;for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];r.criteria.length>0&&this.calculateWeights(r.criteria),t+=Math.abs(r.userWeight)}if(t>0)for(var a in e)if(e.hasOwnProperty(a)){var n=e[a];n.weight=n.userWeight/t}},t.prototype.setColors=function(){var e=chroma.scale("RdYlBu").domain([0,this.criteria.length-1],this.criteria.length),t=0,i=0;this.criteria.forEach(function(r){t+=r.criteria.length,r.color||(r.color=e(i++).hex())});var r=chroma.scale("PRGn").domain([0,t-1],t);i=0,this.criteria.forEach(function(e){e.criteria.forEach(function(e){e.color||(e.color=r(i++).hex())})})},t}(a);e.Mca=n}(t=e.Models||(e.Models={}))}(Mca||(Mca={}));var OfflineSearch;!function(e){e.html='<form role="search">    <style>        .typeahead-group-header {            margin-left: 10px;            font-weight: bold;            font-size: 120%;        }    </style>    <script type="text/ng-template" id="typeahead-item.html">     <div class="typeahead-group-header" ng-if="match.model.firstInGroup">{{match.model.groupTitle}} >> {{match.model.layerTitle}}</div>     <a>       <span ng-bind-html="match.label.title"></span>     </a>   </script>   <div id="scrollable-dropdown-menu" data-ng-disabled="!vm.isReady" class="form-group has-feedback navbar-right">        <input data-ng-model="vm.searchText"               typeahead="address for address in vm.getLocation($viewValue)"               typeahead-loading="loadingLocations"               typeahead-min-length="3"               typeahead-highlight="true"               typeahead-editable="false"               typeahead-template-url="typeahead-item.html"               typeahead-on-select="vm.onSelect($item, $model, $label)"               id="searchbox"               type="text"               style="width:300px"               class="typeahead form-control">               <!-- placeholder="Zoek in kaartlagen" -->        <!-- <span ng-if="loadingLocations"  id="searchicon" class="fa fa-refresh fa-spin"></span>-->        <span id="searchicon" class="fa fa-search form-control-feedback"></span>    </div></form>'}(OfflineSearch||(OfflineSearch={}));var OfflineSearch;!function(e){var t="csWeb.offlineSearch";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("offlineSearch",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.OfflineSearchCtrl}}])}(OfflineSearch||(OfflineSearch={}));var OfflineSearch;!function(e){var t=function(){function e(e,t,i,r,a,n){this.groupTitle=e,this.index=t,this.id=i,this.title=r,this.path=a,this.type=n,this.featureNames=[]}return e}();e.Layer=t;var i=function(){function e(e,t,i){this.v=Array(2),"number"==typeof e?(this.v[0]=e,this.v[1]=t):this.v=e}return Object.defineProperty(e.prototype,"layerIndex",{get:function(){return this.v[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureIndex",{get:function(){return this.v[1]},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return this.v},e}();e.Entry=i;var r=function(){function e(){}return e}();e.KeywordIndex=r;var a=function(){function e(e,t){this.project=e,this.options=t,this.layers=[],this.keywordIndex={}}return e}();e.OfflineSearchResult=a}(OfflineSearch||(OfflineSearch={}));var OfflineSearch;!function(e){var t=function(){function e(e,t,i,r){this.title=e,this.layerTitle=t,this.groupTitle=i,this.entry=r,this.firstInGroup=!1}return e.prototype.toString=function(){return this.title},Object.defineProperty(e.prototype,"fullTitle",{get:function(){return this.groupTitle+" >> "+this.layerTitle+" >> "+this.title},enumerable:!0,configurable:!0}),e}();e.OfflineSearchResultViewModel=t;var i=function(){function i(e,t,i,r){var a=this;this.$scope=e,this.$layerService=t,this.$mapService=i,this.$messageBus=r,this.isReady=!1,e.vm=this,r.subscribe("project",function(e){switch(e){case"loaded":var i=t.projectUrl.replace("project.json","offline_search_result.json");a.loadSearchResults(i)}}),r.subscribe("language",function(e,t){switch(e){case"newLanguage":}})}return i.prototype.loadSearchResults=function(t){var i=this;$.getJSON(t,function(t){i.offlineSearchResult=t;var r=t.keywordIndex,a={};for(var n in r)r.hasOwnProperty(n)&&r[n].forEach(function(t){a.hasOwnProperty(n)||(a[n]=[]),a[n].push(new e.Entry(t))});i.offlineSearchResult.keywordIndex=a,i.isReady=!0})},i.prototype.getLocation=function(e,i){if(void 0===i&&(i=15),!this.isReady||null===e||e.length<3)return[];var r,a=e.toLowerCase().split(" ");for(var n in a){var o=this.getKeywordHits(a[n]);r=r?this.mergeResults(r,o):o}for(var s=[],l=this.offlineSearchResult.layers,c=i,p=0;c>0&&p<r.length;)for(var u=r[p++],d=Math.min(c,u.entries.length),h=0;d>h;h++){var f=u.entries[h],m=l[f.layerIndex];c--,s.push(new t(m.featureNames[f.featureIndex],m.title,m.groupTitle,f))}var g={};s.forEach(function(e){var t=e.groupTitle+" >> "+e.layerTitle;g.hasOwnProperty(t)||(g[t]=[]),g[t].push(e)}),s=[];for(var v in g)if(g.hasOwnProperty(v)){var y=!0;g[v].forEach(function(e){e.firstInGroup=y,s.push(e),y=!1})}return s},i.prototype.mergeResults=function(e,t){var i=[];return e.forEach(function(e){t.forEach(function(t){e.entries.forEach(function(r){t.entries.forEach(function(a){r.layerIndex===a.layerIndex&&r.featureIndex===a.featureIndex&&i.push({score:e.score*t.score,key:e.key+" "+t.key,entries:[r]})})})})}),i=i.sort(function(e,t){return t.score-e.score})},i.prototype.getKeywordHits=function(e){var t=[],i=this.offlineSearchResult.keywordIndex;for(var r in i)if(i.hasOwnProperty(r)){var a=r.score(e);.5>a||t.push({score:a,key:r,entries:i[r]})}return t=t.sort(function(e,t){return t.score-e.score})},i.prototype.onSelect=function(e){var t=this,i=e.entry.layerIndex,r=this.offlineSearchResult.layers[i],a=this.$layerService.findLayer(r.id);if(console.log(e),a){if(a.enabled)return void this.selectFeature(r.id,e.entry.featureIndex);var n=this.$messageBus.subscribe("layer",function(i,r){"activated"===i&&a.url===r.url&&(t.selectFeature(r.id,e.entry.featureIndex),t.$messageBus.unsubscribe(n))});this.$layerService.addLayer(a)}},i.prototype.selectFeature=function(e,t){var i=this.$layerService.findFeatureById(e,t);null!=i&&(this.$mapService.zoomTo(i),this.$layerService.selectFeature(i))},i.$inject=["$scope","layerService","mapService","messageBusService"],i}();e.OfflineSearchCtrl=i}(OfflineSearch||(OfflineSearch={}));var ProjectSettings;!function(e){e.html='<div>    <div class="wide-tooltip">        <span class="pull-right fa fa-info-circle fa-2x"              tooltip-html-unsafe="{{\'PROJECTSETTINGS.DESCRIPTION\' | translate}}"              tooltip-placement="bottom"              tooltip-trigger="mouseenter"              tooltip-append-to-body="false"              style="margin-right: 5px;"></span>        <h4 class="leftpanel-header" translate="PROJECTSETTINGS.TITLE"></h4>    </div>    <div style="overflow-y: auto; overflow-x: hidden; margin-top: -10px" resize resize-y="95">    </div></div>'}(ProjectSettings||(ProjectSettings={}));var ProjectSettings;!function(e){var t="csWeb.projectSettings";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("projectSettings",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.ProjectSettingsCtrl}}]).directive("bsPopover",function(){return function(e,t,i){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(ProjectSettings||(ProjectSettings={}));var ProjectSettings;!function(e){var t=function(){function e(e,t,i){this.$scope=e,this.$modal=t,this.$layerService=i,e.vm=this}return e.$inject=["$scope","$modal","layerService"],e}();e.ProjectSettingsCtrl=t}(ProjectSettings||(ProjectSettings={}));var Helpers;!function(e){var t;!function(e){var t="csWeb.resize";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("resize",["$window",function(e){return{terminal:!1,restrict:"A",scope:{resizeX:"@",resizeY:"@"},link:function(t,i,r){t.onResizeFunction=function(){if(t.resizeX){var r=e.innerWidth;i.width(r-t.resizeX+"px")}if(t.resizeY){var a=e.innerHeight;i.height(a-t.resizeY+"px")}},t.onResizeFunction(),angular.element(e).bind("resize",function(){t.onResizeFunction(),t.$apply()})}}}])}(t=e.Resize||(e.Resize={}))}(Helpers||(Helpers={}));var ShowModal;!function(e){var t="csWeb.showModal";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("showModal",["$parse",function(e){return{restrict:"A",link:function(t,i,r){t.showModalDialog=function(e,t){t||(t=i);var r=$(t);e?r.appendTo("body").modal("show"):r.modal("hide")},t.$watch(r.showModal,function(e,i){t.showModalDialog(e,r.$$element)}),$(i).bind("hide.bs.modal",function(){e(r.showModal).assign(t,!1),t.$$phase||t.$root.$$phase||t.$apply()})}}}])}(ShowModal||(ShowModal={}));var StyleList;!function(e){e.html='<div>    <h4 class="leftpanel-header" translate="STYLES"></h4>    <div ng-show="vm.$layerService.noStyles" translate="STYLE_INFO"></div>    <div data-ng-repeat="group in vm.$layerService.project.groups" style="margin-left: 5px">        <div ng-show="group.styles.length">            <div style="float:left;margin-left: -10px; margin-top: 5px" data-toggle="collapse" data-target="#stylegroup_{{group.id}}"><i class="fa fa-chevron-down togglebutton toggle-arrow-down"></i><i class="fa fa-chevron-up togglebutton toggle-arrow-up"></i></div>            <div class="group-title">{{group.title}}</div>            <div id="stylegroup_{{group.id}}" class="collapse in">                <div data-ng-repeat="style in group.styles">                    <div class="checkbox checkbox-primary" style="margin-left:20px;float:left">                        <input type="checkbox" id="cbstyle{{style.id}}" ng-model="style.enabled" data-ng-change="vm.$layerService.updateStyle(style);">                        <label class="style-title" for="cbstyle{{style.id}}" style="width:175px">{{style.title}}</label>                    </div>                    <div style="float:right;margin-top:10px; width: 50px">                        <div data-ng-show="style.canSelectColor" style="float:left">                            <div class="dropdown">                                <div class="style-settings" data-toggle="dropdown">                                    <style>                                                                             </style>                                    <!--<img src="includes/images/fillcolor.png" style="width: 32px; height:32px" />-->                                    <div id="colors" style="border-radius: 50%;width: 20px;height:20px;border-style:solid;border-color: black;border-width: 1px;background: linear-gradient(to right, {{style.colors[0]}} , {{style.colors[1]}})">                                                                        </div>                                    <b class="caret"></b>                                </div>                                <!--<a class="btn btn-primary btn-sm" ng-model="style.visualAspect"  style="padding-left: 10px" href="#"> {{ style.visualAspect }} </a>-->                                <ul class="dropdown-menu" role="menu">                                    <li ng-repeat="(key,val) in style.colorScales" style="margin:3px;cursor: pointer">                                        <span ng-click="vm.$layerService.updatePropertyStyle(key,val,$parent);                                              $parent.style.colors = val;                                              vm.$layerService.updateStyle($parent.style)"> {{key}} </span>                                    </li>                                </ul>                            </div>                        </div>                        <div style="float:right">                            <div class="dropdown">                                <div class="style-settings" data-toggle="dropdown">                                    <!--<img src="includes/images/fillcolor.png" style="width: 32px; height:32px" />-->                                    <div class="style-aspect style-{{style.visualAspect}}"></div><b class="caret"></b>                                </div>                                <!--<a class="btn btn-primary btn-sm" ng-model="style.visualAspect"  style="padding-left: 10px" href="#"> {{ style.visualAspect }} </a>-->                                <ul class="dropdown-menu" role="menu">                                    <li ng-repeat="title in style.availableAspects" style="margin:3px;cursor: pointer">                                        <i class="style-aspect style-{{title}}" style="float:left" /><span ng-click="$parent.style.visualAspect = title;vm.$layerService.updateStyle($parent.style)"><img class="fa fa-search" style="margin-right: 8px" /> {{title}} </span>                                    </li>                                    <li class="divider"></li>                                    <li style="margin:3px;cursor: pointer"><i class="fa fa-remove" style="margin-right: 8px" style=" float:left" /><span ng-click="vm.$layerService.removeStyle(style)">Verwijder</span></li>                                </ul>                            </div>                        </div>                    </div>                </div>                <!--<div style="right:5px; position:absolute; margin-top: -15px"><a href="#" id="stylepop{{style.id}}" rel="popover" popover-template="template.html"><img src="includes/images/settings.png" width="20px"></a></div>-->            </div>        </div>    </div></div>';

}(StyleList||(StyleList={}));var StyleList;!function(e){var t="csWeb.styleList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("styleList",["$window","$compile",function(t,i){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e,i,r){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.StyleListCtrl}}]).directive("bsPopover",function(){return function(e,t,i){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(StyleList||(StyleList={}));var StyleList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.$inject=["$scope","layerService"],e}();e.StyleListCtrl=t}(StyleList||(StyleList={}));var Timeline;!function(e){e.html='<div>    <div id="timelinecontainer">        <div id="timeline"></div>    </div>    <div class="callout top" id="focustimeContainer" ng-class="{showControl : vm.showControl}" ng-mouseenter="vm.mouseEnter()" ng-mouseleave="vm.mouseLeave()">        <div ng-show="vm.showControl" class="timelineControl" ng-class="{isPlaying : vm.isPlaying}">            <span ng-hide="vm.$layerService.project.timeLine.isLive" class="focustimeButton">                <div ng-hide="vm.isPlaying" class="fa fa-play focustimeButton" ng-click="vm.start()"></div>                <div ng-show="vm.isPlaying" class="fa fa-stop focustimeButton" ng-click="vm.stop()"></div>            </span>            <div style="float: right">{{vm.$layerService.project.timeLine.levelName}}</div>            <div ng-click="vm.toggleLive()" class="islivebutton" ng-show="vm.$layerService.project.timeLine.isLive" style="float: right">live</div>            <div ng-click="vm.toggleLive()" class="livebutton" ng-hide="vm.$layerService.project.timeLine.isLive" style="float: right">go live</div>            <!--<div ng-hide="vm.isPinned" class="fa fa-thumb-tack focustimeButton pinButton" ng-class="{isPinned : vm.isPinned}" ng-click="vm.pinToNow()"></div>-->        </div>        <div class="focustimeText">            <span style="font-weight: bold">{{vm.line1}}</span><br />            <span>{{vm.line2}}</span>        </div>    </div></div>'}(Timeline||(Timeline={}));var Timeline;!function(e){var t=function(){function e(){this.timelineOptions={width:"100%",height:"100px",editable:!1,layout:"box"}}return e.prototype.setTimelineOptions=function(e){this.timelineOptions=e},e.prototype.$get=function(){var e=this;return{getTimelineOptions:function(){return e.timelineOptions},setTimelineOptions:function(t){return e.setTimelineOptions}}},e}(),i="csWeb.timeline";e.myModule;try{e.myModule=angular.module(i)}catch(r){e.myModule=angular.module(i,[])}e.myModule.provider("TimelineService",t).directive("timeline",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.TimelineCtrl}}])}(Timeline||(Timeline={}));var Timeline;!function(e){var t=function(){function e(e,t,i,r,a){var n=this;this.$scope=e,this.$layerService=t,this.$mapService=i,this.$messageBusService=r,this.TimelineService=a,this.locale="en-us",this.loadLocales(),e.vm=this,this.initTimeline(),this.$messageBusService.subscribe("timeline",function(e,i){switch(e){case"updateTimerange":n.$scope.timeline.setVisibleChartRange(i.start,i.end),n.updateFocusTime();break;case"loadProjectTimeRange":if("undefined"==typeof t.project||null===t.project||"undefined"==typeof t.project.timeLine||null===t.project.timeLine)return;n.$scope.timeline.setVisibleChartRange(t.project.timeLine.start,t.project.timeLine.end),n.updateFocusTime()}}),this.$messageBusService.subscribe("language",function(e,t){switch(e){case"newLanguage":n.initTimeline()}})}return e.prototype.initTimeline=function(){var e=this,t=this.TimelineService.getTimelineOptions();t.locale=this.$layerService.currentLocale,this.$layerService.timeline=this.$scope.timeline=new links.Timeline(document.getElementById("timeline"),t),this.$scope.timeline.draw(),links.events.addListener(this.$scope.timeline,"rangechange",_.throttle(function(t){return e.onRangeChanged(t)},200)),links.events.addListener(this.$scope.timeline,"rangechange",function(){e.$layerService.project&&e.$layerService.project.timeLine.isLive&&e.myTimer()}),"undefined"!=typeof this.$layerService.project&&null!==this.$layerService.project.timeLine&&this.$scope.timeline.setVisibleChartRange(this.$layerService.project.timeLine.start,this.$layerService.project.timeLine.end),this.updateDragging(),this.updateFocusTime()},e.prototype.updateDragging=function(){var e=this;this.$layerService.project&&this.$layerService.project.timeLine.isLive?$("#focustimeContainer").draggable("disable"):($("#focustimeContainer").draggable({axis:"x",containment:"parent",drag:_.throttle(function(){return e.updateFocusTime()},200)}),$("#focustimeContainer").draggable("enable"))},e.prototype.onRangeChanged=function(e){this.updateFocusTime()},e.prototype.start=function(){var e=this;this.stop(),this.isPlaying=!0,this.timer&&(this.timer=null),this.timer=setInterval(function(){e.myTimer()},500)},e.prototype.toggleLive=function(){this.$layerService.project&&(this.stop(),this.$layerService.project.timeLine.isLive=!this.$layerService.project.timeLine.isLive,this.$layerService.project.timeLine.isLive&&(this.myTimer(),this.start()),this.updateDragging())},e.prototype.myTimer=function(){var e=this.$scope.timeline;if(this.$layerService.project.timeLine.isLive){var t=e.timeToScreen(new Date);$("#focustimeContainer").css("left",t-75),this.$scope.$apply(),this.updateFocusTime()}else e.move(.005),this.updateFocusTime()},e.prototype.mouseEnter=function(){this.showControl=!0},e.prototype.mouseLeave=function(){this.isPlaying||(this.showControl=!1)},e.prototype.pinToNow=function(){this.isPinned=!0,this.start()},e.prototype.stop=function(){this.isPlaying=!1,this.timer&&clearInterval(this.timer)},e.prototype.updateFocusTime=function(){var e=this.$scope.timeline;e.showCustomTime=!0,e.setCustomTime="undefined"==typeof this.$layerService.project?new Date:this.$layerService.project.timeLine.focusDate();var t=$("#focustimeContainer").offset().left,i=$("#timelinecontainer").offset().left-15,r=t-i+$("#focustimeContainer").width()/2,a=this.$scope.timeline.getVisibleChartRange();if(this.focusDate=new Date(this.$scope.timeline.screenToTime(r)),this.startDate=a.start,this.endDate=a.end,null!=this.$layerService.project&&null!=this.$layerService.project.timeLine){var n=this.$layerService.project.timeLine;n.setFocus(this.focusDate,this.startDate,this.endDate);var o=this.focusDate.toLocaleString(this.locale,{month:"long"});switch(n.zoomLevelName){case"decades":this.line1=this.focusDate.getFullYear().toString(),this.line2="";break;case"years":this.line1=this.focusDate.getFullYear().toString(),this.line2=o;break;case"weeks":this.line1=this.focusDate.getFullYear().toString(),this.line2=moment(this.focusDate).format("DD")+" "+o;break;case"milliseconds":this.line1=moment(this.focusDate).format("MM - DD - YYYY"),this.line2=moment(this.focusDate).format("HH:mm:ss.SSS");break;default:this.line1=moment(this.focusDate).format("MM - DD - YYYY"),this.line2=moment(this.focusDate).format("HH:mm:ss")}}this.$messageBusService.publish("timeline","focusChange",this.focusDate)},e.prototype.loadLocales=function(){"undefined"==typeof links?(links={},links.locales={}):"undefined"==typeof links.locales&&(links.locales={}),links.locales.en={MONTHS:["January","February","March","April","May","June","July","August","September","October","November","December"],MONTHS_SHORT:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DAYS:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],DAYS_SHORT:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ZOOM_IN:"Zoom in",ZOOM_OUT:"Zoom out",MOVE_LEFT:"Move left",MOVE_RIGHT:"Move right",NEW:"New",CREATE_NEW_EVENT:"Create new event"},links.locales.en_US=links.locales.en,links.locales.en_UK=links.locales.en,links.locales.fr={MONTHS:["Janvier","Fvrier","Mars","Avril","Mai","Juin","Juillet","Aot","Septembre","Octobre","Novembre","Dcembre"],MONTHS_SHORT:["Jan","Fev","Mar","Avr","Mai","Jun","Jul","Aou","Sep","Oct","Nov","Dec"],DAYS:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],DAYS_SHORT:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],ZOOM_IN:"Zoomer",ZOOM_OUT:"Dzoomer",MOVE_LEFT:"Dplacer  gauche",MOVE_RIGHT:"Dplacer  droite",NEW:"Nouveau",CREATE_NEW_EVENT:"Crer un nouvel vnement"},links.locales.fr_FR=links.locales.fr,links.locales.fr_BE=links.locales.fr,links.locales.fr_CA=links.locales.fr,links.locales.de={MONTHS:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],MONTHS_SHORT:["Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],DAYS:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],DAYS_SHORT:["Son","Mon","Die","Mit","Don","Fre","Sam"],ZOOM_IN:"Vergrern",ZOOM_OUT:"Verkleinern",MOVE_LEFT:"Nach links verschieben",MOVE_RIGHT:"Nach rechts verschieben",NEW:"Neu",CREATE_NEW_EVENT:"Neues Ereignis erzeugen"},links.locales.de_DE=links.locales.de,links.locales.de_CH=links.locales.de,links.locales.nl={MONTHS:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],MONTHS_SHORT:["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"],DAYS:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],DAYS_SHORT:["zo","ma","di","wo","do","vr","za"],ZOOM_IN:"Inzoomen",ZOOM_OUT:"Uitzoomen",MOVE_LEFT:"Naar links",MOVE_RIGHT:"Naar rechts",NEW:"Nieuw",CREATE_NEW_EVENT:"Nieuwe gebeurtenis maken"},links.locales.nl_NL=links.locales.nl,links.locales.nl_BE=links.locales.nl},e.$inject=["$scope","layerService","mapService","messageBusService","TimelineService"],e}();e.TimelineCtrl=t}(Timeline||(Timeline={}));var Voting;!function(e){var t="csWeb.voting";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("voting",["$timeout",function(e){return{restrict:"EA",require:"^ngModel",scope:{min:"=",max:"=",ngModel:"=",ngChange:"&"},template:'<div style="line-height: 12px; vertical-align: top; margin: 0; background: rgba(0, 0, 0, 0.1); border-radius: 6px; padding: 4px 6px;"><a href="" data-ng-click="decrement()" data-ng-disabled="ngModel <= min" style="float: left;"><i class="fa" data-ng-class="{true: \'fa-minus-square\', false: \'fa-minus-square-o\'}[ngModel > min]"></i></a><span style="float: left; width:28px; text-align: center;">{{ngModel}}</span><a href="" data-ng-click="increment()" data-ng-disabled="ngModel >= max"><i class="fa" data-ng-class="{true: \'fa-plus-square\' , false: \'fa-plus-square-o\' }[ngModel < max]"></i></a></div>',link:function(t){t.increment=function(){t.ngModel>=t.max||(t.ngModel++,e(t.ngChange,0))},t.decrement=function(){t.ngModel<=t.min||(t.ngModel--,e(t.ngChange,0))}}}}])}(Voting||(Voting={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(){this.theKeys=[],this.theValues=[]}return e.prototype.initialize=function(e){for(var t=0;t<e.length;t++)this[e[t].key]=e[t].value,this.theKeys.push(e[t].key),this.theValues.push(e[t].value)},e.prototype.add=function(e,t){this[e]=t,this.theKeys.push(e),this.theValues.push(t)},e.prototype.remove=function(e){var t=this.theKeys.indexOf(e,0);this.theKeys.splice(t,1),this.theValues.splice(t,1),delete this[e]},e.prototype.clear=function(){for(var e=this.theKeys.length;e>=0;e--){var t=this.theKeys[e];this.remove(t)}},e.prototype.count=function(){return this.theKeys.length},e.prototype.keys=function(){return this.theKeys},e.prototype.values=function(){return this.theValues},e.prototype.containsKey=function(e){return"undefined"!=typeof this[e]},e.prototype.toLookup=function(){return this},e}();e.Dictionary=t}(t=e.Helpers||(e.Helpers={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(){}return e.deg2rad=function(e){var t=2*Math.PI/360;return e*t},e.rad2deg=function(e){var t=360/(2*Math.PI);return e*t},e.log10=function(e){return Math.LOG10E*Math.log(e)},e.convertDegreesToMeters=function(t){var i=e.deg2rad(t),r=111132.92,a=-559.82,n=1.175,o=-.0023,s=111412.84,l=-93.5,c=.118,p=r+a*Math.cos(2*i)+n*Math.cos(4*i)+o*Math.cos(6*i),u=s*Math.cos(i)+l*Math.cos(3*i)+c*Math.cos(5*i);return{latitudeLength:p,longitudeLength:u}},e}();e.GeoExtensions=t}(t=e.Helpers||(e.Helpers={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(t){function i(e){var t=omnivore.topojson.parse(e),i={};return i.featureTypes=e.featureTypes,i.features=[],t.eachLayer(function(e){i.features.push(e.feature)}),i}function r(){var e="Microsoft Internet Explorer"===navigator.appName,t=!!navigator.userAgent.match(/Trident\/7\./);return!(e||t)}function a(e){var t=n(e),i=e.map(function(e){var i=e-t,r=i*i;return r}),r=n(i),a=Math.sqrt(r);return{avg:t,stdDev:a}}function n(e){var t=e.reduce(function(e,t){return e+t},0),i=t/e.length;return i}function o(e,t){var i=[];if(null!=e.propertyTypeKeys){var r=e.propertyTypeKeys.split(";");r.forEach(function(r){if(t.hasOwnProperty(r))i.push(t[r]);else if(null!=e.propertyTypeData){var a=$.grep(e.propertyTypeData,function(e){return e.label===r});a.length>=1&&i.push(a)}})}return null!=e.propertyTypeData&&e.propertyTypeData.forEach(function(e){i.push(e)}),i}function s(t,i){var r;if(e.StringExt.isNullOrEmpty(i)||$.isNumeric(i)||(i=i.replace(/&amp;/g,"&")),e.StringExt.isNullOrEmpty(i))return i;switch(t.type){case"bbcode":e.StringExt.isNullOrEmpty(t.stringFormat)||(i=String.format(t.stringFormat,i)),r=XBBCODE.process({text:i}).html;break;case"number":r=$.isNumeric(i)?t.stringFormat?String.format(t.stringFormat,parseFloat(i)):i.toString():i;break;case"options":r=$.isNumeric(i)?t.options[i]:i;break;case"rank":var a=i.split(",");if(2!=a.length)return i;r=t.stringFormat?String.format(t.stringFormat,a[0],a[1]):String.format("{0) / {1}",a[0],a[1]);break;default:r=i}return r}function l(e){if(!e.properties.hasOwnProperty("Name")){var i=e.fType.style.nameLabel;if(i&&e.properties.hasOwnProperty(i))return void(e.properties.Name=e.properties[i]);if(null!=e.fType.propertyTypeData)for(var r=0;r<e.fType.propertyTypeData.length;r++){var a=e.fType.propertyTypeData[r];if("Name"===a.label)return void(e.properties.Name=t.convertStringFormat(e,a.stringFormat))}for(var n in e.properties)return void(e.properties.Name=n.toString());e.properties.Name=t.getGuid()}}function c(e,i){for(var r=t.indexes(i,"{"),a=t.indexes(i,"}"),n=i,o=0;o<r.length;o++){var s=i.substring(r[o]+1,a[o]);n=n.replace("{"+s+"}",e.properties[s])}return n}function p(e,t){for(var i=[],r=0;r<e.length;r++)e.substr(r,t.length)===t&&i.push(r);return i}function u(){var e=(this.S4()+this.S4()+"-"+this.S4()+"-4"+this.S4().substr(0,3)+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()).toLowerCase();return e}function d(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function h(e){var t={type:"",features:[],featureTypes:{}};return e.project.groups.forEach(function(e){null!=e.filterResult&&e.filterResult.forEach(function(e){return t.features.push(e)})}),0===t.features.length&&(t.features=e.project.features),t.features.forEach(function(i){if(!t.featureTypes.hasOwnProperty(i.featureTypeName)){var r=e.featureTypes[i.featureTypeName];r.name||(r.name=i.featureTypeName.replace("_Default","")),t.featureTypes[i.featureTypeName]=r}}),t}t.convertTopoToGeoJson=i,t.supportsDataUri=r,t.standardDeviation=a,t.average=n,t.getPropertyTypes=o,t.convertPropertyInfo=s,t.setFeatureName=l,t.convertStringFormat=c,t.indexes=p,t.getGuid=u,t.S4=d,t.loadMapLayers=h}(t=e.Helpers||(e.Helpers={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(){}return e}();e.PieData=t;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.AsterPieData=i;var r=function(){function e(){}return e.drawHistogram=function(t,i){var r=null!=i&&i.hasOwnProperty("id")?i.id:"myHistogram",a=null!=i&&i.hasOwnProperty("numberOfBins")?i.numberOfBins:10,n=null!=i&&i.hasOwnProperty("width")?i.width:200,o=null!=i&&i.hasOwnProperty("height")?i.height:150,s=null!=i&&i.hasOwnProperty("xLabel")?i.xLabel:"",l=null!=i&&i.hasOwnProperty("selectedValue")?i.selectedValue:null,c={top:0,right:6,bottom:24,left:6};n-=c.left+c.right,o-=c.top+c.bottom;var p="the_SVG_ID";if(e.clearSvg(p),!(t.length<a)){var u=d3.format(",.0f"),d=Math.max.apply(null,t),h=Math.min.apply(null,t),f=d-h,m=e.getScale(f/a,d),g=0;Math.abs(m)>0&&(s+=" (x10^"+m+")",g=Math.pow(10,m));var v=function(e){return g>0?d3.round(e/g,0).toString():d3.round(e,0).toString()},y=d3.scale.linear().domain([0,a]).range([h,d]),b=d3.range(a+1).map(y),S=d3.scale.linear().domain([h,d]).range([0,n]),w=d3.svg.axis().scale(S).tickValues(b).tickFormat(v).orient("bottom"),M=d3.layout.histogram().bins(a)(t),x=d3.scale.linear().domain([0,d3.max(M,function(e){return e.y})]).range([o,0]),$=d3.select("#"+r).append("svg").attr("id",p).attr("width",n+c.left+c.right).attr("height",o+c.top+c.bottom).attr("style","display: block; margin: 0 auto;").append("g").attr("transform","translate("+c.left+","+c.top+")"),T=$.selectAll(".bar").data(M).enter().append("g").attr("class",function(e,t){return null!=l&&e.x<l&&l<e.x+M[t].dx?"bar highlight":"bar"}).attr("transform",function(e){return"translate("+S(e.x)+","+x(e.y)+")"});T.append("rect").attr("x",1).attr("width",S(h+M[0].dx)-1).attr("height",function(e){return o-x(e.y)});var E=function(e){return o-x(e)>6?u(e):""};T.append("text").attr("dy",".75em").attr("y",6).attr("x",S(h+M[0].dx)/2).attr("text-anchor","middle").text(function(e){return E(e.y)}),$.append("text").attr("class","x label").attr("text-anchor","end").attr("x",n).attr("y",o/2-6).text(s),$.append("g").attr("class","x axis").attr("transform","translate(0,"+o+")").call(w)}},e.getScale=function(e,t){for(var i=-5;5>i;i++){var r=Math.pow(10,i),a=d3.round(e/r,0),n=d3.round(t/r,0);if(a>0&&10>a&&n>0&&100>n)return i}return 0},e.drawMcaPlot=function(t,i){var r=null!=i&&i.hasOwnProperty("id")?i.id:"myHistogram",a=null!=i&&i.hasOwnProperty("numberOfBins")?i.numberOfBins:10,n=null!=i&&i.hasOwnProperty("width")?i.width:200,o=null!=i&&i.hasOwnProperty("height")?i.height:150,s=null!=i&&i.hasOwnProperty("xLabel")?i.xLabel:"",l=null!=i&&i.hasOwnProperty("xy")?i.xy:null,c=null!=i&&i.hasOwnProperty("featureValue")?i.featureValue:null,p={top:0,right:6,bottom:24,left:6};n-=p.left+p.right,o-=p.top+p.bottom;var u=r+"_histogram";e.clearSvg(u);var d,h,f,m=d3.format(",.0f");null!=l?(d=l.x[l.x.length-1],h=l.x[0],f=d-h,d+=f/10,h-=f/10,f=d-h):(d=Math.max.apply(null,t),h=Math.min.apply(null,t),f=d-h);var g=e.getScale(f/a,d),v=0;s+=" (",Math.abs(g)>0&&(s+="x10^"+g,v=Math.pow(10,g));var y=function(e){return v>0?d3.round(e/v,0).toString():d3.round(e,0).toString()},b=d3.scale.linear().domain([0,a]).range([h,d]),S=d3.range(a+1).map(b),w=d3.scale.linear().domain([h,d]).range([0,n]),M=d3.svg.axis().scale(w).tickValues(S).tickFormat(y).orient("bottom"),x=t.filter(function(e){return e>=h&&d>=e});if(x.length<3){var $=d3.select("#"+r).append("svg").attr("id",u).attr("width",n+p.left+p.right).attr("height",o+p.top+p.bottom).append("g").attr("transform","translate("+p.left+","+p.top+")");return void $.append("text").attr("class","x label").attr("text-anchor","center").attr("x",n/2).attr("y",o/2+6).text(" NO DATA IN RANGE")}s+=" "+x.length;var T=d3.layout.histogram().bins(a)(x),E=d3.scale.linear().domain([0,d3.max(T,function(e){return e.y})]).range([o,0]),L=d3.select("#"+r).append("svg").attr("id",u).attr("width",n+p.left+p.right).attr("height",o+p.top+p.bottom).attr("style","display: block; margin: 0 auto;").append("g").attr("transform","translate("+p.left+","+p.top+")"),C=L.selectAll(".bar").data(T).enter().append("g").attr("class","bar").attr("transform",function(e){return"translate("+w(e.x)+","+E(e.y)+")"});C.append("rect").attr("x",1).attr("width",w(h+T[0].dx)-1).attr("height",function(e){return o-E(e.y)});var k=function(e){return o-E(e)>6?m(e):""};if(C.append("text").attr("dy",".75em").attr("y",6).attr("x",w(h+T[0].dx)/2).attr("text-anchor","middle").text(function(e){return k(e.y)}),s+=")",L.append("text").attr("class","x label").attr("text-anchor","end").attr("x",n).attr("y",o/2-6).text(s),L.append("g").attr("class","x axis").attr("transform","translate(0,"+o+")").call(M),null!=l){var F=[];F.push({x:h,y:l.y[0]});for(var I=0;I<l.x.length;I++)F.push({x:l.x[I],y:l.y[I]});F.push({x:d,y:l.y[l.y.length-1]});var O=d3.scale.linear().domain([0,d3.max(F,function(e){return e.y})]).range([o-1,1]),A=d3.svg.line().x(function(e){return w(e.x)}).y(function(e){return O(e.y)}).interpolate("linear");L.append("svg:path").attr("d",A(F)).attr("stroke","red").attr("stroke-width",2).attr("fill","none"),null!=c&&(F=[],F.push({x:c,y:0}),F.push({x:c,y:o}),L.append("svg:path").attr("d",A(F)).attr("stroke","blue").attr("stroke-width",2).attr("fill","none"))}},e.drawPie=function(t,i,r,a,n){if(void 0===r&&(r="mcaPieChart"),void 0===a&&(a="Reds"),void 0===n&&(n="the_SVG_ID"),e.clearSvg(n),i){var o=t,s=t,l=Math.min(o,s)/2,c=0,p=d3.layout.pie().sort(null).value(function(e){return e.weight}),u=d3.tip().attr("class","d3-tip").offset([0,0]).html(function(e){return"<strong>"+e.data.label+": </strong><span style='color:orangered'>"+Math.round(100*e.data.weight)+"%</span>"}),d=d3.svg.arc().innerRadius(c).outerRadius(l),h=d3.svg.arc().innerRadius(c).outerRadius(l),f=d3.select("#"+r).append("svg").attr("id",n).attr("width",o).attr("height",s).attr("style","display: block; margin: 0 auto;").append("g").attr("transform","translate("+o/2+","+s/2+")"),m=chroma.scale(a).domain([0,i.length-1],i.length);f.selectAll(".solidArc").data(p(i)).enter().append("path").attr("fill",function(e,t){return e.data.color||m(t).hex()}).attr("class","solidArc").attr("stroke","gray").attr("d",d).on("mouseover",function(e,t){u.show(e,t)}).on("mouseout",u.hide),f.selectAll(".outlineArc").data(p(i)).enter().append("path").attr("fill","none").attr("stroke","gray").attr("class","outlineArc").attr("d",h)}},e.drawAsterPlot=function(t,i,r,a,n){if(void 0===r&&(r="mcaPieChart"),void 0===a&&(a="Reds"),void 0===n&&(n="the_SVG_ID"),e.clearSvg(n),i){var o=t,s=t,l=Math.min(o,s)/2,c=.3*l,p=d3.layout.pie().sort(null).value(function(e){return e.weight}),u=d3.tip().attr("class","d3-tip").offset([0,0]).html(function(e){return"<strong>"+e.data.label+": </strong> <span style='color:orangered'>"+Math.round(100*e.data.weight)+"% x "+Math.round(e.data.score)+"&nbsp; = "+Math.round(e.data.weight*e.data.score)+"</span>"}),d=d3.svg.arc().innerRadius(c).outerRadius(function(e){return(l-c)*(e.data.score/100)+c}),h=d3.svg.arc().innerRadius(c).outerRadius(l),f=d3.select("#"+r).append("svg").attr("id",n).attr("width",o).attr("height",s).attr("style","display: block; margin: 0 auto;").append("g").attr("transform","translate("+o/2+","+s/2+")");try{f.call(u)}catch(m){console.log("Error: "+m.message)}var g=chroma.scale(a).domain([0,i.length-1],i.length),v=(f.selectAll(".solidArc").data(p(i)).enter().append("path").attr("fill",function(e,t){return e.data.color||g(t).hex()}).attr("class","solidArc").attr("stroke","gray").attr("d",d).on("mouseover",function(e,t){u.show(e,t)}).on("mouseout",u.hide),f.selectAll(".outlineArc").data(p(i)).enter().append("path").attr("fill","none").attr("stroke","gray").attr("class","outlineArc").attr("d",h),0),y=0;i.forEach(function(e){v+=e.weight,y+=e.weight*e.score}),f.append("svg:text").attr("class","aster-score").attr("dy",".35em").attr("text-anchor","middle").text(Math.round(y/v))}},e.clearSvg=function(e){var t=d3.select("#"+e);t&&t.remove()},e.pieColors=["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],e}();e.Plot=r}(t=e.Helpers||(e.Helpers={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){function t(e){return!e}function i(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var r=t.length;r--;)e=e.replace(new RegExp("\\{"+r+"\\}","gm"),t[r]);return e}function r(e){return!isNaN(parseFloat(e))&&isFinite(e)}function a(e){return"true"===e||"false"===e}function n(e){return!1}e.isNullOrEmpty=t,e.format=i,e.isNumber=r,e.isBoolean=a,e.isBbcode=n}(t=e.StringExt||(e.StringExt={}))}(csComp||(csComp={})),String.prototype.score=function(e,t){"use strict";if(this===e)return 1;if(""===e)return 0;var i,r,a,n,o,s=0,l=this,c=l.toLowerCase(),p=l.length,u=e.toLowerCase(),d=e.length,h=0,f=1;if(t&&(n=1-t),t)for(o=0;d>o;o+=1)a=c.indexOf(u[o],h),-1===a?f+=n:(h===a?i=.7:(i=.1," "===l[a-1]&&(i+=.8)),l[a]===e[o]&&(i+=.1),s+=i,h=a+1);else for(o=0;d>o;o+=1){if(a=c.indexOf(u[o],h),-1===a)return 0;h===a?i=.7:(i=.1," "===l[a-1]&&(i+=.8)),l[a]===e[o]&&(i+=.1),s+=i,h=a+1}return r=.5*(s/p+s/d)/f,u[0]===c[0]&&.85>r&&(r+=.15),r};var csComp;!function(e){var t;!function(e){function t(e,t){if(t.activeLegend){var i="#000000",r=t.activeLegend,a=(r.id,r.legendEntries.length);if(0==a)return i;if("discretestrings"==r.legendKind){for(var n=0;a>n;){var o=r.legendEntries[n];if(e==o.stringValue)return o.color;n++}return i}return i}}function i(e,t){if(t.activeLegend){var i="#000000",r=t.activeLegend,a=(r.id,r.legendEntries.length);if(0==a)return i;var n=r.legendEntries[0],o=r.legendEntries[a-1];if("interpolated"==r.legendKind){if(e<n.value)return n.color;if(e>o.value)return o.color;for(var s=0;a-1>s;){if(n=r.legendEntries[s],o=r.legendEntries[s+1],e>=n.value&&e<=o.value){var l=chroma.interpolate.bezier([n.color,o.color]),c=l((e-n.value)/(o.value-n.value)).hex();return c}s++}return i}if("discrete"==r.legendKind){if(e<n.interval.min)return r.legendEntries[0].color;if(e>o.interval.max)return r.legendEntries[a-1].color;for(var s=0;a>s;){var p=r.legendEntries[s];if(e>=p.interval.min&&e<=p.interval.max)return p.color;s++}return i}return i}if(e>t.info.sdMax)return t.colors[t.colors.length-1];if(e<t.info.sdMin)return t.colors[0];var l=chroma.interpolate.bezier(t.colors),c=l((e-t.info.sdMin)/(t.info.sdMax-t.info.sdMin)).hex();return c}function r(e,t){return void 0===t&&(t="#f00"),e?4==e.length||7==e.length?e:9==e.length?"#"+e.substr(3,6):t:t}e.getColorFromStringValue=t,e.getColor=i,e.getColorString=r}(t=e.Helpers||(e.Helpers={}))}(csComp||(csComp={}));var csComp;!function(e){!function(e){e[e.Js=0]="Js",e[e.Css=1]="Css"}(e.FileType||(e.FileType={}));var t=(e.FileType,function(){function e(){}return e.loadJsCssfile=function(t,i,r){if(!(e.loadedFiles.indexOf(t)>0))switch(e.loadedFiles.push(t),i){case 0:var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",t),r&&(a.onload=function(e){r(e)}),document.getElementsByTagName("head")[0].appendChild(a);break;case 1:var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",t),r&&(n.onload=function(e){r(e)}),document.getElementsByTagName("head")[0].appendChild(n)}},e.loadedFiles=[],e}());e.Utils=t}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(e,t){this.topic=e,this.callback=t}return e}();e.MessageBusHandle=t;var i=function(){function e(){this._listeners=[]}return e.prototype.add=function(e){this._listeners.push(e)},e.prototype.remove=function(e){if("function"==typeof e){for(var t=0,i=this._listeners.length;i>t;i++)if(this._listeners[t]===e){this._listeners.splice(t,1);break}}else this._listeners=[]},e.prototype.trigger=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];for(var i={},r=this._listeners.slice(0),a=0,n=r.length;n>a;a++)r[a].apply(i,e||[])},e}();e.TypedEvent=i;var r=function(){function e(e,t){this.id=e,this.url=t,this.cache={},this.events=new i}return e.prototype.connect=function(e){var t=this;this.isConnected||this.isConnecting||(this.socket=io(),this.isConnecting=!0,this.socket.on("connect",function(){t.isConnecting=!1,t.isConnected=!0,t.events.trigger("connected"),e()}),this.socket.on("disconnect",function(){t.isConnecting=!1,t.isConnected=!1}),this.socket.on("reconnect_attempt",function(){t.isConnecting=!0,t.isConnected=!1}),this.socket.on("reconnect_failed",function(){t.isConnecting=!1}))},e.prototype.disconnect=function(){},e}();e.Connection=r,function(e){e[e.BottomRight=0]="BottomRight",e[e.BottomLeft=1]="BottomLeft",e[e.TopRight=2]="TopRight",e[e.TopLeft=3]="TopLeft"}(e.NotifyLocation||(e.NotifyLocation={}));var a=(e.NotifyLocation,function(){function e(e){this.$translate=e,this.connections={},PNotify.prototype.options.styling="fontawesome"}return e.prototype.getConnection=function(e){return this.connections.hasOwnProperty(e)?this.connections[e]:null},e.prototype.initConnection=function(e,t,i){null==e&&(e="");var a=this.getConnection(e);null==a&&(a=new r(e,t),this.connections[a.id]=a),this.connections[e].connect(function(){i()})},e.prototype.serverPublish=function(e,t,i){void 0===i&&(i="");var r=this.getConnection(i);return null==r?null:void r.socket.emit(e,t)},e.prototype.serverSubscribe=function(e,i,r){void 0===r&&(r="");var a=this.getConnection(r);return null==a?null:(a.cache[e]?a.cache[e].push(i):(a.cache[e]=new Array,a.cache[e].push(i),a.socket.on(e,function(t){a.cache[e].forEach(function(i){return i(e,t)})})),new t(e,i))},e.prototype.notifyWithTranslation=function(e,t,i){var r=this;void 0===i&&(i=0),this.$translate(e).then(function(e){r.$translate(t).then(function(t){r.notify(e,t,i)})})},e.prototype.notify=function(e,t,i){void 0===i&&(i=0);var r,a,n;switch(i){case 1:r="stack-bottomleft",a="up",n="right";break;case 2:r="stack-topright",a="down",n="left";break;case 3:r="stack-topleft",a="down",n="right";break;default:r="stack-bottomright",a="up",n="left"}{var o={title:e,text:t,icon:"fa fa-info",cornerclass:"ui-pnotify-sharp",addclass:r,stack:{dir1:a,dir2:n,firstpos1:25,firstpos2:25}};new PNotify(o)}},e.prototype.confirm=function(e,t,i){{var r={title:e,text:t,hide:!1,confirm:{confirm:!0},buttons:{closer:!1,sticker:!1},history:{history:!1},icon:"fa fa-question-circle",cornerclass:"ui-pnotify-sharp",addclass:"stack-topright",stack:{dir1:"down",dir2:"left",firstpos1:25,firstpos2:25}};new PNotify(r).get().on("pnotify.confirm",function(){i(!0)}).on("pnotify.cancel",function(){i(!1)})}},e.prototype.notifyBottom=function(e,t){{var i={dir1:"up",dir2:"right",spacing1:0,spacing2:0},r={title:"Over Here",text:"Check me out. I'm in a different stack.",addclass:"stack-bar-bottom",cornerclass:"",width:"70%",stack:i};new PNotify(r)}},e.prototype.notifyData=function(e){new PNotify(e)},e.prototype.publish=function(t,i,r){e.cache[t]&&e.cache[t].forEach(function(e){return e(i,r)})},e.prototype.subscribe=function(i,r){return e.cache[i]||(e.cache[i]=new Array),e.cache[i].push(r),new t(i,r)},e.prototype.unsubscribe=function(t){var i=t.topic,r=t.callback;e.cache[i]&&e.cache[i].forEach(function(t,a){return t==r?void e.cache[i].splice(a,1):void 0})},e.cache={},e.$inject=["$translate"],e}());e.MessageBusService=a;var n=function(){function e(){}return e.prototype.bind=function(e,t){this.myEvents=this.myEvents||{},this.myEvents[e]=this.myEvents[e]||[],this.myEvents[e].push(t)},e.prototype.unbind=function(e,t){this.myEvents=this.myEvents||{},e in this.myEvents!=!1&&this.myEvents[e].splice(this.myEvents[e].indexOf(t),1)},e.prototype.unbindEvent=function(e){this.myEvents=this.myEvents||{},this.myEvents[e]=[]},e.prototype.unbindAll=function(){this.myEvents=this.myEvents||{};for(var e in this.myEvents)this.myEvents[e]=!1},e.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(this.myEvents=this.myEvents||{},e in this.myEvents!=!1)for(var r=0;r<this.myEvents[e].length;r++)this.myEvents[e][r].apply(this,Array.prototype.slice.call(arguments,1))},e.prototype.registerEvent=function(e){this[e]=function(t,i){return"function"==typeof t&&(i&&this.unbindEvent(e),this.bind(e,t)),this;

}},e.prototype.registerEvents=function(e){var t=this;e.forEach(function(e){t.registerEvent(e)})},e}();e.EventObj=n}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(e,t){this.$messageBusService=e,this.$layerService=t}return e.$inject=["messageBusService","layerService"],e}();e.ConnectionService=t}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(t){var i=(function(){function e(e){this.context=e}return e.prototype.getInstance=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var r=Object.create(this.context.csComp.Services[e].prototype);return r.constructor.apply(r,t),r},e}(),function(){function t(t,i,r,a,n,o,s){this.$rootScope=t,this.$compile=i,this.$location=r,this.$translate=a,this.$messageBusService=n,this.$layerService=o,this.$mapService=s,this.mainDashboard=new e.Services.Dashboard,this.dashboards=[],this.dashboards.main=this.mainDashboard,this.widgetTypes={}}return t.prototype.init=function(){},t.prototype.selectDashboard=function(e,t){this.$layerService.project.activeDashboard=e,this.$messageBusService.publish("dashboard-"+t,"activated",e)},t.prototype.addNewWidget=function(t,i){var r=this;return t.id||(t.id=e.Helpers.getGuid()),t.elementId="widget-"+t.id,t.dashboard=i,i.widgets.push(t),"$apply"!=this.$rootScope.$root.$$phase&&"$digest"!=this.$rootScope.$root.$$phase&&this.$rootScope.$apply(),setTimeout(function(){r.updateWidget(t)},50),t},t.prototype.updateWidget=function(e){var t=JSON.stringify(e.data),i=this.$compile("<"+e.directive+" widget='"+t+"'></"+e.directive+">")(this.$rootScope),r=$("#"+e.elementId);r.empty(),r.append(i)},t.prototype.addWidget=function(e){return this.addNewWidget(e,this.mainDashboard)},t.prototype.editWidget=function(e){this.activeWidget=e,$('#leftPanelTab a[href="#widgetedit"]').tab("show")},t.prototype.removeWidget=function(){var e=this;this.activeWidget&&this.mainDashboard&&(this.mainDashboard.widgets=this.mainDashboard.widgets.filter(function(t){return t.id!=e.activeWidget.id}),this.activeWidget=null,$('#leftPanelTab a[href="#basewidgets"]').tab("show"))},t.$inject=["$rootScope","$compile","$location","$translate","messageBusService","layerService","mapService"],t}());t.DashboardService=i}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(t){"use strict";var i=function(){function e(){this.leftPanelVisible=!1,this.rightPanelVisible=!1,this.dashboardVisible=!0,this.mapVisible=!0,this.timelineVisible=!0}return e}();t.VisualState=i;var r=function(){function r(r,a,n,o,s,l){var c=this;this.$location=r,this.$translate=a,this.$messageBusService=n,this.$mapService=o,this.$rootScope=s,this.dashboardService=l,this.loadedLayers=new e.Helpers.Dictionary,this.layerGroup=new L.LayerGroup,this.info=new L.Control,this.visual=new i,this.mb=n,this.map=o,this.accentColor="",this.title="",this.featureTypes={},this.propertyTypeData={},this.noStyles=!0,this.currentLocale="en",this.mapRenderers={},this.visual=new i,this.mapRenderers.leaflet=new t.LeafletRenderer,this.mapRenderers.leaflet.init(this),this.mapRenderers.cesium=new t.CesiumRenderer,this.mapRenderers.cesium.init(this),this.selectRenderer("leaflet"),this.initLayerSources(),n.subscribe("timeline",function(e){switch(e){case"focusChange":c.updateSensorData()}}),n.subscribe("language",function(e,t){switch(e){case"newLanguage":c.currentLocale=t,n.notifyWithTranslation("LAYER_SERVICE.RELOAD_PROJECT_TITLE","LAYER_SERVICE.RELOAD_PROJECT_MSG"),c.openProject(c.projectUrl)}})}return r.prototype.initLayerSources=function(){this.layerSources={};var e=new t.GeoJsonSource(this);this.layerSources.geojson=e,this.layerSources.topojson=e,this.layerSources.dynamicgeojson=new t.DynamicGeoJsonSource(this),this.layerSources.wms=new t.WmsSource(this),this.layerSources.tilelayer=new t.TileLayerSource(this)},r.prototype.addLayer=function(e){var t=this,i=[];async.series([function(t){e.group.oneLayerActive&&e.group.layers.forEach(function(t){t!==e&&t.enabled&&i.push(t)}),t(null,null)},function(i){var r=e.type.toLowerCase();t.layerSources.hasOwnProperty(r)&&async.series([function(i){t.layerSources[r].addLayer(e,function(i){t.activeMapRenderer.addLayer(e)}),i(null,null)},function(i){t.updateSensorData(),t.$messageBusService.publish("layer","activated",e),t.updateFilters(),i(null,null)}]),i(null,null)},function(e){i.forEach(function(e){t.removeLayer(e),e.enabled=!1}),e(null,null)}])},r.prototype.removeStyle=function(e){var t=e.group;t.styles=t.styles.filter(function(t){return t.id!==e.id}),this.updateGroupFeatures(t)},r.prototype.updatePropertyStyle=function(e,t,i){var r;if(r=i.style.legends[e],r&&r.legendEntries.length>0){var a=r.legendEntries[0],n=r.legendEntries[r.legendEntries.length-1];i.style.colors=[a.color,n.color]}i.style.activeLegend=r},r.prototype.updateStyle=function(e){null!=e&&null!=e.group&&(e.info=this.calculatePropertyInfo(e.group,e.property),e.canSelectColor=e.visualAspect.toLowerCase().indexOf("color")>-1,this.updateGroupFeatures(e.group))},r.prototype.updateGroupFeatures=function(e){var t=this;this.project.features.forEach(function(i){i.layer.group==e&&(t.calculateFeatureStyle(i),t.activeMapRenderer.updateFeature(i))})},r.prototype.selectRenderer=function(e){this.activeMapRenderer&&this.activeMapRenderer.title==e||(this.activeMapRenderer&&this.activeMapRenderer.disable(),this.mapRenderers.hasOwnProperty(e)&&(this.activeMapRenderer=this.mapRenderers[e],this.activeMapRenderer.enable()))},r.prototype.selectFeature=function(e){e.isSelected=!e.isSelected,this.calculateFeatureStyle(e),this.activeMapRenderer.updateFeature(e),null!=this.lastSelectedFeature&&this.lastSelectedFeature!==e&&(this.lastSelectedFeature.isSelected=!1,this.calculateFeatureStyle(this.lastSelectedFeature),this.activeMapRenderer.updateFeature(this.lastSelectedFeature)),this.lastSelectedFeature=e,e.isSelected?(this.$messageBusService.publish("sidebar","show"),this.$messageBusService.publish("feature","onFeatureSelect",e)):(this.$messageBusService.publish("sidebar","hide"),this.$messageBusService.publish("feature","onFeatureDeselect"))},r.prototype.updateSensorData=function(){var e=this;if(null!=this.project&&null!=this.project.timeLine&&null!=this.project.features){var t=this.project.timeLine.focus,i={};this.project.features.forEach(function(r){var a=e.findLayer(r.layerId);if(null!=a&&(r.sensors||r.coordinates)){var n=function(e,t){for(var i=1;i<t.length;i++)if(t[i]>e)return i;return t.length-1},o=0;if(r.timestamps?o=n(t,r.timestamps):a.timestamps&&(i.hasOwnProperty(r.layerId)?o=i[r.layerId]:(o=n(t,a.timestamps),i[r.layerId]=o)),r.coordinates&&r.coordinates.length>o&&r.coordinates[o]!=r.geometry.coordinates&&(r.geometry.coordinates=r.coordinates[o],a.group.markers.hasOwnProperty(r.id))){var s=a.group.markers[r.id];s.setLatLng(new L.LatLng(r.geometry.coordinates[1],r.geometry.coordinates[0]))}if(r.sensors){for(var l in r.sensors){var c=r.sensors[l],p=c[o];r.properties[l]=p}e.activeMapRenderer.updateFeature(r),r.isSelected&&e.$messageBusService.publish("feature","onFeatureUpdated",r)}}})}},r.prototype.filterProperties=function(e){var t=[];return null!=e.filters&&e.filters.length>0&&e.filters.forEach(function(e){t.push(e.property)}),t},r.prototype.initFeature=function(t,i){return t.isInitialized||(t.isInitialized=!0,null==t.id&&(t.id=e.Helpers.getGuid()),t.layerId=i.id,t.layer=i,this.project.features.push(t),i.group.ndx.add([t]),t.fType=this.getFeatureType(t),this.initFeatureType(t.fType),t.properties.hasOwnProperty("Name")||e.Helpers.setFeatureName(t),this.calculateFeatureStyle(t)),t.type},r.prototype.removeFeature=function(e){this.project.features=this.project.features.filter(function(t){return t!=e}),e.layer.group.ndx.remove([e]),this.activeMapRenderer.removeFeature(e)},r.prototype.calculateFeatureStyle=function(t){var i={};i.strokeWidth=1,i.rotate=0,i.strokeColor="black",i.iconHeight=32,i.iconWidth=32;var r=this.getFeatureType(t);r.style&&(null!=r.style.fillColor&&(i.fillColor=e.Helpers.getColorString(r.style.fillColor)),null!=r.style.strokeColor&&(i.strokeColor=e.Helpers.getColorString(r.style.strokeColor,"#fff")),null!=r.style.strokeWidth&&(i.strokeWidth=r.style.strokeWidth),null!=r.style.iconWidth&&(i.iconWidth=r.style.iconWidth),null!=r.style.iconHeight&&(i.iconHeight=r.style.iconHeight),r.style.rotateProperty&&t.properties.hasOwnProperty(r.style.rotateProperty)&&(i.rotate=Number(t.properties[r.style.rotateProperty]))),t.layer.group.styles.forEach(function(r){if(r.enabled&&t.properties.hasOwnProperty(r.property)){var a=Number(t.properties[r.property]);if(isNaN(a)){var n=t.properties[r.property];switch(r.visualAspect){case"strokeColor":i.strokeColor=e.Helpers.getColorFromStringValue(n,r);break;case"fillColor":i.fillColor=e.Helpers.getColorFromStringValue(n,r)}}else switch(r.visualAspect){case"strokeColor":i.strokeColor=e.Helpers.getColor(a,r);break;case"fillColor":i.fillColor=e.Helpers.getColor(a,r);break;case"strokeWidth":i.strokeWidth=(a-r.info.sdMin)/(r.info.sdMax-r.info.sdMin)*10+1}}}),t.isSelected&&(i.strokeWidth=5,i.strokeColor="black"),t.effectiveStyle=i},r.prototype.initFeatureType=function(e){var t=this;if(null!=e.languages&&this.currentLocale in e.languages){var i=e.languages[this.currentLocale];i.name&&(e.name=i.name)}null!=e.propertyTypeData&&0!=e.propertyTypeData.length&&e.propertyTypeData.forEach(function(e){t.initPropertyType(e)})},r.prototype.initPropertyType=function(e){this.setDefaultPropertyType(e),null!=e.languages&&this.localizePropertyType(e)},r.prototype.setDefaultPropertyType=function(e){e.type||(e.type="text"),"undefined"==typeof e.canEdit&&(e.canEdit=!1),"undefined"==typeof e.visibleInCallOut&&(e.visibleInCallOut=!0),"undefined"==typeof e.isSearchable&&"text"===e.type&&(e.isSearchable=!0)},r.prototype.localizePropertyType=function(e){if(null!=e.languages&&this.currentLocale in e.languages){var t=e.languages[this.currentLocale];t.title&&(e.title=t.title),t.description&&(e.description=t.description),t.section&&(e.section=t.section),null!=t.options&&(e.options=t.options)}},r.prototype.findFilter=function(e,t){null==e.filters&&(e.filters=[]);var i=e.filters.filter(function(e){return e.property===t});return i.length>0?i[0]:null},r.prototype.findFeatureById=function(e,t){for(var i=0;i<this.project.features.length;i++){var r=this.project.features[i];if(t===r.index&&e===r.layerId)return r}},r.prototype.findFeatureByName=function(e){for(var t=0;t<this.project.features.length;t++){var i=this.project.features[t];if(i.hasOwnProperty("Name")&&e===i.properties.Name)return i}},r.prototype.findLayer=function(e){return this.loadedLayers.containsKey(e)?this.loadedLayers[e]:null},r.prototype.setStyle=function(i,r){var a=this;void 0===r&&(r=!0);var n=i.feature;if(null!=n){var o=this.getFeatureType(n);this.noStyles=!1;var s=n.layer,l=s.group,c=new t.GroupStyle(this.$translate);if(l.styles&&l.styles.length>0){var p=l.styles[0];p.title=i.key;var u,d;for(d in p.legends)if(u=p.legends[d],c.legends[d]=u,u.legendEntries&&u.legendEntries.length>0){var h=u.legendEntries[0],f=u.legendEntries[u.legendEntries.length-1];c.colorScales[d]=[h.color,f.color]}else c.colorScales[d]=["red","red"]}c.id=e.Helpers.getGuid(),c.title=i.key,c.meta=i.meta,c.visualAspect=o.style&&o.style.drawingMode&&"polyline"==o.style.drawingMode.toLowerCase()?"strokeColor":"fillColor",c.canSelectColor=c.visualAspect.toLowerCase().indexOf("color")>-1,c.property=i.property,null==c.info&&(c.info=this.calculatePropertyInfo(s.group,i.property)),c.enabled=!0,c.group=s.group,c.meta=i.meta,c.colors=o.style&&o.style.fillColor?["white","orange"]:["white","orange"],this.saveStyle(s.group,c);{l.styles.length}return this.project.features.forEach(function(e){e.layer.group==s.group&&(a.calculateFeatureStyle(e),a.activeMapRenderer.updateFeature(e))}),r&&$('#leftPanelTab a[href="#styles"]').tab("show"),c}return null},r.prototype.saveStyle=function(e,t){var i=e.styles.filter(function(e){return e.visualAspect===t.visualAspect});if(i.length>0){var r=e.styles.indexOf(i[0]);e.styles.splice(r,1)}e.styles.push(t)},r.prototype.addFilter=function(e,i){var r=this.findFilter(e,i);if(null==r){var a=new t.GroupFilter;a.property=i,a.title=i,a.rangex=[0,1],e.filters.push(a)}else{var n=e.filters.indexOf(r);-1!==n&&e.filters.slice(n,1)}this.updateFilters(),$('#leftPanelTab a[href="#filters"]').tab("show")},r.prototype.setFilter=function(e,t){t.filters.push(e),this.updateFilters(),$('#leftPanelTab a[href="#filters"]').tab("show")},r.prototype.setPropertyFilter=function(e){var i=e.property,r=e.feature;if(null!=r){var a=r.layer;if(null!=a){var n=this.findFilter(a.group,i);if(null==n){var o=new t.GroupFilter;if(o.property=i,o.meta=e.meta,o.filterType="bar",null!=o.meta)if(null!=o.meta.filterType)o.filterType=o.meta.filterType;else switch(o.meta.type){case"number":case"options":o.filterType="bar";break;default:o.filterType="text",o.stringValue=e.value,o.value=e.value}if(o.title=e.key,o.rangex=[0,1],"text"===o.filterType){var s=a.group.filters.filter(function(e){return"text"===e.filterType});s.forEach(function(e){e.dimension.filterAll(),e.dimension.dispose()}),a.group.filters=a.group.filters.filter(function(e){return"text"!==e.filterType})}a.group.filters.push(o)}else{var l=a.group.filters.indexOf(n);-1!==l&&a.group.filters.slice(l,1)}}this.updateFilters(),$('#leftPanelTab a[href="#filters"]').tab("show")}},r.prototype.getFeatureType=function(e){var t=e.properties.FeatureTypeId||"Default",i=e.layerId+"_"+t;return this.featureTypes.hasOwnProperty(i)||(this.featureTypes.hasOwnProperty(t)?i=t:this.featureTypes[i]=this.createDefaultType(e)),e.featureTypeName=i,this.featureTypes[i]},r.prototype.createDefaultType=function(t){var i={};i.style={nameLabel:"Name"},i.propertyTypeData=[];for(var r in t.properties)if(t.properties.hasOwnProperty(r)){var a=[];a.label=r,a.title=r.replace("_"," "),a.isSearchable=!0,a.visibleInCallOut=!0,a.canEdit=!1;var n=t.properties[r];a.type=e.StringExt.isNumber(n)?"number":e.StringExt.isBoolean(n)?"boolean":e.StringExt.isBbcode(n)?"bbcode":"text",i.propertyTypeData.push(a)}return i},r.prototype.resetFilters=function(){dc.filterAll(),dc.redrawAll()},r.prototype.getGroupFeatures=function(e){var t=[];e.layers.forEach(function(e){e.enabled&&t.push(e.id)});var i=this.project.features.filter(function(e){return t.indexOf(e.layerId)>-1});return i},r.prototype.rebuildFilters=function(e){e.ndx=crossfilter([]);var t=this.getGroupFeatures(e);e.ndx.add(t),this.updateFilters()},r.prototype.removeLayer=function(e){var t,i=e.group;this.loadedLayers.remove(e.id),null!=this.lastSelectedFeature&&this.lastSelectedFeature.layerId===e.id&&(this.lastSelectedFeature=null,this.$messageBusService.publish("sidebar","hide"),this.$messageBusService.publish("feature","onFeatureDeselect")),i.clustering?(t=i.cluster,this.project.features.forEach(function(i){if(i.layerId===e.id)try{t.removeLayer(e.group.markers[i.id]),delete e.group.markers[i.id]}catch(r){}})):this.map.map.removeLayer(e.mapLayer),this.project.features=this.project.features.filter(function(t){return t.layerId!==e.id});var r=e.id+"_",a=this.featureTypes;for(var n in a)a.hasOwnProperty(n)&&0===n.lastIndexOf(r,0)&&delete a[n];0===i.layers.filter(function(e){return e.enabled}).length&&(i.filters.forEach(function(e){null!=e.dimension&&e.dimension.dispose()}),i.filters=[],i.styles=[]),this.rebuildFilters(i),this.$messageBusService.publish("layer","deactivate",e)},r.prototype.openSolution=function(e,t,i){var r=this;this.loadedLayers.clear(),$.getJSON(e,function(e){if(e.maxBounds&&(r.maxBounds=e.maxBounds,r.$mapService.map.setMaxBounds(new L.LatLngBounds(e.maxBounds.southWest,e.maxBounds.northEast))),e.viewBounds&&r.$mapService.map.fitBounds(new L.LatLngBounds(e.viewBounds.southWest,e.viewBounds.northEast)),e.baselayers.forEach(function(e){var t={};t.subtitle=e.subtitle,t.preview=e.preview,null!=e.subdomains&&(t.subdomains=e.subdomains),null!=e.maxZoom&&(t.maxZoom=e.maxZoom),null!=e.minZoom&&(t.minZoom=e.minZoom),null!=e.attribution&&(t.attribution=e.attribution),null!=e.id&&(t.id=e.id);var i=L.tileLayer(e.url,t);r.$mapService.baseLayers[e.title]=i,e.isDefault&&r.$mapService.changeBaseLayer(i)}),e.projects.length>0){var a=e.projects.filter(function(e){return e.title===i})[0];null!=a?r.openProject(a.url,t):r.openProject(e.projects[0].url,t)}r.solution=e})},r.prototype.clearLayers=function(){var e=this;null!=this.project&&null!=this.project.groups&&this.project.groups.forEach(function(t){t.layers.forEach(function(t){t.enabled&&(e.removeLayer(t),t.enabled=!1)})})},r.prototype.openProject=function(i,r){var a=this;this.projectUrl=i;var n=[];r&&r.split(";").forEach(function(e){n.push(e.toLowerCase())}),this.clearLayers(),this.featureTypes={},$.getJSON(i,function(i){a.project=(new t.Project).deserialize(i),a.project.timeLine?a.$messageBusService.publish("timeline","updateTimerange",a.project.timeLine):a.project.timeLine=new t.DateRange,a.project.viewBounds&&a.$mapService.map.fitBounds(new L.LatLngBounds(a.project.viewBounds.southWest,a.project.viewBounds.northEast));var r=a.project.featureTypes;if(r)for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];a.initFeatureType(s),a.featureTypes[o]=s}if(a.project.propertyTypeData)for(var l in a.project.propertyTypeData){var c=a.project.propertyTypeData[l];a.initPropertyType(c),c.label||(c.label=l),a.propertyTypeData[l]=c}if(!a.project.dashboards){a.project.dashboards=[];var p=new t.Dashboard;p.id="map",p.widgets=[],a.project.dashboards.push(p)}a.project.dataSets||(a.project.dataSets=[]),a.project.features=[],a.project.groups.forEach(function(t){if(null==t.id&&(t.id=e.Helpers.getGuid()),t.ndx=crossfilter([]),t.styles&&t.styles.length>0){t.styles[0].id}if(null==t.styles&&(t.styles=[]),null==t.filters&&(t.filters=[]),t.markers={},null!=t.languages&&a.currentLocale in t.languages){var r=t.languages[a.currentLocale];r.title&&(t.title=r.title),r.description&&(t.description=r.description)}t.clustering?(t.cluster=new L.MarkerClusterGroup({maxClusterRadius:t.maxClusterRadius||80,disableClusteringAtZoom:t.clusterLevel||0}),a.map.map.addLayer(t.cluster)):(t.vectors=new L.LayerGroup,a.map.map.addLayer(t.vectors)),t.layers.forEach(function(i){if(null==i.id&&(i.id=e.Helpers.getGuid()),null==i.reference&&(i.reference=i.id),null==i.title&&(i.title=i.id),null!=i.languages&&a.currentLocale in i.languages){var r=i.languages[a.currentLocale];r.title&&(i.title=r.title),r.description&&(i.description=r.description)}i.group=t,(i.enabled||n.indexOf(i.reference.toLowerCase())>=0)&&(i.enabled=!0,a.activeMapRenderer.addLayer(i))}),t.styles.forEach(function(t){null!=t.id&&(t.id=e.Helpers.getGuid())}),t.filters.forEach(function(t){null!=t.id&&(t.id=e.Helpers.getGuid())}),i.startposition&&a.$mapService.zoomToLocation(new L.LatLng(i.startposition.latitude,i.startposition.longitude)),a.updateFilters()}),a.project.connected&&a.$messageBusService.initConnection("","",function(){}),a.$messageBusService.publish("project","loaded",a.project),a.$messageBusService.publish("dashboard-main","activated",a.project.dashboards[Object.keys(a.project.dashboards)[0]])})},r.prototype.closeProject=function(){var e=this;null!=this.project&&this.project.groups.forEach(function(t){t.layers.forEach(function(t){t.enabled&&e.removeLayer(t)})})},r.prototype.calculatePropertyInfo=function(e,i){var r=this,a=new t.PropertyInfo;a.count=0;var n=0,o=0;if(e.layers.forEach(function(e){e.enabled&&r.project.features.forEach(function(t){if(t.layerId===e.id&&t.properties.hasOwnProperty(i)){var r=t.properties[i],s=Number(r);isNaN(s)||(a.count+=1,n+=s,o+=s*s,(null==a.max||s>a.max)&&(a.max=s),(null==a.min||s<a.min)&&(a.min=s))}})}),isNaN(n)||0==a.count?(a.sdMax=a.max,a.sdMin=a.min):(a.mean=n/a.count,a.varience=o/a.count-a.mean*a.mean,a.sd=Math.sqrt(a.varience),a.sdMax=a.mean+3*a.sd,a.sdMin=a.mean-3*a.sd,a.min>a.sdMin&&(a.sdMin=a.min),a.max<a.sdMax&&(a.sdMax=a.max),a.sdMin===0/0&&(a.sdMin=a.min),a.sdMax===0/0&&(a.sdMax=a.max)),this.propertyTypeData.hasOwnProperty(i)){var s=this.propertyTypeData[i];null!=s.maxValue&&(a.sdMax=s.maxValue),null!=s.minValue&&(a.sdMin=s.minValue)}return a},r.prototype.updateFilters=function(){var e=this,t=$("#filterChart");t.empty(),this.noFilters=!0,this.project.groups.forEach(function(t){null!=t.filters&&t.filters.length>0&&($("<div style='float:left;margin-left: -10px; margin-top: 5px' data-toggle='collapse' data-target='#filters_"+t.id+"'><i class='fa fa-chevron-down togglebutton toggle-arrow-down'></i><i class='fa fa-chevron-up togglebutton toggle-arrow-up'></i></div><div class='group-title' >"+t.title+"</div><div id='filtergroupcount_"+t.id+"'  class='filter-group-count' /><div class='collapse in' id='filters_"+t.id+"'></div>").appendTo("#filterChart"),t.filters.forEach(function(i){switch(null!=i.dimension&&i.dimension.dispose(),e.noFilters=!1,i.filterType){case"text":e.addTextFilter(t,i);break;case"bar":e.addBarFilter(t,i);break;case"scatter":e.addScatterFilter(t,i)}})),e.updateFilterGroupCount(t)}),dc.renderAll()},r.prototype.updateTextFilter=function(e,t,i){null==i||""===i?t.filterAll():t.filterFunction(function(e){return null!=e?e.toLowerCase().indexOf(i.toLowerCase())>-1:!1}),e.filterResult=t.top(1/0),this.updateMapFilter(e),dc.renderAll()},r.prototype.updateFilterGroupCount=function(e){null!=e.filterResult&&$("#filtergroupcount_"+e.id).text(e.filterResult.length+" objecten geselecteerd")},r.prototype.addTextFilter=function(t,i){var r=this;i.id=e.Helpers.getGuid();var a=t.ndx.dimension(function(e){return e.properties.hasOwnProperty(i.property)?e.properties[i.property]:null});i.dimension=a,a.filterFunction(function(e){return null!=e?e.toLowerCase().indexOf(i.stringValue.toLowerCase())>-1:!1}),this.updateTextFilter(t,a,i.stringValue);var n="filtertext"+i.id;$("<h4>"+i.title+"</h4><input type='text' value='"+i.stringValue+"' class='filter-text' id='"+n+"'/><a class='btn' value="+i.value+" id='remove"+i.id+"'><i class='fa fa-times'></i></a>").appendTo("#filters_"+t.id),$("#"+n).keyup(function(){i.stringValue=$("#"+n).val(),r.updateTextFilter(t,a,i.stringValue),r.updateFilterGroupCount(t)}),$("#remove"+i.id).on("click",function(){var e=t.filters.indexOf(i);i.dimension.filterAll(),i.dimension.dispose(),i.dimension=null,-1!==e&&(t.filters=t.filters.slice(e-1,e)),dc.filterAll(),r.updateFilters(),r.resetMapFilter(t)})},r.prototype.updateChartRange=function(e,t){var i=$("#fsfrom_"+t.id),r=$("#fsto_"+t.id),a=e.brush().extent();null!=a&&2===a.length?a[0]!==a[1]&&(console.log(a),i.val(a[0]),r.val(a[1])):(i.val("0"),r.val("1"))},r.prototype.addScatterFilter=function(t,i){var r=this;i.id=e.Helpers.getGuid();var a=this.calculatePropertyInfo(t,i.property),n=(this.calculatePropertyInfo(t,i.property2),"filter_"+i.id);$("<h4>"+i.title+"</h4><div id='"+n+"'></div><div style='display:none' id='fdrange_"+i.id+"'>from <span id='fsfrom_"+i.id+"'/> to <span id='fsto_"+i.id+"'/></div><a class='btn' id='remove"+i.id+"'>remove</a>").appendTo("#filterChart"),$("#remove"+i.id).on("click",function(){var e=t.filters.indexOf(i);-1!==e&&t.filters.splice(e,1),i.dimension.dispose(),r.updateFilters(),r.resetMapFilter(t)});var o=dc.scatterPlot("#"+n),s=t.ndx.dimension(function(e){if(e.properties.hasOwnProperty(i.property)){if(null!=e.properties[i.property]){var t=parseInt(e.properties[i.property]),r=parseInt(e.properties[i.property2]);if(t>=a.sdMin&&t<=a.sdMax)return[t,r]}return[0,0]}return null});i.dimension=s;var l=s.group();o.width(275).height(190).dimension(s).group(l).x(d3.scale.linear().domain([a.sdMin,a.sdMax])).yAxisLabel(i.property2).xAxisLabel(i.property).on("filtered",function(e){e.hasFilter();dc.events.trigger(function(){t.filterResult=s.top(1/0),r.updateFilterGroupCount(t)},0),dc.events.trigger(function(){r.updateMapFilter(t)},100)}),o.xUnits(function(){return 13}),o.yAxis().ticks(15),o.xAxis().ticks(15)},r.prototype.addBarFilter=function(t,i){var r=this;i.id=e.Helpers.getGuid();var a=this.calculatePropertyInfo(t,i.property),n="filter_"+i.id;$("<div style='position:relative'><h4>"+i.title+"</h4><span class='dropdown' dropdown><a href class='fa fa-circle-o makeNarrow dropdown-toggle' dropdown-toggle > </a><ul class='dropdown-menu' ><li><a>scatter plot</a></li><li><a>add to dashboard< /a></li ></ul></span><a class='btn fa fa-cog' style='position:absolute;top:-5px;right:0' id='remove"+i.id+"'></a><div id='"+n+"' style='float:none'></div><div style='display:none' id='fdrange_"+i.id+"'>from <span id='fsfrom_"+i.id+"'/> to <span id='fsto_"+i.id+"'/></div></div>").appendTo("#filterChart");var o=$("#fsfrom_"+i.id),s=$("#fsto_"+i.id),l=$("#fdrange_"+i.id);$("#remove"+i.id).on("click",function(){var e=t.filters.indexOf(i);-1!==e&&t.filters.splice(e,1),i.dimension.dispose(),r.updateFilters(),r.resetMapFilter(t)});var c=dc.barChart("#"+n),p=20,u=(a.sdMax-a.sdMin)/p,d=t.ndx.dimension(function(e){if(e.properties.hasOwnProperty(i.property)){if(null!=e.properties[i.property]){var t=parseInt(e.properties[i.property]);return t>=a.sdMin&&t<=a.sdMax?Math.floor(t/u)*u:null}return null}return null});i.dimension=d;var h=d.group();c.width(275).height(90).dimension(d).group(h).transitionDuration(100).centerBar(!0).gap(5).elasticY(!0).x(d3.scale.linear().domain([a.sdMin,a.sdMax]).range([-1,p+1])).filterPrinter(function(e){var t="";if(e.length>0){var i=e[0];o.text(i[0].toFixed(2)),s.text(i[1].toFixed(2)),t+=i[0]}return t}).on("filtered",function(e){var i=e.hasFilter();i?l.show():l.hide(),dc.events.trigger(function(){t.filterResult=d.top(1/0),r.updateFilterGroupCount(t)},0),dc.events.trigger(function(){r.updateMapFilter(t)},100)}),c.xUnits(function(){return 13}),o.on("change",function(){if($.isNumeric(o.val())){var e=parseInt(o.val()),t=c.filters();t.length>0&&(t[0][0]=e,c.filter(t[0]),c.render(),dc.redrawAll())}}),s.on("change",function(){if($.isNumeric(s.val())){var e=parseInt(s.val()),t=c.filters();t.length>0&&(t[0][1]=e,c.filter(t[0]),d.filter(t[0]),dc.renderAll())}}),c.yAxis().ticks(5),c.xAxis().ticks(5),this.updateChartRange(c,i)},r.prototype.updateMapFilter=function(e){$.each(e.markers,function(t,i){var r=e.filterResult.filter(function(e){return e.id===t}).length>0;if(e.clustering){var a=e.cluster.hasLayer(i);!r&&a&&e.cluster.removeLayer(i),r&&!a&&e.cluster.addLayer(i)}else{var n=e.vectors.hasLayer(i);!r&&n&&e.vectors.removeLayer(i),r&&!n&&e.vectors.addLayer(i)}})},r.prototype.resetMapFilter=function(e){$.each(e.markers,function(t,i){if(e.clustering){var r=e.cluster.hasLayer(i);r||e.cluster.addLayer(i)}else{var a=e.vectors.hasLayer(i);a||e.vectors.addLayer(i)}})},r.$inject=["$location","$translate","messageBusService","mapService","$rootScope"],r}();t.LayerService=r}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(t){"use strict";var i=function(){function t(e){this.service=e,this.title="geojson"}return t.prototype.addLayer=function(e,t){this.baseAddLayer(e,t)},t.prototype.baseAddLayer=function(t,i){var r=this;this.layer=t,async.series([function(i){t.layerRenderer="svg",t.isLoading=!0,d3.json(t.url,function(a,n){if(t.isLoading=!1,a)r.service.$messageBusService.notify("ERROR loading"+t.title,a);else{if("topojson"===t.type.toLowerCase()&&(n=e.Helpers.convertTopoToGeoJson(n)),n.events&&r.service.timeline){t.events=n.events;var o=[];t.events.forEach(function(t){t.id||(t.id=e.Helpers.getGuid()),o.push({start:new Date(t.start),content:t.title})}),r.service.timeline.draw(o)}if(n.featureTypes)for(var s in n.featureTypes)if(n.featureTypes.hasOwnProperty(s)){var l=n.featureTypes[s];s=t.id+"_"+s,r.service.featureTypes[s]=l}n.timestamps&&(t.timestamps=n.timestamps),t.data=n,t.data.features.forEach(function(e){r.service.initFeature(e,t)})}i(null,null)})},function(){i(t)}])},t.prototype.removeLayer=function(e){},t}();t.GeoJsonSource=i;var r=function(e){function t(t){e.call(this,t),this.service=t,this.title="dynamicgeojson"}return __extends(t,e),t.prototype.updateFeatureByProperty=function(e,t,i){var r=this;try{var a=this.layer.data.features;if(null==a)return;var n=!1;if(a.some(function(a){return null!=a.properties&&a.properties.hasOwnProperty(e)&&a.properties[e]===t?(a.properties=i.properties,a.geometry=i.geometry,r.service.calculateFeatureStyle(a),r.service.activeMapRenderer.updateFeature(a),n=!0,!0):!1}),!n){a.push(i),this.service.initFeature(i,this.layer);{this.service.activeMapRenderer.addFeature(i)}}}catch(o){console.log("error")}},t.prototype.deleteFeatureByProperty=function(e,t,i){var r=this;try{var a=this.layer.data.features;if(null==a)return;var n=!1;if(a.some(function(a){return null!=a.properties&&a.properties.hasOwnProperty(e)&&a.properties[e]===t?(a.properties=i.properties,a.geometry=i.geometry,r.service.calculateFeatureStyle(a),r.service.activeMapRenderer.updateFeature(a),n=!0,!0):!1}),!n){a.push(i),this.service.initFeature(i,this.layer);{this.service.activeMapRenderer.createFeature(i)}}}catch(o){console.log("error")}},t.prototype.initSubscriptions=function(e){this.service.$messageBusService.serverPublish("joinlayer",{id:e.id})},t.prototype.addLayer=function(e,t){var i=this;this.baseAddLayer(e,t),this.initSubscriptions(e),this.service.$messageBusService.serverSubscribe("layer-"+e.id,function(e,t){switch(t.action){case"update":t.data.forEach(function(e){i.updateFeatureByProperty("id",e.properties.id,e)});break;case"delete":t.data.forEach(function(e){})}}),this.connection=this.service.$messageBusService.getConnection(""),this.connection.events.add(function(e){return i.connectionEvent})},t.prototype.connectionEvent=function(e){switch(console.log("connected event"),e){case"connected":console.log("connected"),this.initSubscriptions(this.layer)}},t.prototype.removeLayer=function(e){var t=this;console.log("removing connection event"),this.connection.events.remove(function(e){return t.connectionEvent})},t}(i);t.DynamicGeoJsonSource=r}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.service=e,this.title="tilelayer"}return e.prototype.addLayer=function(e,t){e.layerRenderer="tilelayer"},e.prototype.removeLayer=function(e){},e}();e.TileLayerSource=t}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.service=e,this.title="wms"}return e.prototype.addLayer=function(e,t){L.tileLayer.wms(e.url,{layers:e.wmsLayers,opacity:e.opacity/100,format:"image/png",transparent:!0,attribution:e.description});e.layerRenderer="wms",t(e)},e.prototype.removeLayer=function(e){},e}();e.WmsSource=t}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(e,t,i){this.$scope=e,this.$location=t,this.$mapService=i,e.vm=this,this.$mapService.baseLayers={};var r=e.map=i.getMap();r.invalidateSize(),L.control.zoom({position:"bottomleft"}).addTo(r),L.control.locate({position:"bottomleft",drawCircle:!0,follow:!0,setView:!0,keepCurrentZoomLevel:!0,markerStyle:{weight:1,opacity:.8,fillOpacity:.8},circleStyle:{weight:1,clickable:!1},icon:"icon-direction",metric:!0,strings:{title:"My location",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:18,watch:!0,enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}}).addTo(r)}return e.$inject=["$scope","$location","mapService"],e}();e.MapCtrl=t}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(t){"use strict";var i=function(){function t(e,t,i){var r=this;this.$localStorageService=e,this.$timeout=t,this.$messageBusService=i,this.mapVisible=!0,this.timelineVisible=!0,this.rightMenuVisible=!0,this.initExpertMode(),this.baseLayers={},this.initMap(),i.subscribe("timeline",function(e,t){switch(e){case"isEnabled":r.timelineVisible=t}}),i.subscribe("leftmenu",function(e,t){switch(e.toLowerCase()){case"toggle":$("body").hasClass("leftpanel-collapsed")?$("body").removeClass("leftpanel-collapsed"):$("body").addClass("leftpanel-collapsed");

break;case"hide":$("body").hasClass("leftpanel-collapsed")||$("body").addClass("leftpanel-collapsed");break;case"show":$("body").hasClass("leftpanel-collapsed")&&$("body").removeClass("leftpanel-collapsed")}})}return t.prototype.initExpertMode=function(){var i=this;this.expertMode=this.$localStorageService.get(t.expertModeKey),this.expertMode||(this.expertMode=3,this.$messageBusService.subscribe("project",function(e,t){switch(e){case"loaded":null!=t&&"undefined"!=typeof t.expertMode&&i.$messageBusService.publish("expertMode","newExpertise",t.expertMode)}})),this.$messageBusService.subscribe("expertMode",function(t,r){if("newExpertise"===t)switch(i.expertMode=r,i.$localStorageService.set(e.Services.MapService.expertModeKey,r),r){case 2:case 3:i.timelineVisible=!0,i.$timeout(function(){i.$messageBusService.publish("timeline","loadProjectTimeRange")},100);break;default:i.timelineVisible=!1}})},Object.defineProperty(t.prototype,"isExpert",{get:function(){return 3===this.expertMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isIntermediate",{get:function(){return 3===this.expertMode||2===this.expertMode},enumerable:!0,configurable:!0}),t.prototype.initMap=function(){},t.prototype.changeBaseLayer=function(e){this.map.addLayer(e),this.activeBaseLayer&&this.map.removeLayer(this.activeBaseLayer),this.map.setZoom(this.map.getZoom()),this.map.fire("baselayerchange",{layer:e}),this.activeBaseLayer=e},t.prototype.invalidate=function(){this.map.invalidateSize()},t.prototype.zoomToLocation=function(e,t){this.map.setView(e,t||14)},t.prototype.zoomTo=function(e,t){var i=this;void 0===t&&(t=14);var r;if("POINT"==e.geometry.type.toUpperCase())r=new L.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]),this.map.setView(r,t);else{var a;e.geometry.type.toUpperCase().indexOf("MULTI")<0?a=this.getBoundingBox(e.geometry.coordinates[0]):(a=[1e3,-1e3,1e3,-1e3],e.geometry.coordinates.forEach(function(e){var t=i.getBoundingBox(e[0]);a=[Math.min(a[0],t[0]),Math.max(a[1],t[1]),Math.min(a[2],t[2]),Math.max(a[3],t[3])]}));var n=.05,o=L.latLng(Math.min(a[2],a[3]),Math.min(a[0],a[1])-n),s=L.latLng(Math.max(a[2],a[3]),Math.max(a[0],a[1])+n);this.map.fitBounds(new L.LatLngBounds(o,s))}this.$messageBusService.publish("sidebar","show"),this.$messageBusService.publish("feature","onFeatureSelect",e)},t.prototype.getBoundingBox=function(e){return e.reduce(function(e,t){return[Math.min(e[0],t[0]),Math.max(e[1],t[0]),Math.min(e[2],t[1]),Math.max(e[3],t[1])]},[1e3,-1e3,1e3,-1e3])},t.prototype.getMap=function(){return this.map},t.$inject=["localStorageService","$timeout","messageBusService"],t.expertModeKey="expertMode",t}();t.MapService=i}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(){this.title="cesium"}return e.prototype.init=function(e){this.service=e},e.prototype.enable=function(){this.viewer=new Cesium.Viewer("map"),this.camera=this.viewer.camera,this.camera.setView({position:Cesium.Cartesian3.fromDegrees(5,52,1e6)}),$(".cesium-viewer-toolbar").hide()},e.prototype.disable=function(){this.viewer.destroy()},e.prototype.addLayer=function(e){if("GeoJson"==e.type){var t=e.data;null==t.type&&(t.type="FeatureCollection");var i=Cesium.GeoJsonDataSource.load(t);Cesium.when(i,function(t){e.cesiumDatasource=t}),this.viewer.dataSources.add(i)}"wms"==e.type},e.prototype.removeLayer=function(e){"GeoJson"==e.type&&this.viewer.dataSources.remove(e.cesiumDatasource),"wms"==e.type},e.prototype.updateMapFilter=function(e){},e.prototype.addGroup=function(e){},e.prototype.removeGroup=function(e){},e.prototype.createFeature=function(e){},e.prototype.removeFeature=function(e){},e.prototype.updateFeature=function(e){},e.prototype.addFeature=function(e){},e}();e.CesiumRenderer=t}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(t){var i=function(){function t(){this.title="leaflet"}return t.prototype.init=function(e){this.service=e,this.$messageBusService=e.$messageBusService},t.prototype.enable=function(){this.service.$mapService.map=L.map("map",{zoomControl:!1,attributionControl:!0})},t.prototype.disable=function(){this.service.$mapService.map.remove(),this.service.$mapService.map=null,$("#map").empty()},t.prototype.addGroup=function(e){e.clustering?(e.cluster=new L.MarkerClusterGroup({maxClusterRadius:e.maxClusterRadius||80,disableClusteringAtZoom:e.clusterLevel||0}),this.service.map.map.addLayer(e.cluster)):(e.vectors=new L.LayerGroup,this.service.map.map.addLayer(e.vectors))},t.prototype.removeLayer=function(e){switch(e.layerRenderer){case"svg":var t=e.group;if(t.clustering){var i=t.cluster;this.service.project.features.forEach(function(t){if(t.layerId===e.id)try{i.removeLayer(e.group.markers[t.id]),delete e.group.markers[t.id]}catch(r){}})}else this.service.map.map.removeLayer(e.mapLayer);break;case"wms":}},t.prototype.getLeafletStyle=function(e){var t={fillColor:e.fillColor,weight:e.strokeWidth,opacity:e.opacity,color:e.strokeColor,fillOpacity:e.opacity};return t},t.prototype.addLayer=function(e){var t=this;switch(e.layerRenderer){case"tile":var i=L.tileLayer(e.url,{attribution:e.description});e.mapLayer=new L.LayerGroup,this.service.map.map.addLayer(e.mapLayer),e.mapLayer.addLayer(i),i.on("loading",function(i){e.isLoading=!0,t.service.$rootScope.$apply(),"$apply"!=t.service.$rootScope.$$phase&&"$digest"!=t.service.$rootScope.$$phase&&t.service.$rootScope.$apply()}),i.on("load",function(i){e.isLoading=!1,"$apply"!=t.service.$rootScope.$$phase&&"$digest"!=t.service.$rootScope.$$phase&&t.service.$rootScope.$apply()}),e.isLoading=!0;break;case"wms":var r=L.tileLayer.wms(e.url,{layers:e.wmsLayers,opacity:e.opacity/100,format:"image/png",transparent:!0,attribution:e.description});e.mapLayer=new L.LayerGroup,this.service.map.map.addLayer(e.mapLayer),e.mapLayer.addLayer(r),r.on("loading",function(i){e.isLoading=!0,t.service.$rootScope.$apply(),"$apply"!=t.service.$rootScope.$$phase&&"$digest"!=t.service.$rootScope.$$phase&&t.service.$rootScope.$apply()}),r.on("load",function(i){e.isLoading=!1,"$apply"!=t.service.$rootScope.$$phase&&"$digest"!=t.service.$rootScope.$$phase&&t.service.$rootScope.$apply()}),e.isLoading=!0;break;case"svg":e.mapLayer=new L.LayerGroup,this.service.map.map.addLayer(e.mapLayer),e.data.features.forEach(function(i){e.group.markers[i.id]=t.addFeature(i)})}},t.prototype.updateMapFilter=function(e){$.each(e.markers,function(t,i){var r=e.filterResult.filter(function(e){return e.id===t}).length>0;if(e.clustering){var a=e.cluster.hasLayer(i);!r&&a&&e.cluster.removeLayer(i),r&&!a&&e.cluster.addLayer(i)}else{var n=e.vectors.hasLayer(i);!r&&n&&e.vectors.removeLayer(i),r&&!n&&e.vectors.addLayer(i)}})},t.prototype.removeGroup=function(e){},t.prototype.removeFeature=function(e){var t=e.layer.group.markers[e.id];null!=t&&(e.layer.mapLayer.removeLayer(t),delete e.layer.group.markers[e.id])},t.prototype.updateFeature=function(e){if(null!=e.layer.group){var t=e.layer.group.markers[e.id];null!=t&&("Point"===e.geometry.type?(t.setIcon(this.getPointIcon(e)),t.setLatLng(new L.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]))):t.setStyle(this.getLeafletStyle(e.effectiveStyle)))}},t.prototype.addFeature=function(e){var t=this,i=this.createFeature(e),r=e.layer;return r.group.markers[e.id]=i,i.on({mouseover:function(e){return t.showFeatureTooltip(e,r.group)},mouseout:function(e){return t.hideFeatureTooltip(e)},mousemove:function(e){return t.updateFeatureTooltip(e)},click:function(){return t.service.selectFeature(e)}}),i.feature=e,r.group.clustering?r.group.cluster.addLayer(i):r.mapLayer.addLayer(i),i},t.prototype.createFeature=function(e){var t;switch(e.geometry.type){case"Point":var i=this.getPointIcon(e);t=new L.Marker(new L.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]),{icon:i});break;default:t=L.GeoJSON.geometryToLayer(e),t.setStyle(this.getLeafletStyle(e.effectiveStyle))}return t.feature=e,e.layer.group.markers[e.id]=t,t},t.prototype.getPointIcon=function(t){var i;if(null!=t.htmlStyle)i=new L.DivIcon({className:"",iconSize:new L.Point(t.effectiveStyle.iconWidth,t.effectiveStyle.iconHeight),html:t.htmlStyle});else{var r="<div ",a={},n=this.service.getFeatureType(t),o=n.style.iconUri;a.background=t.effectiveStyle.fillColor,a.width=t.effectiveStyle.iconWidth+"px",a.height=t.effectiveStyle.iconHeight+"px",a["border-radius"]="20%",a["border-style"]="solid",a["border-color"]=t.effectiveStyle.strokeColor,a["border-width"]=t.effectiveStyle.strokeWidth,t.isSelected&&(a["border-width"]="3px"),r+=" style='display: inline-block;vertical-align: middle;text-align: center;";for(var s in a)a.hasOwnProperty(s)&&(r+=s+":"+a[s]+";");r+="'>",null!=o&&(null!=o&&o.indexOf("{")>=0&&(o=e.Helpers.convertStringFormat(t,o)),r+="<img src="+o+" style='width:"+(t.effectiveStyle.iconWidth-2)+"px;height:"+(t.effectiveStyle.iconHeight-2)+"px",t.effectiveStyle.rotate&&t.effectiveStyle.rotate>0&&(r+=";transform:rotate("+t.effectiveStyle.rotate+"deg)"),r+="' />"),r+="</div>",i=new L.DivIcon({className:"",iconSize:new L.Point(t.effectiveStyle.iconWidth,t.effectiveStyle.iconHeight),html:r})}return i},t.prototype.showFeatureTooltip=function(t,i){var r=t.target,a=r.feature,n=r.feature.properties.Name,o=n?n.length:1,s="<td colspan='3'>"+n+"</td></tr>";null!=i.filters&&i.filters.length>0&&i.filters.forEach(function(t){if(a.properties.hasOwnProperty(t.property)){var i=a.properties[t.property];if(i){var r=i.toString().length;null!=t.meta&&(i=e.Helpers.convertPropertyInfo(t.meta,i),"bbcode"!==t.meta.type&&(r=i.toString().length)),o=Math.max(o,r+t.title.length),s+="<tr><td><div class='smallFilterIcon'></td><td>"+t.title+"</td><td>"+i+"</td></tr>"}}}),null!=i.styles&&i.styles.length>0&&i.styles.forEach(function(t){if(null!=i.filters&&0===i.filters.filter(function(e){return e.property===t.property}).length&&a.properties.hasOwnProperty(t.property)){var r=a.properties[t.property],n=r.toString().length;null!=t.meta&&(r=e.Helpers.convertPropertyInfo(t.meta,r),"bbcode"!==t.meta.type&&(n=r.toString().length)),o=Math.max(o,n+t.title.length),s+="<tr><td><div class='smallStyleIcon'></td><td>"+t.title+"</td><td>"+r+"</td></tr>"}});var l=Math.max(Math.min(7*o+15,250),130);s="<table style='width:"+l+"px;'>"+s+"</table>",this.popup=L.popup({offset:new L.Point(-l/2-40,-5),closeOnClick:!0,autoPan:!1,className:"featureTooltip"}).setLatLng(t.latlng).setContent(s).openOn(this.service.map.map)},t.prototype.hideFeatureTooltip=function(e){this.popup&&this.service.map.map&&(this.service.map.map.closePopup(this.popup),this.popup=null)},t.prototype.updateFeatureTooltip=function(e){null!=this.popup&&null!=e.latlng&&this.popup.setLatLng(e.latlng)},t}();t.LeafletRenderer=i}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$mapService=t,e.vm=this,e.location=new L.LatLng(0,0)}return e.prototype.doSearch=function(){if(0===this.$scope.location.lat&&0===this.$scope.location.lng)alert("Directive did not update the location property in parent controller.");else{var e=new L.LatLng(this.$scope.location.lat,this.$scope.location.lng);this.$mapService.zoomToLocation(e)}},e.$inject=["$scope","mapService"],e}();e.SearchFormCtrl=t}(t=e.Search||(e.Search={}))}(csComp||(csComp={}));var csComp;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.$messageBusService=e,this.baseLayers={}}return e.$inject=["messageBusService"],e}();e.TimeService=t}(t=e.Services||(e.Services={}))}(csComp||(csComp={}));var Translations;!function(e){var t=function(){function e(){}return e.locale={CANCEL_BTN:"Cancel",OK_BTN:"OK",MAP:"Maps",MAP_LABEL:"Map",TABLE_LABEL:"Table",LAYERS:"Layers",FILTERS:"Filters",FILTER_INFO:'At the moment, no filters have been selected. In order to add a filter, click on an icon or area on the map, and click on the filter icon (<span class="fa fa-filter"></span>) in the right menu. This will create a filter for the selected property.',STYLES:"Styles",STYLE_INFO:'At the moment, no style has been selected. In order to add a style, click on an icon or area on the map, and click on the style icon (<span class="fa fa-eye"></span>) in the right menu. This will create a filter for the selected property.',FEATURES:"Features",LEGEND:"Legend",SEARCH:"Search",MAP_FEATURES:"Map features",SPEEDS_TAOUFIK:"speed colors Taoufik",SPEEDS_GOOGLEMAPS:"speed colors Google Maps",VERWARMINGSSYSTEEM:"Heating system",PERCENTAGES_V1:"percentages v1",ORANGE_RED:"orange - red",WHITE_RED:"white - red",RED_WHITE:"red - white",GREEN_RED:"green - red",RED_GREEN:"red - green",BLUE_RED:"blue - red",RED_BLUE:"red - blue",WHITE_BLUE:"white - blue",BLUE_WHITE:"blue - white",WHITE_GREEN:"white - green",GREEN_WHITE:"green - white",WHITE_ORANGE:"white - orange",ORANGE_WHITE:"orange - white",EXPERTMODE:{BEGINNER:"Beginner",INTERMEDIATE:"Intermediate",EXPERT:"Expert",EXPLANATION:"Select your expertise in order to unlock more functionality."},LAYER_SERVICE:{RELOAD_PROJECT_TITLE:"Data is reloaded",RELOAD_PROJECT_MSG:"After switching the language, we need to reload all the map data. Our appologies for the inconvenience."},MCA:{DESCRIPTION:'<h4>Multi-Criteria Analysis</h4><p  style="text-align: left; margin-left:5px;">MCA, is a method that combines multiple properties of a feature on the map into a new property. It achieves this by:<ol><li>Scaling each property to a range between 0 (no value) and 1 (maximum value).</li><li>Weighing each property relative to the others, where a weight less than 0 indicates you wish to avoid it, 0 is ignored, and a value greater than 0 is prefered.</li></ol> In fact, it is a kind of linear regression.',INFO:"At the moment, no map layers are loaded that contain a multi-criteria analysis. Open another map layer to see it.",INFO_EXPERT:"At the moment, no map layers are loaded that contain a multi-criteria analysis. Open another map layer to use it, or create a new MCA using the wizard.",SHOW_FEATURE_MSG:"Select a feature on the map to see the effects of the Multi-Criteria Analysis (MCA).",TOTAL_RESULT:"Combined result",DELETE_MSG:'Delete "{0}"',DELETE_MSG2:"Are you sure?",HAS_CATEGORY:"  Has category? ",HAS_RANK:"  Include rank? ",EDITOR_TITLE:"MCA Editor",MAIN_FEATURE:"Select the main feature",PROPERTIES:"Select the properties",INCLUDE_RANK:"  Show rank? ",RANK_TITLE:"[Rank title...]",TITLE:"Title... *",CATEGORY_MSG:"[Category...]",TOGGLE_SPARKLINE:"Show or hide bar charts and scoring function.",SCALE_MIN_TITLE:"[Min. scale]",SCALE_MAX_TITLE:"[Max. scale]",MIN_VALUE:"[Minimum (-2)]",MAX_VALUE:"[Maximum (+2)]",MIN_CUTOFF_VALUE:"[Ignore when below this value]",MAX_CUTOFF_VALUE:"[Ignore when above this value]",LINEAR:"Linearly increasing function between min and max.",SIGMOID:"Tangentially increasing function between min and max",GAUSSIAN:"Normal distribution increasing function between min and max.",ADD_MCA:"Add a new MCA.",DELETE_MCA:"Delete the MCA.",EDIT_MCA:"Edit the MCA."},PROJECTSETTINGS:{TITLE:"Project Settings",DESCRIPTION:"Settings"},SHOW5:"Show 5 items",SHOW10:"Show 10 items",SHOW15:"Show 15 items",SHOW20:"Show 20 items",SHOW25:"Show 25 items",SHOW30:"Show 30 items",SHOW35:"Show 35 items",SHOW40:"Show 40 items"},e}();e.English=t}(Translations||(Translations={}));var Translations;!function(e){var t=function(){function e(){}return e.locale={CANCEL_BTN:"Annuleren",OK_BTN:"OK",MAP:"Kaarten",MAP_LABEL:"Kaart",TABLE_LABEL:"Tabel",LAYERS:"Kaartlagen",FILTERS:"Filters",FILTER_INFO:'Momenteel zijn er geen filters geselecteerd. Klik op een icoon of gebied op de kaart, en klik op het filter icoontje (<span class="fa fa-filter"></span>) in het rechter menu om een filter toe te voegen. Dan wordt er een filter aangemaakt voor de geselecteerde eigenschap.',STYLES:"Stijlen",STYLE_INFO:'Momenteel zijn er geen stijlen geselecteerd. Klik op een icoon of gebied op de kaart, en klik op het stijl icoontje (<span class="fa fa-eye"></span>) in het rechter menu om een stijl toe te voegen. Dan wordt er een stijl aangemaakt voor de geselecteerde eigenschap.',FEATURES:"Features",LEGEND:"Legenda",SEARCH:"Zoeken",MAP_FEATURES:"Kaartfeatures",SPEEDS_TAOUFIK:"snelheden legenda Taoufik",SPEEDS_GOOGLEMAPS:"snelheden legenda Google Maps",VERWARMINGSSYSTEEM:"Verwarmingssysteem",PERCENTAGES_V1:"percentages v1",ORANGE_RED:"oranje - rood",WHITE_RED:"wit - rood",RED_WHITE:"rood - wit",GREEN_RED:"groen - rood",RED_GREEN:"rood - groen",BLUE_RED:"blauw - rood",RED_BLUE:"rood - blauw",WHITE_BLUE:"wit - blauw",BLUE_WHITE:"wit - groen",WHITE_GREEN:"wit - groen",GREEN_WHITE:"groen - wit",WHITE_ORANGE:"wit - oranje",ORANGE_WHITE:"oranje - wit",EXPERTMODE:{BEGINNER:"Novice",INTERMEDIATE:"Gevorderd",EXPERT:"Expert",EXPLANATION:"Selecteer uw expertise om meer functionaliteit te kunnen gebruiken."},LAYER_SERVICE:{RELOAD_PROJECT_TITLE:"Data wordt opnieuw geladen",RELOAD_PROJECT_MSG:"Na het wisselen van de taal moet de kaartdata opnieuw ingelezen worden. Excuses voor het ongemak."},MCA:{DESCRIPTION:'<h4>Toelichting MCA</h4><div style="text-align: left; margin-left:5px;"><p>Multi-Criteria Analysis (MCA) is een methode die verschillende eigenschappen van een locatie of gebied op de kaart combineerd tot een nieuwe eigenschap. Dit gaat als volgt: <ol><li>Schaal iedere eigenschap tussen 0 (geen waarde) en 1 (maximum waarde).</li><li>Weeg iedere eigenschap relatief t.o.v. de andere gekozen eigenschappen, waar een gewicht onder 0 betekent dat je de eigenschap wil vermijden, 0 wordt genegeerd, en een waarde groter dan 0 betekent dat je dit wil bereiken.</li></ol>Met andere woorden, het is een vorm van lineare regressie.</p></div>',INFO:"Momenteel zijn er geen kaartlagen geopend die multi-criteria analyses bevatten. Open hiervoor een andere kaartlaag.",INFO_EXPERT:"Momenteel zijn er geen kaartlagen geopend die multi-criteria analyses bevatten. Open een kaartlaag en maak een nieuwe MCA aan met behulp van de wizard.",SHOW_FEATURE_MSG:"Selecteer een feature op de kaart om de Multi-Criteria Analyse (MCA) resultaten in detail te bekijken.",TOTAL_RESULT:"Gecombineerd resultaat",DELETE_MSG:'Verwijder "{0}"',DELETE_MSG2:"Weet u het zeker?",HAS_CATEGORY:"  Specificeer categorie? ",EDITOR_TITLE:"MCA Editor",MAIN_FEATURE:"Selecteer het type feature",PROPERTIES:"Selecteer de eigenschappen",INCLUDE_RANK:"  Toon een rangorde? ",RANK_TITLE:"[Titel voor de rangorde]",TITLE:"Titel... *",CATEGORY_MSG:"[Categorie...]",TOGGLE_SPARKLINE:"Toon of verberg de histogram en score functie.",SCALE_MIN_TITLE:"[Schaal max]",SCALE_MAX_TITLE:"[Schaal min]",MIN_VALUE:"[Ondergrens (-2)]",MAX_VALUE:"[Bovengrens (+2)]",MIN_CUTOFF_VALUE:"[Niet meewegen onder]",MAX_CUTOFF_VALUE:"[Niet meewegen boven]",LINEAR:"Linear toenemende functie tussen onder- en bovengrens.",SIGMOID:"Tangentieel toenemende functie tussen onder- en bovengrens.",GAUSSIAN:"Normale verdeling tussen onder- en bovengrens.",ADD_MCA:"Maak een nieuwe MCA.",DELETE_MCA:"Verwijder de MCA.",EDIT_MCA:"Bewerk de MCA."},PROJECTSETTINGS:{TITLE:"Project instellingen",DESCRIPTION:"Instellingen"},SHOW5:"Toon 5 regels",SHOW10:"Toon 10 regels",SHOW15:"Toon 15 regels",SHOW20:"Toon 20 regels",SHOW25:"Toon 25 regels",SHOW30:"Toon 30 regels",SHOW35:"Toon 35 regels",SHOW40:"Toon 40 regels"},e}();e.Dutch=t}(Translations||(Translations={}));